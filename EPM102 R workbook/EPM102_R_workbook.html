<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shamsudeen Mohammed">

<title>EPM102 R workbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="EPM102_R_workbook_files/libs/clipboard/clipboard.min.js"></script>
<script src="EPM102_R_workbook_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="EPM102_R_workbook_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="EPM102_R_workbook_files/libs/quarto-html/popper.min.js"></script>
<script src="EPM102_R_workbook_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="EPM102_R_workbook_files/libs/quarto-html/anchor.min.js"></script>
<link href="EPM102_R_workbook_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="EPM102_R_workbook_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="EPM102_R_workbook_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="EPM102_R_workbook_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="EPM102_R_workbook_files/libs/bootstrap/bootstrap-813c323200a87c37e262811031999de4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-to-the-workbook" id="toc-introduction-to-the-workbook" class="nav-link active" data-scroll-target="#introduction-to-the-workbook"><span class="header-section-number">1</span> Introduction to the workbook</a>
  <ul class="collapse">
  <li><a href="#the-module-in-context" id="toc-the-module-in-context" class="nav-link" data-scroll-target="#the-module-in-context"><span class="header-section-number">1.1</span> The module in context</a></li>
  <li><a href="#the-statistics-for-epidemiology-workbook." id="toc-the-statistics-for-epidemiology-workbook." class="nav-link" data-scroll-target="#the-statistics-for-epidemiology-workbook."><span class="header-section-number">1.2</span> The Statistics for Epidemiology Workbook.</a></li>
  <li><a href="#formative-assignments-and-self-assessment-exercises" id="toc-formative-assignments-and-self-assessment-exercises" class="nav-link" data-scroll-target="#formative-assignments-and-self-assessment-exercises"><span class="header-section-number">1.3</span> Formative Assignments and Self-assessment exercises</a></li>
  <li><a href="#readings" id="toc-readings" class="nav-link" data-scroll-target="#readings"><span class="header-section-number">1.4</span> Readings</a></li>
  <li><a href="#access-to-readings-via-the-lshtm-library-archives-service" id="toc-access-to-readings-via-the-lshtm-library-archives-service" class="nav-link" data-scroll-target="#access-to-readings-via-the-lshtm-library-archives-service"><span class="header-section-number">1.5</span> Access to readings via the LSHTM Library &amp; Archives Service</a></li>
  <li><a href="#module-calendar" id="toc-module-calendar" class="nav-link" data-scroll-target="#module-calendar"><span class="header-section-number">1.6</span> Module calendar</a></li>
  </ul></li>
  <li><a href="#introduction-to-r" id="toc-introduction-to-r" class="nav-link" data-scroll-target="#introduction-to-r"><span class="header-section-number">2</span> Introduction to R</a>
  <ul class="collapse">
  <li><a href="#why-do-we-need-to-use-programming" id="toc-why-do-we-need-to-use-programming" class="nav-link" data-scroll-target="#why-do-we-need-to-use-programming"><span class="header-section-number">2.1</span> Why do we need to use programming?</a></li>
  <li><a href="#about-r" id="toc-about-r" class="nav-link" data-scroll-target="#about-r"><span class="header-section-number">2.2</span> About R</a></li>
  <li><a href="#introduction-to-r-session" id="toc-introduction-to-r-session" class="nav-link" data-scroll-target="#introduction-to-r-session"><span class="header-section-number">2.3</span> Introduction to R session</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages"><span class="header-section-number">2.4</span> Packages</a></li>
  <li><a href="#datasets-csv-files" id="toc-datasets-csv-files" class="nav-link" data-scroll-target="#datasets-csv-files"><span class="header-section-number">2.5</span> Datasets (csv files)</a></li>
  <li><a href="#getting-help" id="toc-getting-help" class="nav-link" data-scroll-target="#getting-help"><span class="header-section-number">2.6</span> Getting Help</a></li>
  </ul></li>
  <li><a href="#practical-wb02-using-r-for-data-summary-and-presentation" id="toc-practical-wb02-using-r-for-data-summary-and-presentation" class="nav-link" data-scroll-target="#practical-wb02-using-r-for-data-summary-and-presentation"><span class="header-section-number">3</span> Practical WB02: Using R for data summary and presentation</a>
  <ul class="collapse">
  <li><a href="#data-summary-and-presentation" id="toc-data-summary-and-presentation" class="nav-link" data-scroll-target="#data-summary-and-presentation"><span class="header-section-number">3.1</span> Data summary and presentation</a></li>
  <li><a href="#packages-needed-for-wb02" id="toc-packages-needed-for-wb02" class="nav-link" data-scroll-target="#packages-needed-for-wb02"><span class="header-section-number">3.2</span> Packages needed for WB02</a></li>
  <li><a href="#graphical-displays" id="toc-graphical-displays" class="nav-link" data-scroll-target="#graphical-displays"><span class="header-section-number">3.3</span> Graphical displays</a>
  <ul class="collapse">
  <li><a href="#creating-a-bar-chart" id="toc-creating-a-bar-chart" class="nav-link" data-scroll-target="#creating-a-bar-chart"><span class="header-section-number">3.3.1</span> Creating a bar chart</a></li>
  <li><a href="#creating-a-histogram" id="toc-creating-a-histogram" class="nav-link" data-scroll-target="#creating-a-histogram"><span class="header-section-number">3.3.2</span> Creating a histogram</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">3.4</span> Exercises</a></li>
  <li><a href="#extra-r-using-ggplot2" id="toc-extra-r-using-ggplot2" class="nav-link" data-scroll-target="#extra-r-using-ggplot2"><span class="header-section-number">3.5</span> Extra R: Using ggplot2</a></li>
  </ul></li>
  <li><a href="#practical-wb05-inference-from-a-sample-mean" id="toc-practical-wb05-inference-from-a-sample-mean" class="nav-link" data-scroll-target="#practical-wb05-inference-from-a-sample-mean"><span class="header-section-number">4</span> Practical WB05: Inference from a sample mean</a>
  <ul class="collapse">
  <li><a href="#packages-needed-for-wb02-1" id="toc-packages-needed-for-wb02-1" class="nav-link" data-scroll-target="#packages-needed-for-wb02-1"><span class="header-section-number">4.1</span> Packages needed for WB02</a></li>
  <li><a href="#exploring-data-using-the-summarise-function" id="toc-exploring-data-using-the-summarise-function" class="nav-link" data-scroll-target="#exploring-data-using-the-summarise-function"><span class="header-section-number">4.2</span> Exploring data using the summarise function</a></li>
  <li><a href="#confidence-interval-for-the-mean" id="toc-confidence-interval-for-the-mean" class="nav-link" data-scroll-target="#confidence-interval-for-the-mean"><span class="header-section-number">4.3</span> Confidence interval for the mean</a></li>
  <li><a href="#hypothesis-testing-for-the-mean" id="toc-hypothesis-testing-for-the-mean" class="nav-link" data-scroll-target="#hypothesis-testing-for-the-mean"><span class="header-section-number">4.4</span> Hypothesis testing for the mean</a></li>
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1"><span class="header-section-number">4.5</span> Exercises</a></li>
  <li><a href="#extra-r-writing-your-own-confidence-interval-function" id="toc-extra-r-writing-your-own-confidence-interval-function" class="nav-link" data-scroll-target="#extra-r-writing-your-own-confidence-interval-function"><span class="header-section-number">4.6</span> Extra R: writing your own confidence interval function</a></li>
  </ul></li>
  <li><a href="#practical-wb06-comparison-of-two-means" id="toc-practical-wb06-comparison-of-two-means" class="nav-link" data-scroll-target="#practical-wb06-comparison-of-two-means"><span class="header-section-number">5</span> Practical WB06: Comparison of two means</a>
  <ul class="collapse">
  <li><a href="#packages-needed-for-wb02-2" id="toc-packages-needed-for-wb02-2" class="nav-link" data-scroll-target="#packages-needed-for-wb02-2"><span class="header-section-number">5.1</span> Packages needed for WB02</a></li>
  <li><a href="#paired-data" id="toc-paired-data" class="nav-link" data-scroll-target="#paired-data"><span class="header-section-number">5.2</span> Paired data</a></li>
  <li><a href="#confidence-interval-for-the-mean-difference" id="toc-confidence-interval-for-the-mean-difference" class="nav-link" data-scroll-target="#confidence-interval-for-the-mean-difference"><span class="header-section-number">5.3</span> Confidence interval for the mean difference</a>
  <ul class="collapse">
  <li><a href="#reporting-and-interpreting-the-confidence-interval" id="toc-reporting-and-interpreting-the-confidence-interval" class="nav-link" data-scroll-target="#reporting-and-interpreting-the-confidence-interval"><span class="header-section-number">5.3.1</span> Reporting and interpreting the confidence interval</a></li>
  <li><a href="#reporting-and-interpreting-the-significance-test" id="toc-reporting-and-interpreting-the-significance-test" class="nav-link" data-scroll-target="#reporting-and-interpreting-the-significance-test"><span class="header-section-number">5.3.2</span> Reporting and interpreting the significance test</a></li>
  </ul></li>
  <li><a href="#unpaired-data" id="toc-unpaired-data" class="nav-link" data-scroll-target="#unpaired-data"><span class="header-section-number">5.4</span> Unpaired data</a></li>
  <li><a href="#exercises-2" id="toc-exercises-2" class="nav-link" data-scroll-target="#exercises-2"><span class="header-section-number">5.5</span> Exercises</a></li>
  </ul></li>
  <li><a href="#practical-wb07-inference-from-a-sample-proportion" id="toc-practical-wb07-inference-from-a-sample-proportion" class="nav-link" data-scroll-target="#practical-wb07-inference-from-a-sample-proportion"><span class="header-section-number">6</span> Practical WB07: Inference from a sample proportion</a>
  <ul class="collapse">
  <li><a href="#confidence-interval-for-the-proportion" id="toc-confidence-interval-for-the-proportion" class="nav-link" data-scroll-target="#confidence-interval-for-the-proportion"><span class="header-section-number">6.1</span> Confidence interval for the proportion</a>
  <ul class="collapse">
  <li><a href="#interpretation-of-the-confidence-interval" id="toc-interpretation-of-the-confidence-interval" class="nav-link" data-scroll-target="#interpretation-of-the-confidence-interval"><span class="header-section-number">6.1.1</span> Interpretation of the confidence interval</a></li>
  </ul></li>
  <li><a href="#hypothesis-testing-for-the-proportion" id="toc-hypothesis-testing-for-the-proportion" class="nav-link" data-scroll-target="#hypothesis-testing-for-the-proportion"><span class="header-section-number">6.2</span> Hypothesis testing for the proportion</a></li>
  <li><a href="#exercises-3" id="toc-exercises-3" class="nav-link" data-scroll-target="#exercises-3"><span class="header-section-number">6.3</span> Exercises</a></li>
  </ul></li>
  <li><a href="#practical-wb08-comparison-of-two-proportions" id="toc-practical-wb08-comparison-of-two-proportions" class="nav-link" data-scroll-target="#practical-wb08-comparison-of-two-proportions"><span class="header-section-number">7</span> Practical WB08: Comparison of two proportions</a>
  <ul class="collapse">
  <li><a href="#comparing-two-proportions" id="toc-comparing-two-proportions" class="nav-link" data-scroll-target="#comparing-two-proportions"><span class="header-section-number">7.1</span> Comparing two proportions</a></li>
  <li><a href="#confidence-interval-and-hypothesis-testing" id="toc-confidence-interval-and-hypothesis-testing" class="nav-link" data-scroll-target="#confidence-interval-and-hypothesis-testing"><span class="header-section-number">7.2</span> Confidence interval and hypothesis testing</a></li>
  <li><a href="#exercises-4" id="toc-exercises-4" class="nav-link" data-scroll-target="#exercises-4"><span class="header-section-number">7.3</span> Exercises</a></li>
  </ul></li>
  <li><a href="#practical-wb09-association-between-two-categorical-variables" id="toc-practical-wb09-association-between-two-categorical-variables" class="nav-link" data-scroll-target="#practical-wb09-association-between-two-categorical-variables"><span class="header-section-number">8</span> Practical WB09: Association between two categorical variables</a>
  <ul class="collapse">
  <li><a href="#test-of-association-between-two-categorical-variables" id="toc-test-of-association-between-two-categorical-variables" class="nav-link" data-scroll-target="#test-of-association-between-two-categorical-variables"><span class="header-section-number">8.1</span> Test of association between two categorical variables</a></li>
  <li><a href="#test-of-association-between-two-binary-variables-2x2-tables" id="toc-test-of-association-between-two-binary-variables-2x2-tables" class="nav-link" data-scroll-target="#test-of-association-between-two-binary-variables-2x2-tables"><span class="header-section-number">8.2</span> Test of association between two binary variables: 2x2 tables</a></li>
  <li><a href="#test-for-a-linear-trend-in-2xn-table" id="toc-test-for-a-linear-trend-in-2xn-table" class="nav-link" data-scroll-target="#test-for-a-linear-trend-in-2xn-table"><span class="header-section-number">8.3</span> Test for a linear trend in 2xn table</a></li>
  <li><a href="#exercises-5" id="toc-exercises-5" class="nav-link" data-scroll-target="#exercises-5"><span class="header-section-number">8.4</span> Exercises</a></li>
  </ul></li>
  <li><a href="#practical-wb10-stratified-analysis" id="toc-practical-wb10-stratified-analysis" class="nav-link" data-scroll-target="#practical-wb10-stratified-analysis"><span class="header-section-number">9</span> Practical WB10: Stratified Analysis</a>
  <ul class="collapse">
  <li><a href="#stratified-analysis" id="toc-stratified-analysis" class="nav-link" data-scroll-target="#stratified-analysis"><span class="header-section-number">9.1</span> Stratified analysis</a></li>
  <li><a href="#generating-binary-variables" id="toc-generating-binary-variables" class="nav-link" data-scroll-target="#generating-binary-variables"><span class="header-section-number">9.2</span> Generating binary variables</a></li>
  <li><a href="#calculation-of-odds-ratio" id="toc-calculation-of-odds-ratio" class="nav-link" data-scroll-target="#calculation-of-odds-ratio"><span class="header-section-number">9.3</span> Calculation of Odds Ratio</a></li>
  <li><a href="#crude-odds-ratio" id="toc-crude-odds-ratio" class="nav-link" data-scroll-target="#crude-odds-ratio"><span class="header-section-number">9.4</span> Crude Odds Ratio</a></li>
  <li><a href="#adjusted-odds-ratio" id="toc-adjusted-odds-ratio" class="nav-link" data-scroll-target="#adjusted-odds-ratio"><span class="header-section-number">9.5</span> Adjusted Odds Ratio</a></li>
  <li><a href="#exercises-6" id="toc-exercises-6" class="nav-link" data-scroll-target="#exercises-6"><span class="header-section-number">9.6</span> Exercises</a></li>
  </ul></li>
  <li><a href="#practical-wb11-matched-analysis-for-paired-binary-data" id="toc-practical-wb11-matched-analysis-for-paired-binary-data" class="nav-link" data-scroll-target="#practical-wb11-matched-analysis-for-paired-binary-data"><span class="header-section-number">10</span> Practical WB11: Matched analysis for paired binary data</a>
  <ul class="collapse">
  <li><a href="#unmatched-2x2-table" id="toc-unmatched-2x2-table" class="nav-link" data-scroll-target="#unmatched-2x2-table"><span class="header-section-number">10.1</span> Unmatched 2x2 table</a></li>
  <li><a href="#display-of-matched-2x2-table" id="toc-display-of-matched-2x2-table" class="nav-link" data-scroll-target="#display-of-matched-2x2-table"><span class="header-section-number">10.2</span> Display of matched 2x2 table</a></li>
  <li><a href="#matched-odds-ratio" id="toc-matched-odds-ratio" class="nav-link" data-scroll-target="#matched-odds-ratio"><span class="header-section-number">10.3</span> Matched Odds ratio</a></li>
  <li><a href="#exercises-7" id="toc-exercises-7" class="nav-link" data-scroll-target="#exercises-7"><span class="header-section-number">10.4</span> Exercises</a></li>
  </ul></li>
  <li><a href="#practical-wb12-association-between-two-quantitative-variables-correlation-and-regression" id="toc-practical-wb12-association-between-two-quantitative-variables-correlation-and-regression" class="nav-link" data-scroll-target="#practical-wb12-association-between-two-quantitative-variables-correlation-and-regression"><span class="header-section-number">11</span> Practical WB12: Association between two quantitative variables: correlation and regression</a>
  <ul class="collapse">
  <li><a href="#correlation-coefficient" id="toc-correlation-coefficient" class="nav-link" data-scroll-target="#correlation-coefficient"><span class="header-section-number">11.1</span> Correlation coefficient</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression"><span class="header-section-number">11.2</span> Linear Regression</a></li>
  <li><a href="#exercises-8" id="toc-exercises-8" class="nav-link" data-scroll-target="#exercises-8"><span class="header-section-number">11.3</span> Exercises</a></li>
  </ul></li>
  <li><a href="#practical-wb15-non-parametric-methods" id="toc-practical-wb15-non-parametric-methods" class="nav-link" data-scroll-target="#practical-wb15-non-parametric-methods"><span class="header-section-number">12</span> Practical WB15: Non-parametric methods</a>
  <ul class="collapse">
  <li><a href="#single-sample-data" id="toc-single-sample-data" class="nav-link" data-scroll-target="#single-sample-data"><span class="header-section-number">12.1</span> Single sample data</a></li>
  <li><a href="#two-independent-samples" id="toc-two-independent-samples" class="nav-link" data-scroll-target="#two-independent-samples"><span class="header-section-number">12.2</span> Two independent samples</a></li>
  <li><a href="#two-paired-samples" id="toc-two-paired-samples" class="nav-link" data-scroll-target="#two-paired-samples"><span class="header-section-number">12.3</span> Two paired samples</a></li>
  <li><a href="#single-sample-two-variables" id="toc-single-sample-two-variables" class="nav-link" data-scroll-target="#single-sample-two-variables"><span class="header-section-number">12.4</span> Single sample, two variables</a></li>
  <li><a href="#exercises-9" id="toc-exercises-9" class="nav-link" data-scroll-target="#exercises-9"><span class="header-section-number">12.5</span> Exercises</a></li>
  </ul></li>
  <li><a href="#practical-wb16-sample-size" id="toc-practical-wb16-sample-size" class="nav-link" data-scroll-target="#practical-wb16-sample-size"><span class="header-section-number">13</span> Practical WB16: Sample size</a>
  <ul class="collapse">
  <li><a href="#sample-size-to-test-a-hypothesis-comparison-of-proportions" id="toc-sample-size-to-test-a-hypothesis-comparison-of-proportions" class="nav-link" data-scroll-target="#sample-size-to-test-a-hypothesis-comparison-of-proportions"><span class="header-section-number">13.1</span> Sample size to test a hypothesis: comparison of proportions</a></li>
  <li><a href="#sample-size-to-test-a-hypothesis-odds-ratio" id="toc-sample-size-to-test-a-hypothesis-odds-ratio" class="nav-link" data-scroll-target="#sample-size-to-test-a-hypothesis-odds-ratio"><span class="header-section-number">13.2</span> Sample size to test a hypothesis: Odds Ratio</a></li>
  <li><a href="#sample-size-to-test-a-hypothesis-comparison-of-means" id="toc-sample-size-to-test-a-hypothesis-comparison-of-means" class="nav-link" data-scroll-target="#sample-size-to-test-a-hypothesis-comparison-of-means"><span class="header-section-number">13.3</span> Sample size to test a hypothesis: comparison of means</a></li>
  <li><a href="#calculation-of-power-given-fixed-sample-size" id="toc-calculation-of-power-given-fixed-sample-size" class="nav-link" data-scroll-target="#calculation-of-power-given-fixed-sample-size"><span class="header-section-number">13.4</span> Calculation of power, given fixed sample size</a></li>
  <li><a href="#exercises-10" id="toc-exercises-10" class="nav-link" data-scroll-target="#exercises-10"><span class="header-section-number">13.5</span> Exercises</a></li>
  </ul></li>
  <li><a href="#practical-wb02-solutions" id="toc-practical-wb02-solutions" class="nav-link" data-scroll-target="#practical-wb02-solutions"><span class="header-section-number">14</span> Practical WB02 Solutions</a></li>
  <li><a href="#practical-wb05-solutions" id="toc-practical-wb05-solutions" class="nav-link" data-scroll-target="#practical-wb05-solutions"><span class="header-section-number">15</span> Practical WB05 solutions</a></li>
  <li><a href="#practical-wb06-solutions" id="toc-practical-wb06-solutions" class="nav-link" data-scroll-target="#practical-wb06-solutions"><span class="header-section-number">16</span> Practical WB06 solutions</a></li>
  <li><a href="#practical-wb10-solutions" id="toc-practical-wb10-solutions" class="nav-link" data-scroll-target="#practical-wb10-solutions"><span class="header-section-number">17</span> Practical WB10 solutions</a></li>
  <li><a href="#practical-wb11-solutions" id="toc-practical-wb11-solutions" class="nav-link" data-scroll-target="#practical-wb11-solutions"><span class="header-section-number">18</span> Practical WB11 solutions</a>
  <ul class="collapse">
  <li><a href="#matched-analysis" id="toc-matched-analysis" class="nav-link" data-scroll-target="#matched-analysis"><span class="header-section-number">18.1</span> Matched analysis</a></li>
  <li><a href="#unmatched-analysis" id="toc-unmatched-analysis" class="nav-link" data-scroll-target="#unmatched-analysis"><span class="header-section-number">18.2</span> Unmatched analysis</a></li>
  </ul></li>
  <li><a href="#practical-wb12-solutions" id="toc-practical-wb12-solutions" class="nav-link" data-scroll-target="#practical-wb12-solutions"><span class="header-section-number">19</span> Practical WB12 solutions</a></li>
  <li><a href="#practical-wb15-solutions" id="toc-practical-wb15-solutions" class="nav-link" data-scroll-target="#practical-wb15-solutions"><span class="header-section-number">20</span> Practical WB15 solutions</a></li>
  <li><a href="#practical-wb16-solutions" id="toc-practical-wb16-solutions" class="nav-link" data-scroll-target="#practical-wb16-solutions"><span class="header-section-number">21</span> Practical WB16 solutions</a></li>
  <li><a href="#appendix-1-list-of-datasets" id="toc-appendix-1-list-of-datasets" class="nav-link" data-scroll-target="#appendix-1-list-of-datasets"><span class="header-section-number">22</span> Appendix 1: List of datasets</a>
  <ul class="collapse">
  <li><a href="#babies.csv" id="toc-babies.csv" class="nav-link" data-scroll-target="#babies.csv"><span class="header-section-number">22.1</span> babies.csv</a></li>
  <li><a href="#bus.csv" id="toc-bus.csv" class="nav-link" data-scroll-target="#bus.csv"><span class="header-section-number">22.2</span> bus.csv</a></li>
  <li><a href="#chol1.csv" id="toc-chol1.csv" class="nav-link" data-scroll-target="#chol1.csv"><span class="header-section-number">22.3</span> chol1.csv</a></li>
  <li><a href="#diabk.csv" id="toc-diabk.csv" class="nav-link" data-scroll-target="#diabk.csv"><span class="header-section-number">22.4</span> diabk.csv</a></li>
  <li><a href="#diabraz.csv" id="toc-diabraz.csv" class="nav-link" data-scroll-target="#diabraz.csv"><span class="header-section-number">22.5</span> diabraz.csv</a></li>
  <li><a href="#mwanza.csv" id="toc-mwanza.csv" class="nav-link" data-scroll-target="#mwanza.csv"><span class="header-section-number">22.6</span> mwanza.csv</a></li>
  <li><a href="#rmr.data" id="toc-rmr.data" class="nav-link" data-scroll-target="#rmr.data"><span class="header-section-number">22.7</span> rmr.data</a></li>
  <li><a href="#skinf.csv" id="toc-skinf.csv" class="nav-link" data-scroll-target="#skinf.csv"><span class="header-section-number">22.8</span> skinf.csv</a></li>
  <li><a href="#whall10.csv" id="toc-whall10.csv" class="nav-link" data-scroll-target="#whall10.csv"><span class="header-section-number">22.9</span> whall10.csv</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">EPM102 R workbook</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shamsudeen Mohammed </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction-to-the-workbook" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction to the workbook</h1>
<p>Welcome to the EPM102 R Workbook. This workbook is one of the essential learning resources we provide for this module. The key learning material is in the form of Computer Aided Learning (CAL) sessions, which can all be found on the EPM102 Moodle page together with other module resources.</p>
<section id="the-module-in-context" class="level2 tabset" data-number="1.1">
<h2 class="tabset anchored" data-number="1.1" data-anchor-id="the-module-in-context"><span class="header-section-number">1.1</span> The module in context</h2>
<p>The aim of this module is to provide you with the key statistical principles that are essential for anyone studying epidemiology. This includes introducing you to statistical computing using R. Developing a good proficiency in using R for statistical analysis will provide a valuable foundation for more advanced modules like EPM202 Statistical Methods in Epidemiology.</p>
</section>
<section id="the-statistics-for-epidemiology-workbook." class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="the-statistics-for-epidemiology-workbook."><span class="header-section-number">1.2</span> The Statistics for Epidemiology Workbook.</h2>
<p>This Workbook accompanies the CAL sessions. You should use this Workbook in parallel with the CAL material, so that you will gain practical experience as you go along. The purpose of this Workbook is to give you some practical experience in analysing data using a computer. R is the general-purpose statistical package that we are going to use. This Workbook is organised in three Sections:</p>
<ul>
<li><p><strong>Section 1</strong> links to an online “Introduction to R”. Even if you know it already, it is recommended that you take the time to run through it. In this “Introduction to R” online session, you’ll learn to download and open necessary files, navigate RStudio, open and save datasets, and familiarize yourself with simple R functions to produce basic descriptive statistics. It is important you work through this session before progressing to working through the rest of the EPM102 workbook, to ensure you have everything set up in the R environment to complete these practicals.</p></li>
<li><p><strong>Section 2</strong> is made of sets of computer exercises. Each set refers to a specific session of the CAL material and, for this reason, it is identified by the same number. Note that, however, not all CAL sessions have a computer practical.</p></li>
<li><p><strong>Section 3</strong> has the solutions to all the exercises.</p></li>
</ul>
<p>Finally, <strong>Appendix 1</strong> describes all the datasets used in the practicals and <strong>Appendix 2</strong> lists R functions introduced in each session.</p>
</section>
<section id="formative-assignments-and-self-assessment-exercises" class="level2 tabset" data-number="1.3">
<h2 class="tabset anchored" data-number="1.3" data-anchor-id="formative-assignments-and-self-assessment-exercises"><span class="header-section-number">1.3</span> Formative Assignments and Self-assessment exercises</h2>
<p>We recommend that you complete the two assignments (known as Formative Assignments - FAs). These test your understanding and the feedback given by tutors (and specimen answer) enables you to see how you are progressing. The FA submission deadline is 31 March.</p>
<p>Three Self-assessment exercises (SAs) are also provided, with specimen answers available on Moodle. We recommend you download the specimen answers only when you have attempted the exercises yourself.</p>
<p>Assignments and exercises should be downloaded from the Assessment section of EPM102 within Moodle. Full details of how and when to submit assignments (using the online Assignment Management System) can be found in the Assessment section of the EPM Student Zone within Moodle.</p>
<p>For all your assignment work, it is vital that you understand and apply principles of good academic writing, referencing and using source material, as well as avoiding plagiarism. Please refer to the Academic Writing Handbook for guidance on this - this can be found in the Study Skills section of the EPM Student Zone within Moodle.</p>
</section>
<section id="readings" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="readings"><span class="header-section-number">1.4</span> Readings</h2>
<p>You should make use of the textbook supplied with your material (Essential Medical Statistics) - specific recommended readings from these are given in the reference section of the individual CAL sessions.</p>
<p>Other books recommended as optional reading for this module include: (these books are not supplied):</p>
<ul>
<li><p>“The Epidemiologist R Handbook”: <a href="https://www.epirhandbook.com/en/" class="uri">https://www.epirhandbook.com/en/</a>. This is a free online book that teaches data science using R. <strong>NOTE:</strong> This book uses %&gt;% for pipelines. At LSHTM your study materials will use |&gt;.</p></li>
<li><p>“R for data science”: <a href="https://r4ds.hadley.nz/" class="uri">https://r4ds.hadley.nz/</a>. This is another free online book that teaches data science using R.</p></li>
</ul>
<p>We recommend you also make use of the LSHTM Library &amp; Archives Service. Details on how to access this are given below.</p>
</section>
<section id="access-to-readings-via-the-lshtm-library-archives-service" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="access-to-readings-via-the-lshtm-library-archives-service"><span class="header-section-number">1.5</span> Access to readings via the LSHTM Library &amp; Archives Service</h2>
<ul>
<li><p>Students studying by distance learning have full access to the LSHTM Library &amp; Archives Service <a href="https://www.lshtm.ac.uk/research/library-archives-service" class="uri">https://www.lshtm.ac.uk/research/library-archives-service</a>. Library resources are dedicated to supporting the learning, teaching and research needs of the School.</p></li>
<li><p>You can make full use of the electronic books, journals, and databases that the Library subscribes to. You are automatically registered to use this service; you just need the username and password that you use to log-in to Moodle. Please see <a href="https://lshtm.sharepoint.com/Services/library/Pages/distance-learners.aspx" class="uri">https://lshtm.sharepoint.com/Services/library/Pages/distance-learners.aspx</a> for further guidance on accessing these resources.</p></li>
<li><p>If you are able to visit the Library in person then you are very welcome to use the study space and borrow books (see the webpage above). Library staff can also advise on access schemes which may allow you to make use of a local library.</p></li>
<li><p>Library staff are here to help. If you have any questions please get in touch with them through the School’s Servicedesk (there is a link to this at the bottom of the webpage at <a href="https://lshtm.sharepoint.com/Services/library/Pages/distance-learners.aspx" class="uri">https://lshtm.sharepoint.com/Services/library/Pages/distance-learners.aspx</a>. This will ensure that your enquiry can be dealt with as soon as possible.</p></li>
<li><p>Please note that you additionally have access to the University of London Online Library <a href="http://onlinelibrary.london.ac.uk/" class="uri">http://onlinelibrary.london.ac.uk/</a>. This is a separate service to that provided by LSHTM. If you have any questions about the UoL Online Library, please contact them directly via their webpages.</p></li>
</ul>
</section>
<section id="module-calendar" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="module-calendar"><span class="header-section-number">1.6</span> Module calendar</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Date</strong></th>
<th style="text-align: left;"><strong>Event</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">October</td>
<td style="text-align: left;">Tutoring support begins (Moodle discussion forums, email queries, assignment marking).</td>
</tr>
<tr class="even">
<td style="text-align: left;">31 March</td>
<td style="text-align: left;">Final submission date for the Formative Assignments (FAs).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">April</td>
<td style="text-align: left;">Exam practice web forums open 6 weeks prior to the exam.</td>
</tr>
<tr class="even">
<td style="text-align: left;">June</td>
<td style="text-align: left;">Exam usually held in early June.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="introduction-to-r" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Introduction to R</h1>
<section id="why-do-we-need-to-use-programming" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="why-do-we-need-to-use-programming"><span class="header-section-number">2.1</span> Why do we need to use programming?</h2>
<p>Epidemiologists, statisticians, and data scientists often work with large (or small) datasets and try to extract meaningful insights from them. They will typically do this using computer programming. Programming is the process of giving instructions to a computer so it can perform tasks for you. Just like you might follow a recipe to bake a cake, a computer follows a set of instructions (called a program) to do things like analyse data, make calculations, create charts, or even predict outcomes.</p>
<p>Epidemiologists, statisticians, and data scientists often use programming to:</p>
<ul>
<li>Clean and organise data (fixing messy or missing information and combine data from multiple sources)</li>
<li>Analyse patterns (e.g.&nbsp;whether age affects risk of disease)</li>
<li>Visualise data (creating graphs and charts)</li>
<li>Build models to make causal inferences (e.g.&nbsp;does smoking cause lung cancer?) or make predictions (e.g.&nbsp;how a disease might spread in a population or predict future outbreaks)</li>
</ul>
<p>In EPM102 you will become familiar with performing some of these tasks, using R.</p>
</section>
<section id="about-r" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="about-r"><span class="header-section-number">2.2</span> About R</h2>
<p>R is a widely used programming language, available to download as open-source software. This means it is free to use and the source code used to build it is freely available to be redistributed and modified. This makes it a useful tool for producing reproducible research as anyone can use it. R is well-known for its data visualisation and statistical computing capabilities. Base R is the basic software included in the R programming language. However, R is a highly modifiable program. While Base R is a complete statistical computing environment on its own, its power and versatility are significantly extended by an extensive collection of packages that you can install and load in R. As these packages are built by many different people there are often several slightly different ways of carrying out the same task in R. For this reason, in the EPM102 workbook, you will be introduced to a limited set of packages (see further details below).</p>
</section>
<section id="introduction-to-r-session" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="introduction-to-r-session"><span class="header-section-number">2.3</span> Introduction to R session</h2>
<p>To access the <strong>“Introduction to R”</strong> online session you should navigate to the EPM102 Statistics for Epidemiology Moodle page – click on the <strong>Core Study Materials tile.</strong> You will see a link in the text for the online <strong>“Introduction to R”</strong> session.</p>
<p>If you require any support whilst working through this session, you may also wish to look at the Support for learning in R Tile of the EPM102 Moodle pages. Here you will find a dedicated forum for “Queries relevant to getting set up in R and the ‘Introduction to R’ Session”.</p>
</section>
<section id="packages" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="packages"><span class="header-section-number">2.4</span> Packages</h2>
<p>In the “Introduction to R” online session you will be shown who to download and install packages that are relevant to working through the EPM102 workbook. These packages include:</p>
<ul>
<li><strong>tidyverse</strong> – A collection of packages for data manipulation, visualisation, and more e.g.:
<ul>
<li>dplyr (data wrangling)</li>
<li>tidyr (reshaping data)</li>
<li>readr (reading data)</li>
<li>ggplot2 (visualisation)</li>
</ul></li>
<li><strong>rio</strong> – for importing and exporting files</li>
<li><strong>Gmodels</strong> – Tools for statistical analysis</li>
<li><strong>DescTools</strong> – Tools for descriptive statistics</li>
</ul>
<p>Please make sure you have downloaded these packages before progressing with the rest of the workbook.</p>
</section>
<section id="datasets-csv-files" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="datasets-csv-files"><span class="header-section-number">2.5</span> Datasets (csv files)</h2>
<p>At the end of the online “Introduction to R” session you should have successfully installed both R and RStudio (the console) onto your computer, and downloaded a set of packages.</p>
<p>You should now also save the Comma-Separated Values (CSV) text files that are located on the EPM102 Moodle Core Study Materials tile to your local computer. Here you should find a folder called ’Datasets for the EPM102 workbook”.</p>
<p>You must copy all of the files that are in this folder into a folder of your choice on your computer. Make sure to record the address of this folder so you can use this as your working directory (the default location on your computer where R will read and save files). If you do this, you should find that the instructions provided will work. An incorrect working directory is a common error and it means that the codes will not work. Full guidance on installing R and RStudio, as well as changing the working directory, is found in the ‘Introduction to R’ online content on Moodle.</p>
</section>
<section id="getting-help" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="getting-help"><span class="header-section-number">2.6</span> Getting Help</h2>
<p>If you need any tutor support in getting yourself set up with R, and/ or working through this workbook, please navigate to the Support for Learning in R tiles on the EPM102 Moodle pages. Here you will find dedicated discussion forums, where you can ask tutors for support with your learning in R.</p>
</section>
</section>
<section id="practical-wb02-using-r-for-data-summary-and-presentation" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Practical WB02: Using R for data summary and presentation</h1>
<p>In this practical, we are going to use R to summarise and present the data discussed in CAL session SC02.</p>
<section id="data-summary-and-presentation" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="data-summary-and-presentation"><span class="header-section-number">3.1</span> Data summary and presentation</h2>
<p>In this session, you are going to use the dataset called babies.csv. Refer to the Appendix for a description of the study that produced the data and variables in the dataset. In the Introduction to R you learnt how to install and load packages, import, summarise and manipulate data using the functions listed below.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Task</strong></th>
<th style="text-align: left;"><strong>R function</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Import a csv file of data</td>
<td style="text-align: left;">import()</td>
</tr>
<tr class="even">
<td style="text-align: left;">Group data in a tibble</td>
<td style="text-align: left;">group_by()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Summarise data in a tibble</td>
<td style="text-align: left;">summarise()</td>
</tr>
<tr class="even">
<td style="text-align: left;">Change a variable to a factor</td>
<td style="text-align: left;">as.factor()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Recode a variable</td>
<td style="text-align: left;">recode()</td>
</tr>
<tr class="even">
<td style="text-align: left;">Make a categorical variable from continuous</td>
<td style="text-align: left;">cut()</td>
</tr>
</tbody>
</table>
<p>Now you are going to use R to examine ways of summarising and presenting data discussed in CAL session SC02. First you will learn some new commands for producing graphs.<br>
</p>
</section>
<section id="packages-needed-for-wb02" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="packages-needed-for-wb02"><span class="header-section-number">3.2</span> Packages needed for WB02</h2>
<p>In this session, you will need to make use of the tidyverse and rio packages, which you should have installed whilst working through the “Introduction to R” online session. If you have not yet downloaded these, please return to this session to remind yourself of how to action this. Remember, to install packages we make use of the install.packages() function.</p>
<p>You should now load these packages. Recall from the “Introduction to R” online session, we type the following:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="graphical-displays" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="graphical-displays"><span class="header-section-number">3.3</span> Graphical displays</h2>
<p>Remember:</p>
<ul>
<li>Bar charts are used to display the distributions of categorical variables.</li>
<li>Histograms are used to display the distributions of quantitative variables.</li>
</ul>
<p>We wish to create a bar chart for the hypertension variable. In this practical, we will use plotting commands from base R. A very flexible alternative is using the library ‘ggplot2’. Commands for graphs with ggplot2 can seem complicated at first, but this allows it to create more flexible and complex data visualisations. ggplot2 is discussed in the “Extra R” section at the end of this practical.</p>
<section id="creating-a-bar-chart" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="creating-a-bar-chart"><span class="header-section-number">3.3.1</span> Creating a bar chart</h3>
<p>To create a bar chart showing the number of cases in each category of hypertension, follow these steps:</p>
<p>Import the dataset babies using the import() function.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>babies <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"babies.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Count how many times each category of hyp appears in the dataset and store the result in an object called counts.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">table</span>(babies<span class="sc">$</span>hyp)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2 
 89 552 </code></pre>
</div>
</div>
<p>Use the barplot() function to draw the bar chart</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This will produce a bar chart displaying the frequency of each hypertension (hyp) category. You should see the chart appear in the plot window. The output might look like:</p>
<p>Note that this bar chart will appear in the plots window of RStudio but it will not be saved. To save the plot as an image file you can use the png() command like this.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"practical2-plot1.png"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(counts)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
</div>
<p>This puts the output of the barplot() command into a png file named ‘practical2-plot1.png’, and then switches back to the RStudio plot viewer using dev.off(). The png file is saved to your working directory.</p>
<p>There are a few ways in which we could improve the bar chart. First, we should include axis labels and we might want to colour our bars. To do this we can use the code</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  counts,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Hypertension"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Frequency"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We may also want to generate a plot of the percentage of observations in each category of hypertension. To do this we must generate a percentage variable and plot it using the code below.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>percent <span class="ot">&lt;-</span> counts <span class="sc">*</span> <span class="dv">100</span> <span class="sc">/</span> <span class="fu">sum</span>(counts)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  percent,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Hypertension"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Percentage"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="creating-a-histogram" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="creating-a-histogram"><span class="header-section-number">3.3.2</span> Creating a histogram</h3>
<p>To obtain a histogram for a quantitative variable, use the hist() command. Try this for birthweight, type</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(babies<span class="sc">$</span>bweight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Again, there is room for improvement in this histogram. We use the breaks argument to specify the number of bars in our chart. We can also set the axis labels with xlab, like we did for our barplot</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  babies<span class="sc">$</span>bweight,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="dv">5</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Birthweight (g)"</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>hist() defaults to showing the frequency of observations in each interval. If we want to look at the probability density of observations in each bar (so the area of each bar relates to the number of observations), we can set the argument freq=FALSE.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  babies<span class="sc">$</span>bweight,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="dv">5</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Birthweight (g)"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="cn">FALSE</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this plot, the area of the bars reflects the number of observations in them. You can vary the number of bars in the histogram by adding, for example, breaks=12. Try</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  babies<span class="sc">$</span>bweight,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="dv">12</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Birthweight (g)"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="cn">FALSE</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You will notice that there are actually only 9 bars in the plot although we asked for 12 breaks. This is because when you specify a single number for breaks, the hist() function treats it as a suggestion. To control the number of bars more precisely you need to set a sequence of values for the breaks. We can make a sequence from the minimum bweight to maximum using seq(from=min(babies<span class="math inline">\(bweight), to=max(babies\)</span>bweight), length.out=13) (Note, if there are 13 breaks there are 12 bars). So we can plot this</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  babies<span class="sc">$</span>bweight,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">min</span>(babies<span class="sc">$</span>bweight),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">to   =</span> <span class="fu">max</span>(babies<span class="sc">$</span>bweight),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">length.out =</span> <span class="dv">13</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Birthweight (g)"</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="cn">FALSE</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can superimpose a normal curve on the plot using the function curve().</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  babies<span class="sc">$</span>bweight,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">min</span>(babies<span class="sc">$</span>bweight),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">to   =</span> <span class="fu">max</span>(babies<span class="sc">$</span>bweight),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">length.out =</span> <span class="dv">13</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Birthweight (g)"</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="cn">FALSE</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dnorm</span>(x,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(babies<span class="sc">$</span>bweight),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(babies<span class="sc">$</span>bweight)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">add =</span> <span class="cn">TRUE</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>dnorm() is a function that will generate a normal curve for a given mean and standard deviation. Specifying the argument add=TRUE in curve() means the normal curve is superimposed on our histogram, not put in a new plot.</p>
<p>For a histogram of continuous quantitative data that are recorded as discrete quantities (e.g.&nbsp;maternal age), we may want to specify the bin width as 1. To do this we can use another sequence from minimum to maximum maternal age: seq(from=min(babies<span class="math inline">\(matage), to=max(babies\)</span>matage), by=1). Try the following:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  babies<span class="sc">$</span>matage,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">min</span>(babies<span class="sc">$</span>matage),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">to   =</span> <span class="fu">max</span>(babies<span class="sc">$</span>matage), </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">by   =</span> <span class="dv">1</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Maternal age (years)"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice the height of each bar now represents the frequency and not the density or the proportion in each group. To produce plots of cumulative distributions for quantitative data you can use the ecdf() function, which calculates the Empirical Cumulative Distribution Function.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ecdf</span>(babies<span class="sc">$</span>bweight),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">do.points =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">verticals =</span> <span class="cn">TRUE</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are two arguments specified in plot() that change how the ECDF is displayed. What happens if you change them from TRUE to FALSE or vice versa? The smallest value for bweight is 630g (we can obtain this using the command min(babies$bweight). We can see the value of the ECDF curve for this value by typing</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ecdf</span>(babies<span class="sc">$</span>bweight)(<span class="dv">630</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.001560062</code></pre>
</div>
</div>
<p>We see that for bweight=630, the value of the ECDF curve is 0.0015601 (that is 1/641, the number of babies in the dataset). You may wish to look at a few other values in this way.</p>
<p>To display a scatterplot of the relationship of the two continuous variables, we simply enter both variables in the plot command. Try this with birthweight and maternal age.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  babies<span class="sc">$</span>matage,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  babies<span class="sc">$</span>bweight, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Maternal age (years)"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Birthweight (g)"</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The scatter plot is used to help assess whether there appears to be an association between two quantitative variables, here birthweight and maternal age. This subject is discussed in greater detail in SC14 &amp; SC15, and in the associated practical WB14/15.</p>
</section>
</section>
<section id="exercises" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="exercises"><span class="header-section-number">3.4</span> Exercises</h2>
<p>Now use R to answer the following questions for the Babies dataset (the solutions are in Section 3). You will need to use the commands you learnt in Section 1.</p>
<ol type="1">
<li><p>Examine the data and determine the data type for each variable (eg. binary, nominal, ordered, quantitative discrete or continuous).<br>
</p></li>
<li><p>Produce frequency tables for sex and hypertension and use these to answer the following questions:<br>
</p></li>
</ol>
<!-- -->
<ol type="i">
<li>How many male infants were there?<br>
</li>
<li>How many mothers were hypertensive during pregnancy?<br>
</li>
</ol>
<!-- -->
<ol start="3" type="1">
<li>Now produce two-way table for hypertension and sex.<br>
</li>
</ol>
<!-- -->
<ol type="i">
<li>How many male infants were born to hypertensive mothers?<br>
</li>
</ol>
<!-- -->
<ol start="4" type="1">
<li>Produce a table to answer the following question.<br>
</li>
</ol>
<!-- -->
<ol type="i">
<li>What percentage of male infants were born to hypertensive mothers?<br>
</li>
</ol>
<!-- -->
<ol start="5" type="1">
<li><p>Obtain the mean, median and standard deviation for the three variables birthweight, maternal age and gestational age.<br>
</p></li>
<li><p>Produce a histogram for birthweight, maternal age and gestational age.<br>
</p></li>
</ol>
<!-- -->
<ol type="i">
<li>What can you conclude about the distribution of<br>
A. birthweight?<br>
B. maternal age?<br>
C. gestational age?<br>
</li>
<li>Do you think mean or median is the more appropriate measure of location for these three variables?<br>
</li>
</ol>
<!-- -->
<ol start="7" type="1">
<li>Produce a scatterplot of the relationship between birthweight and weeks of gestation.</li>
</ol>
</section>
<section id="extra-r-using-ggplot2" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="extra-r-using-ggplot2"><span class="header-section-number">3.5</span> Extra R: Using ggplot2</h2>
<p>As mentioned before, the plots in this practical were produced with base R. You can also make them with ‘ggplot2’, a versatile data visualisation package loaded as part of tidyverse. While the code for plots seems a bit more complicated to start with, this means you can change them to suit your needs much more easily, and the results often look nicer than base R plots.</p>
<p>Before we start, it will be useful to specify in this section that hypertension is a factor, not a numeric variable. Converting hyp to a factor tells R that 0 and 1 are categories, not quantities.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>babies<span class="sc">$</span>hyp<span class="ot">&lt;-</span><span class="fu">as.factor</span>(babies<span class="sc">$</span>hyp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>When making graphs with ggplot2, we first tell the ggplot() command what data to use, and then add another line following a + symbol to specify the plot that we want. For example, to generate a bar plot we use the following code.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(babies, <span class="fu">aes</span>(<span class="at">x =</span> hyp, <span class="at">fill =</span> hyp)) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Hypertension"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This tells ggplot() to use the babies data. The argument aes(x=hyp, fill=hyp) sets the variables we are using. In this case the x axis is set to refer to the hypertension variable, and the fill colour of the bars is too. The + symbol indicates there is more code added to this graph and geom_bar() makes a bar chart using the code. The line theme(legend.position=“none”) stops ggplot2 from putting a legend in the graph, as it is not needed here. The final line specifies the label on the x-axis.</p>
<p>ggplot performs some calculations and generates variables in the background while plotting. If we want to plot something more customised, like the percentage of mothers in each hypertension group, we can refer to these variables. For example, geom_bar() uses a variable ..count.. to represent the frequency of observations in each hypertension group, so we can specify that the variable y is a function of this.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(babies, <span class="fu">aes</span>(<span class="at">x =</span> hyp, <span class="at">fill =</span> hyp)) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(count <span class="sc">*</span> <span class="dv">100</span> <span class="sc">/</span> <span class="fu">sum</span>(count)))) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Hypertension"</span>) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Percent"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that we still set our calculated percentage as a variable in the graphy using aes(), just on a new line.</p>
<p>To make a histogram, we use a different “geom” function:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(babies, <span class="fu">aes</span>(<span class="at">x =</span> bweight)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Birthweight (grams)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>ggplot() will use the actual number of bars you specify using the bins argument! If you want it to represent density, you can use one of ggplot’s variables again, this time density.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(babies, <span class="fu">aes</span>(<span class="at">x =</span> bweight)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)), <span class="at">bins =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">"black"</span>,      </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Frequency density"</span>) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Birthweight (grams)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Both bar charts and histograms use “geom” functions in ggplot, but there are also “stat” functions which can compute statistics and plot them. One example is stat_ecdf() which plots the cumulative frequency curve.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(babies, <span class="fu">aes</span>(<span class="at">x =</span> bweight)) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>(<span class="at">geom =</span> <span class="st">"line"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We use the argument geom=“line” to tell the function how to plots the ECDF – using a line. What happens if you change “line” to “step” or “point”? The final chart in the practical was a scatter chart. For this we need to specify both x and y variables in the aes() argument and use the function geom_point().</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(babies, <span class="fu">aes</span>(<span class="at">x =</span> matage, <span class="at">y =</span> bweight)) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
<!-- ############################################################################### -->
<!-- #Chapter 4 -->
<!-- ############################################################################### -->
</section>
</section>
<section id="practical-wb05-inference-from-a-sample-mean" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Practical WB05: Inference from a sample mean</h1>
<p>In this session you are going to use the Babies data to illustrate the material presented in the CAL session SE05. In “Introduction to R” and in the practical session WB02 you saw how to do the following:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 78%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Task</strong></th>
<th style="text-align: left;"><strong>R function</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Import a csv file of data</td>
<td style="text-align: left;">import()</td>
</tr>
<tr class="even">
<td style="text-align: left;">Group data in a tibble</td>
<td style="text-align: left;">group_by()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Summary of one variable or all variables in the dataset</td>
<td style="text-align: left;">summary()</td>
</tr>
<tr class="even">
<td style="text-align: left;">Summarise data in a tibble</td>
<td style="text-align: left;">summarise()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Change a variable to a factor</td>
<td style="text-align: left;">as.factor()</td>
</tr>
<tr class="even">
<td style="text-align: left;">Recode a variable</td>
<td style="text-align: left;">recode()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Make a categorical variable from continuous</td>
<td style="text-align: left;">cut()</td>
</tr>
<tr class="even">
<td style="text-align: left;">Produce bar charts of categorical variables</td>
<td style="text-align: left;">barplot()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Produce histograms of continuous variables</td>
<td style="text-align: left;">hist()</td>
</tr>
<tr class="even">
<td style="text-align: left;">Produce scatter points of one or two variables</td>
<td style="text-align: left;">plot()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Round the value to a specified number of decimal points</td>
<td style="text-align: left;">round()</td>
</tr>
</tbody>
</table>
<section id="packages-needed-for-wb02-1" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="packages-needed-for-wb02-1"><span class="header-section-number">4.1</span> Packages needed for WB02</h2>
<p>In this session, you will need to make use of the tidyverse and rio packages, which you should have installed whilst working through the “Introduction to R” online session. If you have not yet downloaded these, please return to this session to remind yourself of how to action this. Remember, to install packages we make use of the install.packages() function.</p>
<p>You should now load these packages. Recall from the “Introduction to R” online session, we type the following:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Import the babies dataset</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>babies<span class="ot">&lt;-</span><span class="fu">import</span>(<span class="st">"babies.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exploring-data-using-the-summarise-function" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="exploring-data-using-the-summarise-function"><span class="header-section-number">4.2</span> Exploring data using the summarise function</h2>
<p>The summarise() function can be used to calculate basic summary statistics like mean, median, standard deviation, minimum, maximum, or count of a variable. In the examples below, we are interested in summarising the birth weight of the babies in the population from which this sample was drawn. We can display their mean birth weight by typing</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(babies, <span class="at">mean =</span> <span class="fu">mean</span>(bweight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      mean
1 3129.137</code></pre>
</div>
</div>
<p>You can calculate the standard deviation by typing</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(babies, <span class="at">sd =</span> <span class="fu">sd</span>(bweight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        sd
1 652.7827</code></pre>
</div>
</div>
<p>Median, minimum, and maximum bweight can be summarised as below</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(babies, <span class="at">median =</span> <span class="fu">median</span>(bweight)) <span class="co">#median birthweight</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  median
1   3200</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(babies, <span class="at">min =</span> <span class="fu">min</span>(bweight), <span class="at">max =</span> <span class="fu">max</span>(bweight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  min  max
1 630 4650</code></pre>
</div>
</div>
<p>We can display the four statistics together by typing:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(bweight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">SD =</span> <span class="fu">sd</span>(bweight, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="co">#na.rm=TRUE tells R to ignore missing values</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">median =</span> <span class="fu">median</span>(bweight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(bweight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(bweight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      mean       SD median min  max
1 3129.137 652.7827   3200 630 4650</code></pre>
</div>
</div>
<p>We can also use the summary() function</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(babies<span class="sc">$</span>bweight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    630    2850    3200    3129    3550    4650 </code></pre>
</div>
</div>
<p>This will display the min, max, first quantile, third quantile, mean, and median of bweight</p>
<p>We should then examine the distribution of bweight. We do this graphically with</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(babies<span class="sc">$</span>bweight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The distribution is fairly symmetrical, hence we can go ahead and compute the confidence interval for the sample mean using the methods based on the Normal or the t-distribution.</p>
</section>
<section id="confidence-interval-for-the-mean" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="confidence-interval-for-the-mean"><span class="header-section-number">4.3</span> Confidence interval for the mean</h2>
<p>For the 95% confidence interval of the mean birth weight using the t-distribution, we use the output from a one sample t-test</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(babies<span class="sc">$</span>bweight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  babies$bweight
t = 121.36, df = 640, p-value &lt; 2.2e-16
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 3078.507 3179.767
sample estimates:
mean of x 
 3129.137 </code></pre>
</div>
</div>
<p>The symbol $ shows that we are referring to the bweight column of our babies tibble. This produces more output than we need. If we are just interested in the confidence interval, we can extract this from the t.test results by typing</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(babies<span class="sc">$</span>bweight)<span class="sc">$</span>conf.int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3078.507 3179.767
attr(,"conf.level")
[1] 0.95</code></pre>
</div>
</div>
<p>This shows us just the confidence interval and the confidence level we used (in this case 0.95 indicates a 95% confidence interval). If we wished to have the 90% confidence intervals, we can use the argument conf.level=0.9 to specify that.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(babies<span class="sc">$</span>bweight, <span class="at">conf.level =</span> <span class="fl">0.9</span>)<span class="sc">$</span>conf.int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3086.666 3171.609
attr(,"conf.level")
[1] 0.9</code></pre>
</div>
</div>
<p>There are situations where we want to calculate a confidence interval but do not have direct access to the original data, but only to the sample size, the sample mean and the sample standard deviation. In R there is no function specifically for doing this, but we can calculate it using the formula:</p>
<p><span class="math display">\[
CI = \mu \pm 1.96 \times \frac{\theta}{\sqrt{n}}
\]</span></p>
<p>For example, if we only knew that the sample was size 641, the sample mean was 3129.137g and the standard deviation 652.7827g, we could set them as objects in our R environment by typing</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">641</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> <span class="fl">3129.137</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fl">652.7827</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can then use these in the formula to calculate the 95% confidence interval</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fl">1.96</span> <span class="sc">*</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> mean <span class="sc">-</span> error</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> mean <span class="sc">+</span> error</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>lower</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3078.602</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>upper</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3179.672</code></pre>
</div>
</div>
<p>Note that the sqrt() function calculates the square root of the object in brackets.</p>
<p>We usually write the interval in brackets, with upper and lower values separated by a comma or the word “to”:</p>
<p>“The mean birth weight is 3129.137g, 95%CI(3078.507, 3179.767)”</p>
<p>Or</p>
<p>“The mean birth weight is 3129.137g, 95%CI(3078.507 to 3179.767)”</p>
<p>This tells us that we are ninety-five percent confident that the true population mean is included in the interval 3078.507g to 3179.767g. (Note that it is ok to present to fewer significant figures, as long as the rounding is done correctly for example we could round to 1dp to give 3078.5g to 3179.8g, or even 0dp to give 3079g to 3180g.)</p>
<p>If you would like to round the results to one decimal place, use the round() function:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="fu">round</span>(lower, <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fu">round</span>(upper, <span class="at">digits =</span> <span class="dv">1</span>) </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>lower</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3078.6</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>upper</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3179.7</code></pre>
</div>
</div>
<p>The number 1.96 specifically calculates a 95% confidence interval; it represents the upper limit of the interval covering 95% of the standard normal distribution. If we wanted an 80% confidence interval we would have to use a different number. We can use the qnorm() function in R to calculate this and place it in our formula. For example, a 80% confidence interval covers from the 10th to 90th quantile of the standard normal distribution. We can calculate the value at the 90th quantile by typing.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.281552</code></pre>
</div>
</div>
<p>We can put this in our formula like this</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.9</span>) <span class="sc">*</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> mean <span class="sc">-</span> error</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> mean <span class="sc">+</span> error</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>lower</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3096.094</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>upper</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3162.18</code></pre>
</div>
</div>
<p>An alternative, if you wish to use the t distribution, is to replace the function qnorm() with qt(). If we wanted to calculate many confidence intervals for the mean we might wish to speed this up by writing our own function. There is some information about how to do this in the “Extra R” section at the end of this practical.</p>
</section>
<section id="hypothesis-testing-for-the-mean" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="hypothesis-testing-for-the-mean"><span class="header-section-number">4.4</span> Hypothesis testing for the mean</h2>
<p>If we wished to test the hypothesis that the mean birth weight of all babies was equal to 3200g, against the hypothesis that the mean was different from 3200g, we would type</p>
<p>The argument mu=3200 sets our null hypothesis that the mean is equal to 3200.</p>
<p>And the result would be:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(babies<span class="sc">$</span>bweight, <span class="at">mu =</span> <span class="dv">3200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  babies$bweight
t = -2.7484, df = 640, p-value = 0.006158
alternative hypothesis: true mean is not equal to 3200
95 percent confidence interval:
 3078.507 3179.767
sample estimates:
mean of x 
 3129.137 </code></pre>
</div>
</div>
<p>This prints the p-value for a two-sided test in the output. If we want a one sided test, we should use the argument alternative=“less” or alternative=“greater” to specify our alternative hypothesis. For example,</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(babies<span class="sc">$</span>bweight, <span class="at">mu =</span> <span class="dv">3200</span>, <span class="at">alternative =</span> <span class="st">"less"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  babies$bweight
t = -2.7484, df = 640, p-value = 0.003079
alternative hypothesis: true mean is less than 3200
95 percent confidence interval:
     -Inf 3171.609
sample estimates:
mean of x 
 3129.137 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(babies<span class="sc">$</span>bweight, <span class="at">mu =</span> <span class="dv">3200</span>, <span class="at">alternative =</span> <span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  babies$bweight
t = -2.7484, df = 640, p-value = 0.9969
alternative hypothesis: true mean is greater than 3200
95 percent confidence interval:
 3086.666      Inf
sample estimates:
mean of x 
 3129.137 </code></pre>
</div>
</div>
<p>Note that R compares the test statistic with the t-distribution, not the Normal distribution, even when the sample size is large. As we know, when the degrees of freedom are as large as in this example, comparing the test statistics with the Normal distribution or with the t-distribution leads to the same conclusions.</p>
</section>
<section id="exercises-1" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="exercises-1"><span class="header-section-number">4.5</span> Exercises</h2>
<p>Have a go on your own now (the solutions are in Section 3).<br>
</p>
<p>Import the Whitehall data set, whall10.csv, and familiarise yourself with the data. A brief description is in the Appendix.<br>
</p>
<ol type="1">
<li><p>How many records are held in the data set? Are there any missing values for the variables id, sbp and chol?<br>
</p></li>
<li><p>Compute the sample mean systolic blood pressure and its 95% confidence interval. Look at the distribution of systolic blood pressure to assess whether or not you think it is appropriate to use the mean in this case.<br>
</p></li>
<li><p>Do the same for cholesterol level.<br>
</p></li>
<li><p>Test whether the population systolic blood pressure (that is the systolic blood pressure of all civil servants in the UK) is equal to 135mmHg or different from 135mmHg. What is the P-value? How would you report the result?<br>
</p></li>
<li><p>Test whether the population cholesterol level is equal to 190mg/dl or different from 190mg/dl. What is the P-value? How would you report the result?<br>
</p></li>
</ol>
</section>
<section id="extra-r-writing-your-own-confidence-interval-function" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="extra-r-writing-your-own-confidence-interval-function"><span class="header-section-number">4.6</span> Extra R: writing your own confidence interval function</h2>
<p>It is common for R users to write their own functions to automatically carry out calculations and operations they use a lot as this saves time. Functions are R objects, and to define them we must give them a name. For example:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>confidence.interval <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>defines a function called confidence.interval(). If we want this to calculate a confidence interval for the mean using a normal distribution, we can add the equation we used earlier inside the curly brackets.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>confidence.interval <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a> error <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a> lower <span class="ot">&lt;-</span> mean <span class="sc">-</span> error</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a> upper <span class="ot">&lt;-</span> mean <span class="sc">+</span> error</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For this to calculate the 95% confidence interval, we need to specify the mean (mean), standard deviation (sd) and sample size (n) when we run our function, so we add them as arguments by putting them in the brackets after the word function.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>confidence.interval <span class="ot">&lt;-</span> <span class="cf">function</span>(mean, sd, n){</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a> error <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a> lower <span class="ot">&lt;-</span> mean <span class="sc">-</span> error</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a> upper <span class="ot">&lt;-</span> mean <span class="sc">+</span> error</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a> lower</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a> upper</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We also need to tell our function to send us the results (lower and upper) when it has calculated them. We do this by putting lower and upper in one vector called CI and using the function return() to set CI as the output of the function.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>confidence.interval <span class="ot">&lt;-</span> <span class="cf">function</span>(mean, sd, n){</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a> error <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a> lower <span class="ot">&lt;-</span> mean <span class="sc">-</span> error</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a> upper <span class="ot">&lt;-</span> mean <span class="sc">+</span> error</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a> CI <span class="ot">&lt;-</span> <span class="fu">c</span>(lower, upper)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(CI)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that putting c() around numbers or objects separated by commas turns them into a vector.</p>
<p>This will now calculate a 95% confidence interval for a given mean, standard deviation and sample size like this:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confidence.interval</span>(<span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">4</span>, <span class="at">n =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  9.216014 10.783986</code></pre>
</div>
</div>
<p>If we want to set a confidence limit, we can include this as an argument and use this to change the number 0.975 in our equation.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>confidence.interval <span class="ot">=</span> <span class="cf">function</span>(mean, sd, n, conf.limit){</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a> qnorm.input <span class="ot">=</span> <span class="fl">0.5</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> conf.limit</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a> error <span class="ot">=</span> <span class="fu">qnorm</span>(qnorm.input) <span class="sc">*</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a> lower <span class="ot">=</span> mean <span class="sc">-</span> error</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a> upper <span class="ot">=</span> mean <span class="sc">+</span> error</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a> CI <span class="ot">=</span> <span class="fu">c</span>(lower, upper)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(CI)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that we have added a line that calculates the appropriate quantile of the Normal distribution to input into qnorm().</p>
<p>Now we can calculate any confidence interval using a normal distribution.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confidence.interval</span>(<span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">4</span>, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">conf.limit =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  9.216014 10.783986</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confidence.interval</span>(<span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">4</span>, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">conf.limit =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  9.342059 10.657941</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confidence.interval</span>(<span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">4</span>, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">conf.limit =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  9.487379 10.512621</code></pre>
</div>
</div>
</section>
</section>
<section id="practical-wb06-comparison-of-two-means" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Practical WB06: Comparison of two means</h1>
<p>In this session you are going to analyse paired and unpaired data collected on quantitative variables and practice what you learnt in CAL session SC06.</p>
<ul>
<li>With paired data we are interested in the mean difference between observations taken on the same subjects.</li>
<li>With unpaired data we are interested in the difference between the means observed in two independent samples.</li>
</ul>
<p>We will use two different data sets to learn how to deal with these two types of problems. The data sets are: (a) the skinfold measurements introduced in SC08 and, (b) the Babies data.</p>
<section id="packages-needed-for-wb02-2" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="packages-needed-for-wb02-2"><span class="header-section-number">5.1</span> Packages needed for WB02</h2>
<p>In this session, you will need to make use of the tidyverse and rio packages, which you should have installed whilst working through the “Introduction to R” online session. If you have not yet downloaded these, please return to this session to remind yourself of how to action this. Remember, to install packages we make use of the install.packages() function.</p>
<p>You should now load these packages. Recall from the “Introduction to R” online session, we type the following:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="paired-data" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="paired-data"><span class="header-section-number">5.2</span> Paired data</h2>
<p><strong>Import the skinfold dataset</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>skinf<span class="ot">&lt;-</span><span class="fu">import</span>(<span class="st">"skinf.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The data file is called skinf.csv and is described in the Appendix. It consists of skinfold measurements (in mm) taken on 15 subjects on two occasions, during the harvest and the planting season, respectively. The measurements are described as “paired”, with each pair consisting of 2 measures of skinfold thickness for the same person taken at different times. The two measurements are called skin1 and skin2.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>skinf <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_skin1 =</span> <span class="fu">mean</span>(skin1), </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">med_skin1 =</span> <span class="fu">median</span>(skin1), </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_skin2 =</span> <span class="fu">mean</span>(skin2), </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">med_skin2 =</span> <span class="fu">median</span>(skin2)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  mean_skin1 med_skin1 mean_skin2 med_skin2
1   23.84667      20.8   21.56667      18.6</code></pre>
</div>
</div>
<p>Or type</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(skinf<span class="sc">$</span>skin1); <span class="fu">summary</span>(skinf<span class="sc">$</span>skin2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  14.60   18.70   20.80   23.85   29.35   39.90 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  14.00   16.60   18.60   21.57   26.25   34.60 </code></pre>
</div>
</div>
<p>The last command produces the output showing that the distribution of the two measurements are partly skewed, as the mean and median of each measure differ. The mean of skin1 is 23.8mm (rounded) and the median is 20.8mm. For skin2, the mean is 21.6mm and the median is 18.6mm.</p>
</section>
<section id="confidence-interval-for-the-mean-difference" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="confidence-interval-for-the-mean-difference"><span class="header-section-number">5.3</span> Confidence interval for the mean difference</h2>
<p>We are interested in the mean difference between the two observations taken on each individual. In the last practical we used the function t.test() to view confidence intervals. We can do this with two samples, too, making sure to specify that the data are paired.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(skinf<span class="sc">$</span>skin1, skinf<span class="sc">$</span>skin2, <span class="at">paired =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>conf.int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.031805 3.528196
attr(,"conf.level")
[1] 0.95</code></pre>
</div>
</div>
<p>Alternatively, we could generate a variable representing the difference between skin1 and skin2.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>dif <span class="ot">&lt;-</span> skinf<span class="sc">$</span>skin1 <span class="sc">-</span> skinf<span class="sc">$</span>skin2</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(dif); <span class="fu">median</span>(dif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.280001</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>Note that we examine the distribution of dif so that we can assess whether the distribution of the individual differences is symmetrical. In this case, the mean and median are not too different, considering the size of the sample. So, we proceed and compute a confidence interval for the mean difference using the properties of the t-distribution. The command is:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(dif)<span class="sc">$</span>conf.int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.031805 3.528196
attr(,"conf.level")
[1] 0.95</code></pre>
</div>
</div>
<p>This gives the same result as before.</p>
<section id="reporting-and-interpreting-the-confidence-interval" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="reporting-and-interpreting-the-confidence-interval"><span class="header-section-number">5.3.1</span> Reporting and interpreting the confidence interval</h3>
<p>The interval should be written as follows:</p>
<p>“The mean difference in skin thickness between the 2 seasons is 2.28mm, 95%CI (1.03, 3.53)”</p>
<p>Therefore we are ninety-five percent confident that the interval 1.03mm to 3.52mm includes the true population mean difference.</p>
<p>If we wished to have the 90% confidence interval, we would use the argument conf.level</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(dif, <span class="at">conf.level =</span> <span class="fl">0.9</span>)<span class="sc">$</span>conf.int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.254976 3.305025
attr(,"conf.level")
[1] 0.9</code></pre>
</div>
</div>
<p>To view the results of the t-test, and test whether the population difference is equal to zero, we type</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(dif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  dif
t = 3.9177, df = 14, p-value = 0.001547
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 1.031805 3.528196
sample estimates:
mean of x 
 2.280001 </code></pre>
</div>
</div>
<p>Like the previous practical, the results are for a 2-sided test. This can be modified using the alternative argument.</p>
<p>Alternatively, as the data are paired we may use the following command:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(skinf<span class="sc">$</span>skin1, skinf<span class="sc">$</span>skin2, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Paired t-test

data:  skinf$skin1 and skinf$skin2
t = 3.9177, df = 14, p-value = 0.001547
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 1.031805 3.528196
sample estimates:
mean difference 
       2.280001 </code></pre>
</div>
</div>
<p>Compare the results of the 2 different approaches - they are identical!</p>
</section>
<section id="reporting-and-interpreting-the-significance-test" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="reporting-and-interpreting-the-significance-test"><span class="header-section-number">5.3.2</span> Reporting and interpreting the significance test</h3>
<p>Presentation of results should be along the following lines:</p>
<p>“A t-test shows strong evidence against the null hypothesis of no difference in skin thickness between the two seasons. (P=0.0015)”</p>
<p>Or less formally,</p>
<p>“There is strong evidence that in the population represented by our sample, difference in skin thickness between the two seasons is not 0 mm (P=0.0015)”</p>
<p>Finding a mean difference as great as 2.28 is very unlikely by chance, if the true mean difference in the population is 0mm. We are therefore inclined to believe that the true mean difference is not 0mm.</p>
<p>Note that the confidence interval and p-value are both derived from the standard error and size of difference, so are closely related. If a 95% confidence interval does not include the value specified in the null hypothesis, then the p-value obtained from a hypothesis test will be less than 0.05. Conversely, if a 95% confidence interval does include the value specified in the null hypothesis then the p-value obtained from a hypothesis test will be greater than 0.05. In the example above, the 95% confidence interval excludes 0mm and the significance test yields a p-value of less than 0.05. These two results virtually always go together.</p>
</section>
</section>
<section id="unpaired-data" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="unpaired-data"><span class="header-section-number">5.4</span> Unpaired data</h2>
<p>To compare the mean values of a quantitative variable observed in two independent groups, we would first describe the data separately in the two groups. We will use the Babies data set again to demonstrate this. Type</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>babies<span class="ot">&lt;-</span><span class="fu">import</span>(<span class="st">"babies.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In WB05, you learned how to use the summarise() function to summarise quantitative variables like birthweight. You calculated the mean, median, minimum, and maximum birthweight for the entire sample.</p>
<p>Now, we will take it a step further. Instead of just looking at the overall mean, we will compare the mean birthweight between different groups. To do this, we use the group_by() function which tells R to summarise the data by groups of a second variable. For example, if we wished to compare the birth weight of boys and girls, we would type</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">|&gt;</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">|&gt;</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Freq. =</span> <span class="fu">length</span>(bweight), </span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">mean</span>(bweight), </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fu">sd</span>(bweight),</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">median =</span> <span class="fu">median</span>(bweight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
    sex Freq.  mean    sd median
  &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1     1   315 3044.  629.   3120
2     2   326 3211.  666.   3290</code></pre>
</div>
</div>
<p>The result consists of the sample means, their standard deviations and their medians, separately by sex of the infant. The comparison of means and medians allows us to assess whether the birth weight distribution is symmetrical in both groups. It appears to be so, as the mean and median are reasonably similar within each sex. We may then test the hypothesis that the population mean birth weights of all baby boys and baby girls are the same.</p>
<p>It is important to note that when using the t.test() command for two paired variables, the variables should be separated by a comma “,” while when we want to compare two groups (unpaired), the variables are separated by a tilde “~” with the grouping variable coming after the “~”.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(babies<span class="sc">$</span>bweight <span class="sc">~</span> babies<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  babies$bweight by babies$sex
t = -3.2686, df = 638.65, p-value = 0.001139
alternative hypothesis: true difference in means between group 1 and group 2 is not equal to 0
95 percent confidence interval:
 -267.57246  -66.73186
sample estimates:
mean in group 1 mean in group 2 
       3044.127        3211.279 </code></pre>
</div>
</div>
<p>These results may be interpreted as follows:</p>
<p>A t-test suggests strong evidence against the null hypothesis of no difference in birthweights between boys and girls (P=0.0011). On average boys in this sample are born weighing 167.15g less than girls with 95% confidence interval -267.57g to -66.73g. Therefore we are 95% certain that the population value for this difference lies between -267.57g and -66.73g.</p>
</section>
<section id="exercises-2" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="exercises-2"><span class="header-section-number">5.5</span> Exercises</h2>
<p>Have a go on your own (the solutions are in Section 3).</p>
<ol type="1">
<li><p>The dataset called diabk.csv holds the data on 15 diabetic patients who were involved in an educational programme to improve their diet (see Appendix). Their average daily calories intake was measured one week before and one week after the intervention. The two measurements are called kcal1 and kcal2. Import and examine the data.</p></li>
<li><p>Compute the sample mean difference in calorie intake before and after the intervention, examine its distribution and then calculate its 95% confidence interval. Test whether the mean difference is equal to 0 kcal/day. Interpret your results and comment on any relationship between the P-value and the confidence interval.</p></li>
<li><p>Import into R the babies data (hint import is the command for importing the babies data into R). Compute separately the sample mean birthweight of babies born to mothers who suffered, or did not suffer, from hypertension during pregnancy. Obtain a 95% confidence interval for the mean difference in birthweight between the 2 groups and test whether the mean difference is equal to 0g. Report your results.</p></li>
</ol>
</section>
</section>
<section id="practical-wb07-inference-from-a-sample-proportion" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Practical WB07: Inference from a sample proportion</h1>
<p>In this session you are going to use the Whitehall data to practice what you learnt in CAL session SE07. In sessions WB05 and WB06 you saw how to:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Task</strong></th>
<th><strong>R function</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Compute a confidence interval around a mean</td>
<td>t.test(x)conf.int</td>
</tr>
<tr class="even">
<td>Test the hypothesis that the mean is equal to a given value</td>
<td>t.test(x)</td>
</tr>
<tr class="odd">
<td>Compute a confidence interval around a mean difference,</td>
<td>t.test(x,y, paired = T)$conf.int</td>
</tr>
<tr class="even">
<td>obtained from paired data</td>
<td></td>
</tr>
<tr class="odd">
<td>Test the hypothesis that the mean difference is equal to</td>
<td>t.test(x,y, paired=T)</td>
</tr>
<tr class="even">
<td>zero</td>
<td></td>
</tr>
<tr class="odd">
<td>Compute a confidenc interval around the difference</td>
<td>t.test(x~y)</td>
</tr>
<tr class="even">
<td>between two independent means and test the hypothesis</td>
<td></td>
</tr>
<tr class="odd">
<td>that they are</td>
<td></td>
</tr>
</tbody>
</table>
<p>Now you are going to use R to compute the confidence interval around a sample proportion and to test whether this proportion is equal to a specific value.</p>
<p><strong>Load the packages required for this session</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Import the Whitehall data</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="ot">&lt;-</span><span class="fu">import</span>(<span class="st">"whall10.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="confidence-interval-for-the-proportion" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="confidence-interval-for-the-proportion"><span class="header-section-number">6.1</span> Confidence interval for the proportion</h2>
<p>We are interested in the proportion of current smokers among the sample of British civil servants. The variable smok holds the information about smoking. It is coded: 1=never; 2=ex-smoker; 3=1-14 cigs/day; 4=15-24 cigs/day; 5=25+ cigs/day. So, to find out the proportion of current smokers we need to generate a new variable, currsm, as follows:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>whitehall <span class="ot">&lt;-</span> whitehall <span class="sc">|&gt;</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">currsm =</span> <span class="fu">case_when</span>(</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>      smok <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>      smok <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The mutate() function generates a new column in the whitehall tibble which we have called currsm. We recoded the values of smok in order (from 1 to 5) as 0, 0, 1, 1 and 1 so never and ex-smokers are coded as 0, and current smokers of 1 or more cigarettes per day are coded as 1.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>smok, </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>      whitehall<span class="sc">$</span>currsm,</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">useNA =</span> <span class="st">"ifany"</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
      0   1
  1 317   0
  2 646   0
  3   0 310
  4   0 279
  5   0 125</code></pre>
</div>
</div>
<p>The last command should confirm that our instructions are correct.</p>
<p>In WB06, you learned how to use the group_by() and summarise() functions to compare the mean birth weight between groups when working with unpaired data.</p>
<p>Here, we will learn how to use the same approach to summarise binary variables. We will also introduce the mutate() function, which can add new columns to our summary table. In this case, we will use it to calculate the percentage of individuals in each group. Use the code below to summarise the proportion of current smokers using the following command:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>whitehall <span class="sc">|&gt;</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(currsm) <span class="sc">|&gt;</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">freq =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> freq <span class="sc">/</span> <span class="fu">sum</span>(freq)</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  currsm  freq percent
   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1      0   963    57.4
2      1   714    42.6</code></pre>
</div>
</div>
<p>The last line of this command adds an extra column to our summary table, calculated from values of the freq column.</p>
<p>To compute the 95% confidence intervals for the proportion of current smokers, we need to input the information shown above into the binom.test() command:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binom.test</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">714</span>,<span class="dv">963</span>))<span class="sc">$</span>conf.int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4019444 0.4498364
attr(,"conf.level")
[1] 0.95</code></pre>
</div>
</div>
<p>Where x is a vector of the number of current and then not-current smokers.</p>
<section id="interpretation-of-the-confidence-interval" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="interpretation-of-the-confidence-interval"><span class="header-section-number">6.1.1</span> Interpretation of the confidence interval</h3>
<p>The proportion of current smokers is 0.43, 95%CI (0.40,0.45). Alternatively we can say that the percentage of current smokers is 43%, 95% CI (40%, 45%). We are 95% confident that the interval 40% to 45% includes the population proportion of current smokers.</p>
<p>If we wished to have the 90% confidence intervals, we would type,</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binom.test</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">714</span>,<span class="dv">963</span>), </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">conf.level =</span> <span class="fl">0.9</span>)<span class="sc">$</span>conf.int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4057092 0.4460040
attr(,"conf.level")
[1] 0.9</code></pre>
</div>
</div>
<p>If we want to do this without directly inputting the data, we can use a pipeline</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binom.test</span>(<span class="at">x =</span> (whitehall <span class="sc">|&gt;</span> </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">group_by</span>(currsm) <span class="sc">|&gt;</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarise</span>(<span class="at">freq =</span> <span class="fu">n</span>()))<span class="sc">$</span>freq[<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Exact binomial test

data:  (summarise(group_by(whitehall, currsm), freq = n()))$freq[2:1]
number of successes = 714, number of trials = 1677, p-value = 1.305e-09
alternative hypothesis: true probability of success is not equal to 0.5
95 percent confidence interval:
 0.4019444 0.4498364
sample estimates:
probability of success 
             0.4257603 </code></pre>
</div>
</div>
<p>This takes the frequencies of current smokers and non-smokers from the summary table and adds them as arguments to the binom.test() command. It obtains the same results as before.</p>
</section>
</section>
<section id="hypothesis-testing-for-the-proportion" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="hypothesis-testing-for-the-proportion"><span class="header-section-number">6.2</span> Hypothesis testing for the proportion</h2>
<p>If we wished to test the hypothesis that the proportion of current smokers was 40%, against the hypothesis that it was different from 40%, we would type, and then read the P-value from the output.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="at">x =</span> <span class="dv">714</span>, </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">714</span> <span class="sc">+</span> <span class="dv">963</span>, </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">p =</span> <span class="fl">0.4</span>, </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    1-sample proportions test without continuity correction

data:  714 out of 714 + 963, null probability 0.4
X-squared = 4.6369, df = 1, p-value = 0.03129
alternative hypothesis: true p is not equal to 0.4
95 percent confidence interval:
 0.4022912 0.4495687
sample estimates:
        p 
0.4257603 </code></pre>
</div>
</div>
<p>We conclude that there is some evidence (p=0.0321) to suggest that in the population from which our sample was taken, the population of current smokers is not equal to 0.4</p>
</section>
<section id="exercises-3" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="exercises-3"><span class="header-section-number">6.3</span> Exercises</h2>
<p>Have a go on your own now (the solutions are in Section 3).<br>
</p>
<ol type="1">
<li><p>Using the Whitehall data examine the proportion of civil servants who had systolic blood pressure lower than 120mmHg. First look at the observations in the variable sbp, which represents systolic blood pressure, to make sure there are no strange or missing values. Then generate a variable called lowsbp that tells us if blood pressure is lower than 120mmHg.<br>
</p></li>
<li><p>Compute the 95% confidence interval for the proportion of civil servants with low SBP, and test the hypothesis that the proportion of civil servants with low SBP is 20%. Interpret your results.<br>
</p></li>
<li><p>Now generate a variable called highsbp which equals 1 if blood presure is greater than or equal to 160mmHg.<br>
</p></li>
<li><p>Compute the 95% confidence interval for the proportion of civil servants with high SBP, and test the hypothesis that the proportion of civil servants with high SBP is 10%. Interpret your results.</p></li>
</ol>
</section>
</section>
<section id="practical-wb08-comparison-of-two-proportions" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Practical WB08: Comparison of two proportions</h1>
<p>In this session you are going to compare proportions in two independent samples to practice what you learnt in CAL session SE08.</p>
<p>You will use the Whitehall data again and compare the proportion of current smokers in civil servants with different employment grades. The employment grade information is held in the variable called grade and is classified as: 1= high grade (i.e., administrative), 2=low grade (i.e., clerical).</p>
<section id="comparing-two-proportions" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="comparing-two-proportions"><span class="header-section-number">7.1</span> Comparing two proportions</h2>
<p><strong>Load the packages required for this session</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Import the Whitehall data.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>whitehall <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"whall10.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In this dataset the variable smoke indicates the smoking status of study subjects, indicating how many cigarettes they currently smoke a day, or if they are former smokers or have never smoked. We use the following command to look at the distribution of smoke:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>whitehall <span class="sc">|&gt;</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(smok) <span class="sc">|&gt;</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">freq =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> freq <span class="sc">/</span> <span class="fu">sum</span>(freq))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
   smok  freq percent
  &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;
1     1   317   18.9 
2     2   646   38.5 
3     3   310   18.5 
4     4   279   16.6 
5     5   125    7.45</code></pre>
</div>
</div>
<p>To investigate current smokers with never/ex smokers we need to generate a new variable. Do you remember how to do it? If not, follow the instructions below.</p>
<p>To generate the variable that holds the information on “current smoking” status we do the following:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>whitehall <span class="ot">&lt;-</span> whitehall <span class="sc">|&gt;</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">currsm =</span> <span class="fu">case_when</span>(</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>    smok <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>    smok <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Re-level categories</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>currsm <span class="ot">=</span> <span class="fu">factor</span>(</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  whitehall<span class="sc">$</span>currsm,</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>So, for never and ex-smokers (for which smok = 1 or 2) the variable currsm takes the value of 0, and for smokers of one or more cigarettes per day the variable currsm takes the value of 1.</p>
<p>Again, it is a good idea to check that our new variable, currsm, is coded as intended:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>smok, whitehall<span class="sc">$</span>currsm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
      1   0
  1   0 317
  2   0 646
  3 310   0
  4 279   0
  5 125   0</code></pre>
</div>
</div>
<p>Yes! It looks like the values of currsm do correspond to the values of smok, as intended.</p>
<p>We are interested in the difference between the proportion of current smokers observed in High and Low employment grade. We can use CrossTable() function</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(whitehall<span class="sc">$</span>currsm,</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>           whitehall<span class="sc">$</span>grade,</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.r =</span> <span class="cn">FALSE</span>,</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.c =</span> <span class="cn">TRUE</span>, </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.t =</span> <span class="cn">FALSE</span>,</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.chisq =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|           N / Col Total |
|-------------------------|

 
Total Observations in Table:  1677 

 
                 | whitehall$grade 
whitehall$currsm |         1 |         2 | Row Total | 
-----------------|-----------|-----------|-----------|
               1 |       436 |       278 |       714 | 
                 |     0.365 |     0.576 |           | 
-----------------|-----------|-----------|-----------|
               0 |       758 |       205 |       963 | 
                 |     0.635 |     0.424 |           | 
-----------------|-----------|-----------|-----------|
    Column Total |      1194 |       483 |      1677 | 
                 |     0.712 |     0.288 |           | 
-----------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p>36.5% of high grade (grade = 1) civil servants and 57.6% of low grade (grade = 2) civil servants are current smokers.</p>
<p>Note that we use the prop.c=TRUE option to obtain column percentages, since we want the percentage of current smokers in each employment group.</p>
</section>
<section id="confidence-interval-and-hypothesis-testing" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="confidence-interval-and-hypothesis-testing"><span class="header-section-number">7.2</span> Confidence interval and hypothesis testing</h2>
<p>We are interested in the difference between the proportions of current non-smokers among High and Low employment grade. We can use the prop.test() function on a 2x2 table to obtain the difference in proportions, its 95% confidence interval and the test of whether the two proportions are different.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>grade,</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>      whitehall<span class="sc">$</span>currsm) <span class="sc">|&gt;</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prop.test</span>(<span class="at">conf.level =</span> <span class="fl">0.95</span>,</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    2-sample test for equality of proportions without continuity correction

data:  table(whitehall$grade, whitehall$currsm)
X-squared = 62.272, df = 1, p-value = 2.991e-15
alternative hypothesis: two.sided
95 percent confidence interval:
 -0.2622633 -0.1585572
sample estimates:
   prop 1    prop 2 
0.3651591 0.5755694 </code></pre>
</div>
</div>
<p>The sample difference in the proportion of non-smokers between high and low grade is -0.21 with 95% confidence interval (-0.26 to -0.16). That is the sample proportion (or percentage) of current smokers is 0.21 (or 21%) less among the high grade civil servants than among the low grade civil servants. In the population of civil servants we are 95% certain that this difference lies between 0.16 and 0.26. The chi-squared test suggests strong evidence against the null hypothesis of no difference in proportion of current smokers between high and low grade civil servants (P&lt;0.001).</p>
<p>If we wished to have 90% confidence intervals, we would type,</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>grade, whitehall<span class="sc">$</span>currsm) <span class="sc">|&gt;</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.test</span>(<span class="at">conf.level =</span> <span class="fl">0.9</span>, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    2-sample test for equality of proportions without continuity correction

data:  table(whitehall$grade, whitehall$currsm)
X-squared = 62.272, df = 1, p-value = 2.991e-15
alternative hypothesis: two.sided
90 percent confidence interval:
 -0.2539267 -0.1668938
sample estimates:
   prop 1    prop 2 
0.3651591 0.5755694 </code></pre>
</div>
</div>
<p>We can obtain the Z statistic by typing</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.test</span>(</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">table</span>(</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>      whitehall<span class="sc">$</span>grade,</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>      whitehall<span class="sc">$</span>currsm</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">correct =</span> <span class="cn">FALSE</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>statistic</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>X-squared 
 7.891269 </code></pre>
</div>
</div>
</section>
<section id="exercises-4" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="exercises-4"><span class="header-section-number">7.3</span> Exercises</h2>
<p>Have a go on your own now (the solutions are in Section 3).<br>
</p>
<ol type="1">
<li><p>Examine whether the proportion of current smokers differs between civil servants with or without high systolic blood pressure. To do this you will need to create again the variable highsbp (see exercises for WB09).<br>
</p></li>
<li><p>Compute the 90% confidence interval for the difference in these proportions and test whether the difference is equal to zero.<br>
</p></li>
<li><p>Import the Mwanza dataset into R. This is an unmatched case-control study of HIV infection in women living in Mwanza, Tanzania. A short description is in the Appendix.<br>
</p></li>
<li><p>Examine the distribution of the variable npa, number of life-time sexual partners and of the variable case, the case/control indicator. (Hint: make sure you understand the coding of npa before you go on to Q5!)<br>
</p></li>
<li><p>Create a new variable called np5, for “At least 5 sexual partners”.<br>
</p></li>
<li><p>Compare this proportion of women who had at least 5 sexual partners separately in cases and controls. Compute the 95% confidence interval for the difference in these proportions. Are they significantly different? Interpret your results.</p></li>
</ol>
</section>
</section>
<section id="practical-wb09-association-between-two-categorical-variables" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Practical WB09: Association between two categorical variables</h1>
<p>In this session you are going to use R to examine the association between two categorical variables. The statistical methods to do this are discussed in CAL session SE09.</p>
<p>The data you will use is called mwanza.csv. The data is from a study of risk factors for HIV infection in women in Mwanza, Tanzania. Details of the study are given in the Appendix.</p>
<p><strong>Load the packages required for this session</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Import the Mwanza data.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>mwanza<span class="ot">&lt;-</span><span class="fu">import</span>(<span class="st">"mwanza.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Examine the variables in the dataset.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mwanza)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      idno              comp             case             age1      
 Min.   : 112041   Min.   : 1.000   Min.   :0.0000   Min.   :1.000  
 1st Qu.: 477018   1st Qu.: 4.000   1st Qu.:0.0000   1st Qu.:2.000  
 Median : 753013   Median : 7.000   Median :0.0000   Median :3.000  
 Mean   : 743214   Mean   : 6.979   Mean   :0.2477   Mean   :3.448  
 3rd Qu.:1043063   3rd Qu.:10.000   3rd Qu.:0.0000   3rd Qu.:5.000  
 Max.   :1284019   Max.   :12.000   Max.   :1.0000   Max.   :6.000  
       ed             eth             rel             msta      
 Min.   :1.000   Min.   :1.000   Min.   :1.000   Min.   :1.000  
 1st Qu.:1.000   1st Qu.:1.000   1st Qu.:2.000   1st Qu.:1.000  
 Median :2.000   Median :1.000   Median :3.000   Median :1.000  
 Mean   :2.098   Mean   :1.539   Mean   :2.708   Mean   :1.482  
 3rd Qu.:3.000   3rd Qu.:2.000   3rd Qu.:3.000   3rd Qu.:1.000  
 Max.   :4.000   Max.   :9.000   Max.   :9.000   Max.   :9.000  
      bld             inj             skin            fsex      
 Min.   :1.000   Min.   :1.000   Min.   :1.000   Min.   :1.000  
 1st Qu.:1.000   1st Qu.:1.000   1st Qu.:1.000   1st Qu.:2.000  
 Median :1.000   Median :2.000   Median :2.000   Median :2.000  
 Mean   :1.055   Mean   :2.334   Mean   :1.561   Mean   :2.666  
 3rd Qu.:1.000   3rd Qu.:3.000   3rd Qu.:2.000   3rd Qu.:2.000  
 Max.   :9.000   Max.   :9.000   Max.   :9.000   Max.   :9.000  
      npa             pa1            usedc             ud       
 Min.   :1.000   Min.   :1.000   Min.   :1.000   Min.   :1.000  
 1st Qu.:1.000   1st Qu.:2.000   1st Qu.:1.000   1st Qu.:1.000  
 Median :2.000   Median :2.000   Median :1.000   Median :1.000  
 Mean   :2.269   Mean   :2.072   Mean   :1.051   Mean   :1.194  
 3rd Qu.:3.000   3rd Qu.:2.000   3rd Qu.:1.000   3rd Qu.:1.000  
 Max.   :9.000   Max.   :9.000   Max.   :9.000   Max.   :9.000  
      ark             srk       
 Min.   :1.000   Min.   :1.000  
 1st Qu.:2.000   1st Qu.:1.000  
 Median :2.000   Median :2.000  
 Mean   :2.274   Mean   :2.199  
 3rd Qu.:3.000   3rd Qu.:3.000  
 Max.   :4.000   Max.   :4.000  </code></pre>
</div>
</div>
<p>The summary() function is a quick way to explore the characteristics of all variables in your dataset. It produces a summary table with one column per variable and one row per statistic, including the minimum, 1st quartile, median, mean, 3rd quartile, and maximum for each variable.Display and interpretation of a two way table</p>
<p>First you are going to examine the relationship between marital status (msta) and the number of sexual partners in the past year (pa1).</p>
<p>The variable msta is coded as follows: 1=currently married, 2=divorced or widowed, 3= never married, 9=information missing.</p>
<p>The variable pa1 is coded as follows: 1=no sexual partner in last year, 2=1 sexual partner, 3=2 sexual partners, 4=3 or 4 sexual partners, 5=5 or more sexual partners in last year, 9=information missing.</p>
<p>It would be useful for R to know this information, so we can add it to the variables as labels using the factor() function. The variables are converted to factors so that R treats the levels as categories rather than numerical values. This helps produce appropriate summaries and tables. Labels are added to make the results easier to read.</p>
<p>To make the variables msta and pa1 factors and apply the labels, type</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>mwanza<span class="sc">$</span>msta <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  mwanza<span class="sc">$</span>msta, </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">9</span>),</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"currently married"</span>,</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"divorced or widowed"</span>,</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"never married"</span>,</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"information missing"</span>)</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>mwanza<span class="sc">$</span>pa1<span class="ot">&lt;-</span><span class="fu">factor</span>(</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  mwanza<span class="sc">$</span>pa1, </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>),</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"no sexual partner in last year"</span>,</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">"1 sexual partner"</span>,</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">"2 sexual partners"</span>,</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">"3 or 4 sexual partners"</span>,</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">"5 or more sexual partners in last year"</span>,</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">"information missing"</span>)</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Use the table() function to obtain a two way table of marital status by number of sexual partners in the past year.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mwanza<span class="sc">$</span>pa1, mwanza<span class="sc">$</span>msta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                        
                                         currently married divorced or widowed
  no sexual partner in last year                         9                  32
  1 sexual partner                                     519                  42
  2 sexual partners                                     45                   9
  3 or 4 sexual partners                                20                   2
  5 or more sexual partners in last year                 0                   0
  information missing                                    0                   1
                                        
                                         never married information missing
  no sexual partner in last year                    27                   6
  1 sexual partner                                  29                   8
  2 sexual partners                                  4                   5
  3 or 4 sexual partners                             4                   0
  5 or more sexual partners in last year             0                   0
  information missing                                1                   0</code></pre>
</div>
</div>
<p>To exclude the missing categories coded as “information missing”, you can use the <code>recode_factor()</code> function. This replaces the “information missing” category with <code>NA</code> while keeping the variable as a factor.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>mwanza<span class="sc">$</span>msta <span class="ot">&lt;-</span> <span class="fu">recode_factor</span>(</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  mwanza<span class="sc">$</span>msta, </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"information missing"</span> <span class="ot">=</span> <span class="cn">NA_character_</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>mwanza<span class="sc">$</span>pa1 <span class="ot">&lt;-</span> <span class="fu">recode_factor</span>(</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>  mwanza<span class="sc">$</span>pa1, </span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"information missing"</span> <span class="ot">=</span> <span class="cn">NA_character_</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Alternatively, you can use the na_if() function from dplyr, which directly converts the specified value to NA and works for factors and characters.</p>
<pre><code>mwanza &lt;- mwanza |&gt;
  mutate(
    msta = na_if(msta, "information missing"),
    pa1  = na_if(pa1, "information missing")
  )</code></pre>
<p>Now use the table() function again.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mwanza<span class="sc">$</span>pa1, mwanza<span class="sc">$</span>msta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                        
                                         currently married divorced or widowed
  no sexual partner in last year                         9                  32
  1 sexual partner                                     519                  42
  2 sexual partners                                     45                   9
  3 or 4 sexual partners                                20                   2
  5 or more sexual partners in last year                 0                   0
                                        
                                         never married
  no sexual partner in last year                    27
  1 sexual partner                                  29
  2 sexual partners                                  4
  3 or 4 sexual partners                             4
  5 or more sexual partners in last year             0</code></pre>
</div>
</div>
<p>To examine whether the distribution of individuals in categories of sex partners in the past year is the same for each category of marital status we can use CrossTable().</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(mwanza<span class="sc">$</span>pa1,</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>           mwanza<span class="sc">$</span>msta,</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.r =</span> <span class="cn">FALSE</span>,</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.c =</span> <span class="cn">TRUE</span>, </span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.t =</span> <span class="cn">FALSE</span>,</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.chisq =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|           N / Col Total |
|-------------------------|

 
Total Observations in Table:  742 

 
                               | mwanza$msta 
                    mwanza$pa1 |   currently married | divorced or widowed |       never married |           Row Total | 
-------------------------------|---------------------|---------------------|---------------------|---------------------|
no sexual partner in last year |                   9 |                  32 |                  27 |                  68 | 
                               |               0.015 |               0.376 |               0.422 |                     | 
-------------------------------|---------------------|---------------------|---------------------|---------------------|
              1 sexual partner |                 519 |                  42 |                  29 |                 590 | 
                               |               0.875 |               0.494 |               0.453 |                     | 
-------------------------------|---------------------|---------------------|---------------------|---------------------|
             2 sexual partners |                  45 |                   9 |                   4 |                  58 | 
                               |               0.076 |               0.106 |               0.062 |                     | 
-------------------------------|---------------------|---------------------|---------------------|---------------------|
        3 or 4 sexual partners |                  20 |                   2 |                   4 |                  26 | 
                               |               0.034 |               0.024 |               0.062 |                     | 
-------------------------------|---------------------|---------------------|---------------------|---------------------|
                  Column Total |                 593 |                  85 |                  64 |                 742 | 
                               |               0.799 |               0.115 |               0.086 |                     | 
-------------------------------|---------------------|---------------------|---------------------|---------------------|

 </code></pre>
</div>
</div>
<p>We can read from the table that 45.3% of those who never married reported one sexual partner in the past year, compared with 87.5 % of those who are married and 49.5% of those widowed or divorced.</p>
<p>If there was no association between the two variables the percentage reporting one sexual partner in the past year in each category of marital status would be similar, but they are not. Similarly the percentage of those with no sexual partners among those who are currently married it is 1.52%, 37.7% amongst those who are divorced or widowed and rises to 42.19% amongst those who have never married. This suggests there is an association between marital status and number of sexual partners in the past year.</p>
<section id="test-of-association-between-two-categorical-variables" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="test-of-association-between-two-categorical-variables"><span class="header-section-number">8.1</span> Test of association between two categorical variables</h2>
<p>You can test the null hypothesis of no association with a chi-squared test using the chisq.test() function on the two categorical variables pa1 and msta. We specify correct=F because this stops R from performing a continuity correction.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(mwanza<span class="sc">$</span>pa1, mwanza<span class="sc">$</span>msta, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  mwanza$pa1 and mwanza$msta
X-squared = 215.92, df = 6, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>We then see results from the chi-squared test. The degrees of freedom is also listed, calculated as df=(r-1)×(c-1)=(4-1)×(3-1)=6. The corresponding P-value or probability associated with the chi-squared value for 6 degrees of freedom is &lt;2.2e-16. This is the way R represents standard form. It means 2.2×10^(-16). The result means that the probability of a chi-squared value this large, or larger, assuming the null hypothesis of no association is true, is very very small (&lt;0.0001).</p>
<p>How is this result interpreted? The probability of obtaining a chi-squared value of this magnitude, assuming the null hypothesis of no association between marital status and the number of sexual partners in the past year is extremely small. We conclude that there is strong evidence to suggest a real association between marital status and number of sexual partners in the past year (p&lt;0.0001).</p>
</section>
<section id="test-of-association-between-two-binary-variables-2x2-tables" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="test-of-association-between-two-binary-variables-2x2-tables"><span class="header-section-number">8.2</span> Test of association between two binary variables: 2x2 tables</h2>
<p>You can use the same commands for the association between two binary variables. For this example we will use bld (blood transfusion in the last 5 years: 1=no, 2=yes, 9=missing) and case (a variable to indicate case/control status: 1= case, 0=control). We wish to compare the percentage of cases (of HIV infection) and controls who have had a blood transfusion in the past 5 years.</p>
<p>First we want to label the blood and case variables</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>mwanza<span class="sc">$</span>bld <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  mwanza<span class="sc">$</span>bld, </span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">9</span>), </span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"no"</span>,<span class="st">"yes"</span>,<span class="st">"missing"</span>)</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>mwanza<span class="sc">$</span>case <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>  mwanza<span class="sc">$</span>case, </span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"control"</span>,<span class="st">"case"</span>)</span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And then look at the distribution of bld</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>mwanza <span class="sc">|&gt;</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bld) <span class="sc">|&gt;</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">freq =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> freq <span class="sc">/</span> <span class="fu">sum</span>(freq))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  bld      freq percent
  &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;
1 no        728  95.4  
2 yes        34   4.46 
3 missing     1   0.131</code></pre>
</div>
</div>
<p>Next we need to code as missing those observations for which bld takes the value of 9:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>mwanza<span class="sc">$</span>bld<span class="ot">&lt;-</span><span class="fu">recode_factor</span>(mwanza<span class="sc">$</span>bld, <span class="st">"missing"</span> <span class="ot">=</span> <span class="cn">NA_character_</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To examine the distribution of bld in case and control groups, use the following commands:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(mwanza<span class="sc">$</span>bld,</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>           mwanza<span class="sc">$</span>case,</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.r =</span> <span class="cn">FALSE</span>,</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.c =</span> <span class="cn">TRUE</span>, </span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.t =</span> <span class="cn">FALSE</span>,</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.chisq =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|           N / Col Total |
|-------------------------|

 
Total Observations in Table:  762 

 
             | mwanza$case 
  mwanza$bld |   control |      case | Row Total | 
-------------|-----------|-----------|-----------|
          no |       553 |       175 |       728 | 
             |     0.965 |     0.926 |           | 
-------------|-----------|-----------|-----------|
         yes |        20 |        14 |        34 | 
             |     0.035 |     0.074 |           | 
-------------|-----------|-----------|-----------|
Column Total |       573 |       189 |       762 | 
             |     0.752 |     0.248 |           | 
-------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p>We can then use a chi-squared test on the 2x2 table</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(mwanza<span class="sc">$</span>bld, mwanza<span class="sc">$</span>case, <span class="at">correct=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  mwanza$bld and mwanza$case
X-squared = 5.1153, df = 1, p-value = 0.02372</code></pre>
</div>
</div>
<p>From the table you can see that more than 7% of the cases had a blood transfusion in the past 5 years compared to 3.5% of the controls. The resulting chi-squared value from the analysis is 5.12 (with 1df) with P-value 0.02. This means that the probability of obtaining a chi-squared value of this magnitude or larger by chance alone is small, at P=0.02. Therefore there is evidence to suggest that there is a real association between blood transfusion in the past 5 years and case/control status.</p>
</section>
<section id="test-for-a-linear-trend-in-2xn-table" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="test-for-a-linear-trend-in-2xn-table"><span class="header-section-number">8.3</span> Test for a linear trend in 2xn table</h2>
<p>For ordered categorical data we can assess whether there is a linear relationship with a binary variable.</p>
<p>To see whether the proportion of cases varies by number of sexual partners in the past year, type the following.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(mwanza<span class="sc">$</span>pa1,</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>           mwanza<span class="sc">$</span>case,</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.r =</span> <span class="cn">TRUE</span>, </span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.c =</span> <span class="cn">FALSE</span>, </span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.t =</span> <span class="cn">FALSE</span>,</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.chisq =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|           N / Row Total |
|-------------------------|

 
Total Observations in Table:  761 

 
                               | mwanza$case 
                    mwanza$pa1 |   control |      case | Row Total | 
-------------------------------|-----------|-----------|-----------|
no sexual partner in last year |        56 |        18 |        74 | 
                               |     0.757 |     0.243 |     0.097 | 
-------------------------------|-----------|-----------|-----------|
              1 sexual partner |       461 |       137 |       598 | 
                               |     0.771 |     0.229 |     0.786 | 
-------------------------------|-----------|-----------|-----------|
             2 sexual partners |        42 |        21 |        63 | 
                               |     0.667 |     0.333 |     0.083 | 
-------------------------------|-----------|-----------|-----------|
        3 or 4 sexual partners |        14 |        12 |        26 | 
                               |     0.538 |     0.462 |     0.034 | 
-------------------------------|-----------|-----------|-----------|
                  Column Total |       573 |       188 |       761 | 
-------------------------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p>We can then use a chi-squared test to test the association between case/control status and number of sexual partners in the past year.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="fu">table</span>(mwanza<span class="sc">$</span>pa1, mwanza<span class="sc">$</span>case)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  table(mwanza$pa1, mwanza$case)[1:4, ]
X-squared = 9.9938, df = 3, p-value = 0.01862</code></pre>
</div>
</div>
<p>Look at the percentages of cases in each category of sexual partners. The proportion of cases in those who did not have a partner in the past year and those who had one partner is similar (24% and 23% respectively). There is a sharp increase in the proportion of cases with 2 sexual partners in the past year (33%) and another increase for 3 or 4 sexual partners in the past year (46%). The chi-squared test shows there is evidence of an association between cases and number of sexual partners in the past year, as P=0.02.</p>
<p>The test we have just performed in R is test of association between case/control status and number of sexual partners in the past year. To test whether the risk of HIV infection changes with an increasing number of sexual partners we use a test for linear trend. In a test for trend each category is assigned a score. For this example number of sexual partners has already been assigned a score: 1=none, 2=1, 3=2, 4=3-4, 5=5 or more.</p>
<p>In R, we must first generate two variables:</p>
<ul>
<li><p>The number of cases for each pa1 category.</p></li>
<li><p>The total number of observations in each pa1 category.</p></li>
</ul>
<p>We can do this by generating a summary table and saving it as an object.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>summary<span class="ot">&lt;-</span>mwanza <span class="sc">|&gt;</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(case, pa1) <span class="sc">|&gt;</span>   <span class="co"># remove rows with missing case or pa1 values</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pa1 <span class="sc">!=</span> <span class="dv">9</span>) <span class="sc">|&gt;</span>         <span class="co"># exclude rows where pa1 = 9 ("information missing")</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(case, pa1)<span class="sc">|&gt;</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">freq=</span><span class="fu">n</span>())<span class="sc">|&gt;</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pa1)<span class="sc">|&gt;</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total=</span><span class="fu">sum</span>(freq))<span class="sc">|&gt;</span>     <span class="co"># add total (cases + controls) for each pa1</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()               <span class="co"># convert to data frame</span></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View the summary table</span></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     case                            pa1 freq total
1 control no sexual partner in last year   56    74
2 control               1 sexual partner  461   598
3 control              2 sexual partners   42    63
4 control         3 or 4 sexual partners   14    26
5    case no sexual partner in last year   18    74
6    case               1 sexual partner  137   598
7    case              2 sexual partners   21    63
8    case         3 or 4 sexual partners   12    26</code></pre>
</div>
</div>
<p>Then we can select the parts of this we want using subsetting. Subsetting is selecting the particular rows and columns of a table that you are interested. To do this we put square brackets after the object we are subsetting and in them we specify the rows and columns of interest, separated by a comma. To select the frequency of cases in each pa1 category we want to select rows 5-8 and column 3 of our table and assign it to a new object. Note that subsetting does not always work well with tibbles, used in tidyverse, so the last line of the previous command converts our result into a data frame.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> summary[<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>,<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Alternatively we can use a logical equation to specify that we are interested in the rows where case is equal to “case”.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> summary[summary<span class="sc">$</span>case <span class="sc">==</span> <span class="st">"case"</span>,<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can do the same for the total in each group, listed in the fourth column.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span> summary[summary<span class="sc">$</span>case <span class="sc">==</span> <span class="st">"case"</span>,<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After which we use the prop.trend.test() command on the freq and total objects to test for linear trend.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.trend.test</span>(freq, total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Chi-squared Test for Trend in Proportions

data:  freq out of total ,
 using scores: 1 2 3 4
X-squared = 6.4081, df = 1, p-value = 0.01136</code></pre>
</div>
</div>
<p>or alternatively:</p>
<pre><code>contingency_table &lt;- table(mwanza$pa1, mwanza$case) # create a contingency table (cross-tabulation) of pa1 (rows) by case status (columns)
view(contingency_table)

categories &lt;- as.character(1:4) # select only the categories 1, 2, 3, and 4 of pa1. These are the ordered groups we want in the trend test.
print(categories)

freq &lt;- contingency_table[categories, "1"] # extract the number of cases (column "1") for the selected pa1 categories

total &lt;- rowSums(contingency_table[categories, ]) # calculate the total number of people (cases + control) in each pa1 category

prop.trend.test(freq, total) # perform the test for linear trend in proportions across the ordered categories</code></pre>
<p>Alternatively, we can remove the pa1 == 9 category before creating the contingency table. This way the table contains only the categories needed for the test, so there is no need to filter rows later. We can then pass the counts of cases and the totals straight into prop.trend.test() without creating extra variables.</p>
<pre><code>contingency_table_2 &lt;- table(
  mwanza$pa1[mwanza$pa1 != 9], 
  mwanza$case[mwanza$pa1 != 9]) # create a contingency table of pa1 (rows) by case status (columns), excluding pa1 = 9

# Perform the linear trend test directly
prop.trend.test(
  contingency_table_2[, "1"],   # number of cases in each pa1 category (cases = column 1 of contingency_table_2)
  rowSums(contingency_table_2)      # total people (cases + controls) in each category
) </code></pre>
<p>The chi-squared test for trend yields a value of 6.40, which with 1df, gives a p-value of 0.0114. We conclude that there is strong evidence of a linear trend, with the proportion of cases of HIV infection increasing with increasing number of sexual partners.</p>
</section>
<section id="exercises-5" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="exercises-5"><span class="header-section-number">8.4</span> Exercises</h2>
<p>Now use R to answer the following questions for the Mwanza dataset (the solutions are in Section 3). In doing this you will apply the statistical methods for assessing the association between two categorical variables discussed in CAL session SC11.<br>
</p>
<p>Examine the relationship and test for an association between the variables ethnic group (eth) and years of education (ed). Interpret your results.<br>
</p>
<p>Create a new variable npa2 which regroups the variable pa1, number of sexual partners in the past year to a binary variable where 1 = none or 1, 2 = 2 or more.<br>
</p>
<p>Now examine and test the relationship between HIV status (case) and the binary variable for number of sexual partners in the past year (npa2). Interpret your results. How does the percentage of cases with 2 or more partners in the past year compare with the percentage of controls with 2 or more partners in the past year?<br>
</p>
<p>Examine the relationship between HIV status (case) and agegroup (age1). Test for a linear trend in the proportion of cases with increasing agegroup. Does the percentage of cases increase or decrease with increasing age?</p>
</section>
</section>
<section id="practical-wb10-stratified-analysis" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Practical WB10: Stratified Analysis</h1>
<p><strong>Load the packages required for this session</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="stratified-analysis" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="stratified-analysis"><span class="header-section-number">9.1</span> Stratified analysis</h2>
<p>Now you are going to use R to obtain a measure of effect in 2x2 tables and adjust for a potential confounder. In doing this you will apply the statistical methods discussed in SE10.</p>
<p>You will use the data mwanza.csv. Refer to the Appendix for a description of the study and variables.</p>
<p><strong>Import in the Mwanza data.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>mwanza <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"mwanza.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="generating-binary-variables" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="generating-binary-variables"><span class="header-section-number">9.2</span> Generating binary variables</h2>
<p>You are going to focus on 2x2 tables, so first you need to recode some of the variables in the dataset to binary variables.</p>
<p>The variable ed indicates the number of years of education received by subjects in the study. It is coded as follows:</p>
<ul>
<li>ed = 1: no education/adult education only</li>
<li>ed = 2: 1 - 3 yrs of education</li>
<li>ed = 3: 4 - 6 yrs of education</li>
<li>ed = 4: 7+ yrs of education</li>
</ul>
<p>To recode the education variable into 2 categories: none/adult only and some school education, type:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>mwanza <span class="ot">&lt;-</span> mwanza <span class="sc">|&gt;</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ed2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>      ed <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>      ed <span class="sc">%in%</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Alternatively, you can use the case_match() option:</p>
<pre><code>mwanza &lt;- mwanza |&gt;
  mutate(
    ed2 = case_match(
      ed,
      1 ~ 1,
      2 ~ 2,
      3 ~ 2,
      4 ~ 2
    )
  )</code></pre>
<p>The variable age1 indicates the age of a study subject and is coded as follows:</p>
<ul>
<li>age1=1: 15 - 19 years</li>
<li>age1=2: 20 - 24 years</li>
<li>age1=3: 25 - 29 years</li>
<li>age1=4: 30 - 34 years</li>
<li>age1=5: 35 - 44 years</li>
<li>age1=6: 45 - 54 years</li>
</ul>
<p>To create new variable of age with 2 categories; &lt; 30 years; &gt;=30 years, type:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>mwanza <span class="ot">&lt;-</span> mwanza <span class="sc">|&gt;</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">age2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>      age1 <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>      age1 <span class="sc">%in%</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If you want to overwrite the original age1 variable rather than create a new one:</p>
<pre><code>mwanza &lt;- mwanza |&gt;
  mutate(
    age1 = case_when(
      age1 %in% 1:3 ~ 1,
      age1 %in% 4:6 ~ 2
    )
  )</code></pre>
</section>
<section id="calculation-of-odds-ratio" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="calculation-of-odds-ratio"><span class="header-section-number">9.3</span> Calculation of Odds Ratio</h2>
<p>You want to investigate whether a woman’s education level (ed2) is associated with risk of HIV infection (case). Use summarise() to examine the distribution of level of education in cases and controls.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(mwanza<span class="sc">$</span>ed2,</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>           mwanza<span class="sc">$</span>case,</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.r =</span> <span class="cn">FALSE</span>,</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.c =</span> <span class="cn">TRUE</span>, </span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.t =</span> <span class="cn">FALSE</span>,</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.chisq =</span> <span class="cn">FALSE</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|           N / Col Total |
|-------------------------|

 
Total Observations in Table:  763 

 
             | mwanza$case 
  mwanza$ed2 |         0 |         1 | Row Total | 
-------------|-----------|-----------|-----------|
           1 |       263 |        49 |       312 | 
             |     0.458 |     0.259 |           | 
-------------|-----------|-----------|-----------|
           2 |       311 |       140 |       451 | 
             |     0.542 |     0.741 |           | 
-------------|-----------|-----------|-----------|
Column Total |       574 |       189 |       763 | 
             |     0.752 |     0.248 |           | 
-------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p>These results suggest that cases were more likely to have received some form of education than controls, with 74.1% of cases reporting one or more years of education compared with 54.2% of controls.</p>
<p>Use simple arithmetic to calculate the odds ratio (OR) from this table, where:</p>
<p>OR = (odds of exposure among cases) / (odds of exposure among controls)</p>
<p>OR = (odds of education among cases) / (odds of education among controls)</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">140</span> <span class="sc">/</span> <span class="dv">49</span>) <span class="sc">/</span> (<span class="dv">311</span> <span class="sc">/</span> <span class="dv">263</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.416169</code></pre>
</div>
</div>
<p>So, the odds ratio for exposure to education and risk of HIV infection is 2.42.</p>
</section>
<section id="crude-odds-ratio" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="crude-odds-ratio"><span class="header-section-number">9.4</span> Crude Odds Ratio</h2>
<p>The crude odds ratio can be estimated in R using the function OddsRatio() from the DescTools package. This package is included in the R.env file so you do not need to install it again. We can then use the function OddsRatio() on a 2x2 table of case and ed2. We have to specify the confidence level with this function else no confidence interval will be reported.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OddsRatio</span>(<span class="fu">table</span>(mwanza<span class="sc">$</span>case, mwanza<span class="sc">$</span>ed2), </span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf.level =</span> <span class="fl">0.95</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>          )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>odds ratio     lwr.ci     upr.ci 
  2.416169   1.678287   3.478471 </code></pre>
</div>
</div>
<p>You can see the OR is the same as you calculated previously, OR=2.42. A confidence interval for the odds ratio is also included in the output. The confidence interval does not include 1, and the lower end of it is quite a lot larger than 1, so we can conclude that there is probably an association between education level and risk of HIV infection.</p>
</section>
<section id="adjusted-odds-ratio" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="adjusted-odds-ratio"><span class="header-section-number">9.5</span> Adjusted Odds Ratio</h2>
<p>To examine whether the effect of education is confounded by age (age2), we use the mantelhaen.test() command with our third argument specifying the stratifying variable (age2)</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mantelhaen.test</span>(mwanza<span class="sc">$</span>ed2, mwanza<span class="sc">$</span>case, mwanza<span class="sc">$</span>age2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Mantel-Haenszel chi-squared test with continuity correction

data:  mwanza$ed2 and mwanza$case and mwanza$age2
Mantel-Haenszel X-squared = 19.591, df = 1, p-value = 9.594e-06
alternative hypothesis: true common odds ratio is not equal to 1
95 percent confidence interval:
 1.600484 3.472905
sample estimates:
common odds ratio 
         2.357611 </code></pre>
</div>
</div>
<p>The Mantel-Haenszel odds ratio (OR = 2.36) is very similar to the crude odds ratio (OR= 2.42), this suggests that agegroup has no confounding effect on the association between education and HIV infection.</p>
<p>However, we can look at the odds ratios within individual strata by using subsetting with the OddsRatio() function.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OddsRatio</span>(<span class="fu">table</span>(</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  mwanza<span class="sc">$</span>case[mwanza<span class="sc">$</span>age2 <span class="sc">==</span> <span class="dv">1</span>], </span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  mwanza<span class="sc">$</span>ed2[mwanza<span class="sc">$</span>age2 <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">useNA =</span> <span class="st">"no"</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.level =</span> <span class="fl">0.95</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>odds ratio     lwr.ci     upr.ci 
 1.5030030  0.8453715  2.6722192 </code></pre>
</div>
</div>
<p>Here the subsetting indicates we want the values of case that correspond to where age2 is equal to 1.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OddsRatio</span>(<span class="fu">table</span>(</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  mwanza<span class="sc">$</span>case[mwanza<span class="sc">$</span>age2 <span class="sc">==</span> <span class="dv">2</span>], </span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  mwanza<span class="sc">$</span>ed2[mwanza<span class="sc">$</span>age2 <span class="sc">==</span> <span class="dv">2</span>],</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">useNA =</span> <span class="st">"no"</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.level =</span> <span class="fl">0.95</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>odds ratio     lwr.ci     upr.ci 
  3.498731   2.090997   5.854204 </code></pre>
</div>
</div>
<p>The above output also shows the effect of exposure to education on HIV infection stratified by age2 (&lt;30 years; &gt;=30 years). The odds ratio in the younger age group (OR=1.50) is lower than in the older age group (OR=3.50) suggesting that exposure has greater effect on the risk of HIV infection in the older age group. Note that while the 95% confidence interval for the younger group includes the value of 1, the 95% confidence interval for the older group does not include 1.</p>
<p>When the estimates within the strata of a confounding variable are, as in this example, very different, the strata results should be presented separately instead of the summary Mantel-Haenszel estimates. This is known as effect modification (discussed in FE09 of EPM101). Analysis of such data will be covered in the advanced units on statistical methods.</p>
</section>
<section id="exercises-6" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="exercises-6"><span class="header-section-number">9.6</span> Exercises</h2>
<p>Now use R to answer the following questions about the Mwanza data (the solutions are in Section 3).<br>
</p>
<p>Create a variable called npa2 which regroups the variable pa1, number of sexual partners in the past year to a binary variable where 1=none or 1; 2 = 2 or more.&nbsp;Check that the new variable has the correct codes using table().<br>
</p>
<p>Obtain a 2x2 table of case by npa2. How does the proportion of cases exposed to 2 or more partners in the past year compare to the proportion of controls exposed to two or more partners in the past year?<br>
</p>
<p>Obtain an odds ratio estimate for the association between case and npa2.<br>
Examine whether the effect of 2 or more sexual partners in the past year is confounded by level of education (ed2). Do you think the stratified odds ratios for each level of education or the adjusted Mantel-Haenszel odds ratio should be presented?<br>
Note: you may need to recode missing values.</p>
</section>
</section>
<section id="practical-wb11-matched-analysis-for-paired-binary-data" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Practical WB11: Matched analysis for paired binary data</h1>
<p>In this session you are going to use R to analyse data from a matched case-control study. The data diabraz.csv is from a study of risk factors for infant diarrhoea. For more details of the study and a description of the variables see the Appendix.</p>
<p><strong>Load the packages required for this session</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Import the diabraz data.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>diabraz<span class="ot">&lt;-</span><span class="fu">import</span>(<span class="st">"diabraz.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="unmatched-2x2-table" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="unmatched-2x2-table"><span class="header-section-number">10.1</span> Unmatched 2x2 table</h2>
<p>You are going to examine the effect of breastfeeding (variable name bf) on the risk of mortality from diarrhoea (variable name case). In bf, the value 1 indicates the child was breast fed at onset of illness, the value 2 indicates that the child was not breastfed when the illness commenced. In the case variable, the value 1 indicates a case of death caused by diarrhoea, and the value 0 indicates a control (i.e.&nbsp;a child who did not die from diarrhoea).</p>
<p>Use the table() command to examine the relationship between breast feeding (bf) and diarrhoea mortality (case).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(diabraz<span class="sc">$</span>bf, diabraz<span class="sc">$</span>case)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
     0  1
  1 53 30
  2 33 56</code></pre>
</div>
</div>
</section>
<section id="display-of-matched-2x2-table" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="display-of-matched-2x2-table"><span class="header-section-number">10.2</span> Display of matched 2x2 table</h2>
<p>However, because the data are matched it is actually incorrect to display the data as shown above. It would be more useful to see if cases and controls in each matched pair have the same value of bf. To do this we need to select just the columns we are interested in and spread out data so there is one row for each pair, and two columns representing bf for cases and controls.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>pairdata <span class="ot">&lt;-</span> diabraz <span class="sc">|&gt;</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case, bf, pair) <span class="sc">|&gt;</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">value =</span> bf, <span class="at">key =</span> case) <span class="sc">|&gt;</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">bf0 =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>, <span class="at">bf1 =</span><span class="st">`</span><span class="at">1</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This creates an object, pairdata, that looks like this</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pairdata, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   pair bf0 bf1
1     1   2   2
2     2   1   2
3     3   1   1
4     4   1   2
5     5   2   2
6     6   1   2
7     7   1   2
8     8   2   1
9     9   1   1
10   10   1   1</code></pre>
</div>
</div>
<p>We can then produce a 2x2 table of bf0 and bf1 for each pair</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(pairdata<span class="sc">$</span>bf0, pairdata<span class="sc">$</span>bf1, </span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.c =</span> <span class="cn">FALSE</span>,      </span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.chisq =</span> <span class="cn">FALSE</span>,  </span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.r =</span> <span class="cn">FALSE</span>,      </span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.t =</span> <span class="cn">FALSE</span>)      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|-------------------------|

 
Total Observations in Table:  86 

 
             | pairdata$bf1 
pairdata$bf0 |         1 |         2 | Row Total | 
-------------|-----------|-----------|-----------|
           1 |        24 |        29 |        53 | 
-------------|-----------|-----------|-----------|
           2 |         6 |        27 |        33 | 
-------------|-----------|-----------|-----------|
Column Total |        30 |        56 |        86 | 
-------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p>The rows represent the value of bf in controls and columns indicate that in cases for each pair. We can see the number of concordant (both the same, top left and bottom right) and discordant (both different, top right and bottom left) pairs. In matched analysis it is the discordant pairs that provide information. There were 6 pairs where the case was breastfed and the control was not and 29 pairs where the control was breastfed and the case was not.</p>
<p>Using these values we can calculate the matched odds ratio for exposure to breast feeding.</p>
<p><span class="math display">\[
OR=\frac{\text{number of pairs: case exposed and control not exposed}}{\text{number of pairs: control exposed and case not exposed}}
\]</span></p>
<p>You can calculate this</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="sc">/</span> <span class="dv">29</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2068966</code></pre>
</div>
</div>
</section>
<section id="matched-odds-ratio" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="matched-odds-ratio"><span class="header-section-number">10.3</span> Matched Odds ratio</h2>
<p>To obtain an estimate of the risk of diarrhoea mortality associated with breastfeeding you use the mantelhaen.test() command again, adjusting for the pairing variable. First, make all the variables</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mantelhaen.test</span>(diabraz<span class="sc">$</span>bf, diabraz<span class="sc">$</span>case, diabraz<span class="sc">$</span>pair)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Mantel-Haenszel chi-squared test with continuity correction

data:  diabraz$bf and diabraz$case and diabraz$pair
Mantel-Haenszel X-squared = 13.829, df = 1, p-value = 0.0002003
alternative hypothesis: true common odds ratio is not equal to 1
95 percent confidence interval:
  2.006714 11.641474
sample estimates:
common odds ratio 
         4.833333 </code></pre>
</div>
</div>
<p>Let’s compare this result with the result from an unmatched analysis on a 2x2 table of bf vs case.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OddsRatio</span>(<span class="fu">table</span>(diabraz<span class="sc">$</span>case, diabraz<span class="sc">$</span>bf), </span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf.level =</span> <span class="fl">0.95</span></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>          )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>odds ratio     lwr.ci     upr.ci 
  2.997980   1.611273   5.578125 </code></pre>
</div>
</div>
<p>Ignoring the matching in the analysis results in a substantial underestimate of the effect of not breast feeding on diarrhoea mortality; matched OR= 4.83, unmatched OR=3.00.</p>
</section>
<section id="exercises-7" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="exercises-7"><span class="header-section-number">10.4</span> Exercises</h2>
<p>Now use R to answer the following questions for the Diabraz dataset (the solutions are in Section 3). In doing this you will apply the methods for analysis of matched binary data discussed in CAL session SC13.</p>
<ol type="1">
<li>Obtain a matched 2x2 table for birthweight group (variable bwtgp: takes value 1 if birth weight 3kg or more, and value 2 if birthweight &lt; 3kg) and diarrhoea mortaility.</li>
<li>Calculate the matched odds ratio for bwtgp.</li>
<li>Use the mantelhaen.test() command to obtain an odds ratio (and 95% confidence interval) for bwtgp.</li>
<li>Obtain a matched 2x2 table for water supply (variable wat2: takes value 1 if water available in house or on plot, and value 2 if no private water supply) and diarrhoea mortaility.</li>
<li>Calculate the matched odds ratio for wat2 without using mantelhane.test().</li>
<li>Perform an unmatched analyses for the variable wat2. Compare this to the matched results.</li>
</ol>
</section>
</section>
<section id="practical-wb12-association-between-two-quantitative-variables-correlation-and-regression" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Practical WB12: Association between two quantitative variables: correlation and regression</h1>
<p>In this session you are going to use R to:</p>
<ol type="1">
<li>Assess the correlation between two quantitative variables</li>
<li>Regress one quantitative variable on another.</li>
</ol>
<p>These methods are discussed in CAL sessions SE12 and SE13 respectively. The dataset you will use to apply methods of correlation and regression is babies.csv. For details of the study and variables refer to the Appendix.</p>
<p><strong>Load the packages required for this session</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Import the babies data.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>babies <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"babies.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span style="color:blue"><strong>Initial examination of the variables</strong></span></p>
<p>The two variables you will examine are birthweight (bweight) and weeks of gestation (gestwks). First examine the distribution of the two variables. You can summarise the data and display the distribution with a histogram and normal curve, like in practical 2.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">|&gt;</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(bweight), </span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">median =</span> <span class="fu">median</span>(bweight), </span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">min =</span> <span class="fu">min</span>(bweight), </span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">max =</span> <span class="fu">max</span>(bweight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      mean median min  max
1 3129.137   3200 630 4650</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(babies<span class="sc">$</span>bweight,  <span class="at">xlab =</span> <span class="st">"Birthweight (g)"</span>, <span class="at">freq =</span> <span class="cn">FALSE</span>)</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fu">mean</span>(babies<span class="sc">$</span>bweight), <span class="at">sd=</span><span class="fu">sd</span>(babies<span class="sc">$</span>bweight)), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-130-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Examine the variable gestwks in the same way.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(babies<span class="sc">$</span>gestwks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  24.69   38.01   39.15   38.69   40.15   42.35 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(babies<span class="sc">$</span>gestwks,  <span class="at">xlab =</span> <span class="st">"Weeks gestation"</span>, <span class="at">freq =</span> <span class="cn">FALSE</span>)</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean  =</span> <span class="fu">mean</span>(babies<span class="sc">$</span>gestwks), <span class="at">sd =</span> <span class="fu">sd</span>(babies<span class="sc">$</span>gestwks)), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-131-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Scatterplot</strong></p>
<p>The first step in examining the relationship between two quantitative variables is to draw a scatterplot.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(babies<span class="sc">$</span>gestwks, babies<span class="sc">$</span>bweight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-132-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Do you think there is an association between birthweight and weeks of gestation? From the scatterplot we can see that as weeks of gestation increases birthweight increases.</p>
<section id="correlation-coefficient" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="correlation-coefficient"><span class="header-section-number">11.1</span> Correlation coefficient</h2>
<p>We can measure the degree of linear association with a correlation coefficient. To do this in R type:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(babies[, <span class="fu">c</span>(<span class="st">"bweight"</span>, <span class="st">"gestwks"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          bweight   gestwks
bweight 1.0000000 0.7375501
gestwks 0.7375501 1.0000000</code></pre>
</div>
</div>
<p>The correlation coefficient without the matrix can also be obtained</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(babies<span class="sc">$</span>bweight, babies<span class="sc">$</span>gestwks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7375501</code></pre>
</div>
</div>
<p>The correlation coefficient for the association between birthweight and weeks of gestation is r = 0.74, indicating a positive linear association.</p>
</section>
<section id="linear-regression" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="linear-regression"><span class="header-section-number">11.2</span> Linear Regression</h2>
<p>Correlation tells us about the strength of the association between two variables but if one variable is dependent on the other we can quantify the relationship with linear regression. The linear relationship can be expressed as</p>
<p><span class="math display">\[
bweight= a + b \times gestwks
\]</span></p>
<p><span class="math display">\[
y= a + b \times x
\]</span></p>
<p>The parameters a and b (the intercept and the slope of the regression line) are estimated with the lm() function which estimates a linear model. To see the results we have to save the model as an object in out R environment.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(bweight <span class="sc">~</span> gestwks, <span class="at">data=</span>babies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Notice the response variable goes first, with the explanatory variable after the tilde symbol (~)</p>
<p>We can then see the results of the model by typing</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bweight ~ gestwks, data = babies)

Residuals:
     Min       1Q   Median       3Q      Max 
-1810.15  -284.69    -6.97   283.06  1248.31 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -4865.245    290.081  -16.77   &lt;2e-16 ***
gestwks       206.641      7.485   27.61   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 441.2 on 639 degrees of freedom
Multiple R-squared:  0.544, Adjusted R-squared:  0.5433 
F-statistic: 762.3 on 1 and 639 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The output shows the model coefficients and standard errors, along with hypothesis tests, some model statistics and a summary of the distribution of the model residuals. To see confidence intervals for coefficients we can type:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %     97.5 %
(Intercept) -5434.8731 -4295.6172
gestwks       191.9439   221.3386</code></pre>
</div>
</div>
<p>To see only the coefficients we can type:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     gestwks 
 -4865.2452    206.6412 </code></pre>
</div>
</div>
<p>In the model</p>
<p><span class="math display">\[
bweight = a + b \times gestwks
\]</span></p>
<p>the value of a is given by the coefficient for (Intercept) = -4865.245</p>
<p>the value of b is given by the coefficient for gestwks = 206.641</p>
<p>You can now write down the regression equation.</p>
<p><span class="math display">\[
bweight = -4865.2 + 206.6 \times gestwks
\]</span></p>
<p>You can examine the output for evidence of a linear relationship between birthweight and weeks of gestation. The regression coefficient has a value of 206.6 meaning that for a unit increase in weeks of gestation, birthweight increases on average by 206.6 grams. The associated 95 % confidence interval is (191.9, 221.3) meaning that in the population represented by this sample we are 95% certain that the regression coefficient lies within this range. A t-test of the null hypothesis of no linear association between birthweight and weeks of gestation (ie that b, the regression coefficient is equal to 0) gives a value of t=27.61 (P&lt;0.0001). We conclude that there is very strong evidence to suggest a linear association between weeks of gestation and birthweight.</p>
<p>The results of the model are stored in a list object. One of the elements of this list is called fitted.values and it contains predicted values of birthweight for each individual in the babies dataset, based on their weeks of gestation. We can add this to the dataset using the mutate() function</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>babies <span class="ot">&lt;-</span> babies <span class="sc">|&gt;</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> model<span class="sc">$</span>fitted.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here we have chosen y to be the name of the variable containing the predicted values.</p>
<p>Include these predicted values in the plot() and lines() functions to plot the regression line with the scatterplot.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(babies<span class="sc">$</span>gestwks, babies<span class="sc">$</span>bweight)</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(babies<span class="sc">$</span>gestwks, babies<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-140-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Alternatively, we can plot the model over the scatterplot directly using abline()</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(babies<span class="sc">$</span>gestwks, babies<span class="sc">$</span>bweight)</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-141-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exercises-8" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="exercises-8"><span class="header-section-number">11.3</span> Exercises</h2>
<p>Now using the Babies dataset answer the following questions (the solutions are in Section 3).</p>
<ol type="1">
<li>Summarize and produce a graph for the distribution of the variable maternal age (matage)</li>
<li>Display the relationship between birthweight (bweight) and maternal age (matage) in a scatterplot.</li>
<li>What is the correlation coefficient for the association between bweight and maternal age?</li>
<li>Regress birthweight on maternal age. What is the regression equation? What is the value of the regression coefficient and how is it interpreted? Is the slope of the regression line significantly different from zero?</li>
<li>Display the regression line on a scatterplot.</li>
<li>State, with reasons, whether or not you think a linear regression analysis of birthweight on maternal age was an appropriate method of analysis in this case.</li>
</ol>
</section>
</section>
<section id="practical-wb15-non-parametric-methods" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Practical WB15: Non-parametric methods</h1>
<p>In this session you are going to use the non-parametric methods described in the CAL session SE15. They are:</p>
<ul>
<li><p>The Wilcoxon signed rank test for the analysis of a single sample</p></li>
<li><p>The Wilcoxon rank sum test for the analysis of two independent samples</p></li>
<li><p>The Wilcoxon signed rank test for the analysis of two paired samples</p></li>
<li><p>The Spearman’s correlation coefficient for the association between two variables observed in one sample</p></li>
</ul>
<p><strong>Load the packages required for this session</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="single-sample-data" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="single-sample-data"><span class="header-section-number">12.1</span> Single sample data</h2>
<p>To illustrate the use of the Wilcoxon signed rank test for a single sample we will look at the data set called chol1.csv (see Appendix). This consists of information on the cholesterol level (in mg/dl) of 34 middle-age men. We wish to examine its distribution and to test whether the population median is equal to 196.5mg/dl, that is the average cholesterol in the Whitehall study.</p>
<p><strong>Import the cholesterol data.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>cholesterol <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"chol1.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Summarise the distribution of the variable chol</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>cholesterol <span class="sc">|&gt;</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(chol), <span class="at">median =</span> <span class="fu">median</span>(chol), <span class="at">min =</span> <span class="fu">min</span>(chol), <span class="at">max =</span> <span class="fu">max</span>(chol))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      mean median min max
1 208.5588    200 100 330</code></pre>
</div>
</div>
<p>Or just:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cholesterol<span class="sc">$</span>chol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  100.0   170.5   200.0   208.6   250.5   330.0 </code></pre>
</div>
</div>
<p>Examining the distribution of cholesterol you will find that its median is 200mg/dl and its mean is 208.6mg/dl. The distribution can be plotted with the command:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(cholesterol<span class="sc">$</span>chol, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">100</span>, <span class="dv">350</span>, <span class="at">by =</span> <span class="dv">25</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-146-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It is moderately skewed to the right (there is a hint of a long tail to the right of the distribution) so, to test whether the median in the population is 196.5mg/dl, we use the Wilcoxon signed rank test with the command,</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(cholesterol<span class="sc">$</span>chol, <span class="at">mu =</span> <span class="fl">196.5</span>, <span class="at">exact =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank test with continuity correction

data:  cholesterol$chol
V = 357, p-value = 0.3131
alternative hypothesis: true location is not equal to 196.5</code></pre>
</div>
</div>
</section>
<section id="two-independent-samples" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="two-independent-samples"><span class="header-section-number">12.2</span> Two independent samples</h2>
<p>To illustrate the use of the Wilcoxon rank sum test for the analysis of two independent samples we will examine the dataset called bus.csv (see Appendix). This is the file holding the data on energy consumption of bus drivers and office workers described in SE15.</p>
<p>The variables in the data file are energy (measured in Kcal/day) and job (coded 1 for “bus driver”, 2 for “office worker”). Import the data and tabulate the median energy intake by job.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>bus <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"bus.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>bus <span class="sc">|&gt;</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(job) <span class="sc">|&gt;</span></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">freq=</span><span class="fu">n</span>(), <span class="at">mean =</span> <span class="fu">mean</span>(energy), <span class="at">median =</span> <span class="fu">median</span>(energy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
    job  freq  mean median
  &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
1     1    10 2915.  2871.
2     2     7 2423.  2343.
3    NA     1   NA     NA </code></pre>
</div>
</div>
<p>To test whether the two groups have the same average energy consumption we use the Wilcoxon rank sum test with the command,</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(bus<span class="sc">$</span>energy <span class="sc">~</span> bus<span class="sc">$</span>job) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum exact test

data:  bus$energy by bus$job
W = 58, p-value = 0.02499
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p>The p-value of 0.025 suggests there is some evidence of a difference in energy consumption between the two groups.</p>
</section>
<section id="two-paired-samples" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="two-paired-samples"><span class="header-section-number">12.3</span> Two paired samples</h2>
<p>To illustrate the use of the Wilcoxon signed rank test for the analysis of two paired samples we will examine the dataset called Diabk.csv (see Appendix 1). This holds the calories intake of 15 diabetic patients measured one week before and one week after an intervention to improve their diet. We noted in the exercises in WB08 that the differences in paired measurements were not symmetrically distributed, as the mean and median differ.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>diabk <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"diabk.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>diabk <span class="ot">&lt;-</span> diabk <span class="sc">|&gt;</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dif=</span>kcal1<span class="sc">-</span>kcal2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>diabk <span class="sc">|&gt;</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(dif), </span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">median =</span> <span class="fu">median</span>(dif), </span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">min =</span> <span class="fu">min</span>(dif), </span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">max =</span> <span class="fu">max</span>(dif))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  mean median  min max
1 78.8    119 -335 320</code></pre>
</div>
</div>
<p>The Wilcoxon signed rank test for the median difference being equal to zero is found with the command:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(diabk<span class="sc">$</span>dif, <span class="at">mu=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank exact test

data:  diabk$dif
V = 83, p-value = 0.2078
alternative hypothesis: true location is not equal to 0</code></pre>
</div>
</div>
<p>or alternatively</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(diabk<span class="sc">$</span>kcal1, diabk<span class="sc">$</span>kcal2, <span class="at">paired=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank exact test

data:  diabk$kcal1 and diabk$kcal2
V = 83, p-value = 0.2078
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p>The result shows there is no significant difference between the paired measurements (P=0.21).</p>
</section>
<section id="single-sample-two-variables" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="single-sample-two-variables"><span class="header-section-number">12.4</span> Single sample, two variables</h2>
<p>To illustrate the use of the Spearman’s correlation coefficient we use the systolic blood pressure and cholesterol level measured in the Whitehall civil servants. Import the data and plot the two variables against each other.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>whitehall <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"whall10.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(whitehall<span class="sc">$</span>chol, whitehall<span class="sc">$</span>sbp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-157-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Then calculate the Spearman’s coefficient.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(whitehall<span class="sc">$</span>sbp, whitehall<span class="sc">$</span>chol, <span class="at">method =</span> <span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.0004221175</code></pre>
</div>
</div>
<p>There is no evidence to suggest a correlation between these two variables.</p>
</section>
<section id="exercises-9" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="exercises-9"><span class="header-section-number">12.5</span> Exercises</h2>
<p>Have a go on your own now (the solutions are in Section 3).</p>
<ol type="1">
<li>Import the whall10.csv and calculate the median systolic blood pressure in the Whitehall sample. Test whether the median is equal to 120mmHg.</li>
<li>Compare the cholesterol levels of High and Low grade civil servants using a parametric and then a non-parametric method.</li>
<li>Import the skinfold data, skinf.csv. Use a non-parametric method to test whether there is a difference between the two skinfold measurements.</li>
<li>Import the babies data. Plot gestwks against matage and then calculate the r Spearman’s correlation coefficient.</li>
</ol>
</section>
</section>
<section id="practical-wb16-sample-size" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Practical WB16: Sample size</h1>
<p>Now you are going to use R to obtain sample size calculations. In doing this you will apply the statistical methods introduced in SE16.</p>
<p>You do not need to use a dataset in this session.</p>
<section id="sample-size-to-test-a-hypothesis-comparison-of-proportions" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="sample-size-to-test-a-hypothesis-comparison-of-proportions"><span class="header-section-number">13.1</span> Sample size to test a hypothesis: comparison of proportions</h2>
<p>We are going to start by considering how to use R to obtain a sample size calculation when we are interested in comparing two proportion – as outlined in the study material for SE16. The CAL material describes the hand calculation of the required sample size for the comparison of 2 proportions. We considered a trial of insecticide impregnated bednets, in which we are interested in the prevalence of enlarged spleen in the treatment group compared with that in the intervention group. Previous data indicated that we should expect a prevalence of enlarged spleen of 40%. We wished to calculate a sample size necessary to detect a prevalence of 20% in the treatment group. We don’t need to calculate the difference in proportions this time.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1 =</span> <span class="fl">0.4</span>, <span class="at">p2 =</span> <span class="fl">0.2</span>, <span class="at">power =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample comparison of proportions power calculation 

              n = 108.2355
             p1 = 0.4
             p2 = 0.2
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>As previously we can vary the parameters in the above command. For example, if we wish to detect a prevalence of 35% in the treatment group (a drop of only 5%) we would use the following command:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1 =</span> <span class="fl">0.4</span>, <span class="at">p2 =</span> <span class="fl">0.35</span>, <span class="at">power =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample comparison of proportions power calculation 

              n = 1968.064
             p1 = 0.4
             p2 = 0.35
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>Note that because we now wish to detect a far smaller difference, a larger sample size is required.</p>
</section>
<section id="sample-size-to-test-a-hypothesis-odds-ratio" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="sample-size-to-test-a-hypothesis-odds-ratio"><span class="header-section-number">13.2</span> Sample size to test a hypothesis: Odds Ratio</h2>
<p>At the start of this practical session, we considered how to conduct a sample size calculation when comparing two proportions in a clinical trial of insecticide-impregnated bednets. We can also use the same sample size formulae when we are designing a case-control study In the CAL material we discussed a case-control study comparing method of infant feeding (bottle or breast) amongst cases of death from acute respiratory infection, and controls. We wished to detect a minimum 2-fold increase in death associated with bottle-feeding, compared to infants who were breast-fed, that is an Odds Ratio of 2.<br>
</p>
<p>From reading previously published work we know that the percentage of bottle-fed controls is around 40%. The command power.prop.test() uses the following arguments:<br>
</p>
<pre><code>n : number of observations (per group)
p1 : probability or proportion in one group
p2 : probability or proportion in other group
sig.level : significance level (Type I error probability)
power : power of test (1 minus Type II error probability)</code></pre>
<p>All but one of the arguments must be specified, and the left over argument will be calculated. sig.level defaults to 0.05.<br>
</p>
<p>We have an odds ratio of interest (2) but not a different in proportions which is what is needed for this function. We need to use our odds ratio and our proportion to calculate the effect size we are interested in.<br>
</p>
<p>Our proportion 0.4 can be rewritten as 4/10<br>
We can then convert this to odds by subtracting 4 (the top number) from the bottom number: 4/(10-4)=4/6<br>
We want to detect a two fold increase in odds, so we can multiply this by 2: 4/6×2=8/6<br>
Then to convert this back to a proportion, we add 8 (the top number) to the bottom number: 8/(6+8)=8/14<br>
We can turn this calculation into our own function like this:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>or2prop <span class="ot">&lt;-</span> <span class="cf">function</span>(p1, or){</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> (p1 <span class="sc">*</span> or) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> p1 <span class="sc">+</span> p1 <span class="sc">*</span> or)</span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(b)</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The function is called or2prop. It uses the arguments p1 (first proportion) and or (odds ratio of interest) to calculate p2. We can run it to do the calculation for us</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">or2prop</span>(<span class="fl">0.4</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5714286</code></pre>
</div>
</div>
<p>We use this number as our second proportion in our power calculation using the function power.prop.test()</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1 =</span> <span class="fl">0.4</span>, <span class="at">p2 =</span> <span class="fl">0.5714286</span>, <span class="at">power =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample comparison of proportions power calculation 

              n = 176.5397
             p1 = 0.4
             p2 = 0.5714286
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>You will notice that this value is slightly smaller than that calculated by hand in SC17 6.3. This is because in the hand calculated version we rounded the proportion of cases exposed (shown as p2 in the output here, but referred to as <span class="math inline">\(\pi\)</span>_1 in the CAL material) to 0.57. Here R is using 0.5714286 as the proportion of exposed cases.<br>
</p>
<p>We may wish to alter some or all of the parameters, for example we may wish to calculate the sample size for 30% exposure among controls:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1 =</span> <span class="fl">0.3</span>, <span class="at">p2 =</span> <span class="fu">or2prop</span>(<span class="fl">0.3</span>, <span class="dv">2</span>), <span class="at">power =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample comparison of proportions power calculation 

              n = 187.7983
             p1 = 0.3
             p2 = 0.4615385
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>We may also wish to calculate the sample size for 80% power (rather than 90%), as follows:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1 =</span> <span class="fl">0.4</span>, <span class="at">p2 =</span> <span class="fu">or2prop</span>(<span class="fl">0.4</span>, <span class="dv">2</span>), <span class="at">power =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample comparison of proportions power calculation 

              n = 132.2459
             p1 = 0.4
             p2 = 0.5714286
      sig.level = 0.05
          power = 0.8
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>A larger difference will result in a smaller minimum sample size, for example</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1 =</span> <span class="fl">0.4</span>, <span class="at">p2 =</span> <span class="fu">or2prop</span>(<span class="fl">0.4</span>, <span class="dv">3</span>), <span class="at">power =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample comparison of proportions power calculation 

              n = 53.74794
             p1 = 0.4
             p2 = 0.6666667
      sig.level = 0.05
          power = 0.8
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
</section>
<section id="sample-size-to-test-a-hypothesis-comparison-of-means" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="sample-size-to-test-a-hypothesis-comparison-of-means"><span class="header-section-number">13.3</span> Sample size to test a hypothesis: comparison of means</h2>
<p>We will now consider how to use R to obtain the sample size calculation demonstrated in SC17 section 6.7. In the CAL material we discussed a trial comparing mean Packed Cell Volume (PCV) between those randomised to either insecticide impregnated bednet (intervention) or no bednet (control). We expected a mean PCV of 33 in the control group, with a standard deviation of 5. We wish to detect a difference of 1.5 in the PCV between the treatment and control group i.e.&nbsp;we expect those randomised to impregnated bednets to have a PCV of 34.5. We expect a standard deviation in this group of 5, there is no reason to expect any difference in variation.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.t.test</span>(<span class="at">delta =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="dv">5</span>, <span class="at">power =</span> <span class="fl">0.9</span>, <span class="at">type =</span> <span class="st">"two.sample"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 234.4628
          delta = 1.5
             sd = 5
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>Here, we require a sample size of 235 per group (compared with 234 calculated by hand in the CAL material)<br>
</p>
<p>Again we can change any parameters. The default significance level is 5%, if this is the required level it does not have to be explicitly specified in the command. The sig.level argument may be used to specify a different level of significance, for example:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.t.test</span>(<span class="at">delta =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="dv">5</span>, <span class="at">power =</span> <span class="fl">0.9</span>, <span class="at">sig.level =</span> <span class="fl">0.01</span>, <span class="at">type =</span> <span class="st">"two.sample"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 332.316
          delta = 1.5
             sd = 5
      sig.level = 0.01
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>Note that the actual means do not affect the sample size, it is the size of their difference that counts so it does not matter that we do not explicitly specify them. So we could put in any values for the 2 means, providing they have a difference of 1.5.</p>
</section>
<section id="calculation-of-power-given-fixed-sample-size" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="calculation-of-power-given-fixed-sample-size"><span class="header-section-number">13.4</span> Calculation of power, given fixed sample size</h2>
<p>We will use the example given in SC17 section 7.1 of the EPM102 CAL material, in which the power is calculated for the study design described in SC17 section 6.2. We know that the percentage of controls exposed to bottle-feeding (the exposure) is 40% and wish to detect a minimum Odds Ratio of 2. Our previous calculations indicated that with 90% power and 5% significance level the minimum required sample size was 179.5 per group i.e.&nbsp;180 cases and 180 controls.<br>
</p>
<p>Again, we use the power command, with our own function or2prop. Note that we specify the sample size for each group, rather than overall.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1 =</span> <span class="fl">0.4</span>, <span class="at">p2 =</span> <span class="fu">or2prop</span>(<span class="fl">0.4</span>, <span class="dv">2</span>), <span class="at">n =</span> <span class="dv">180</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample comparison of proportions power calculation 

              n = 180
             p1 = 0.4
             p2 = 0.5714286
      sig.level = 0.05
          power = 0.9054847
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>Similarly we may use the power command to determine the power to detect a specified difference between the means of 2 samples, with known SD. For the earlier example comparing mean PCV between the group receiving impregnated bednets and the control group, we wished to detect a minimum difference of 1.5, with standard deviation 5 in each group. Our previous calculations indicated that with 90% power and 5% significance level the minimum required sample size was 235 participants per group.<br>
</p>
<p>We would type the following in R:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.t.test</span>(<span class="at">delta =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="dv">5</span>, <span class="at">n =</span> <span class="dv">235</span>, <span class="at">type =</span> <span class="st">"two.sample"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 235
          delta = 1.5
             sd = 5
      sig.level = 0.05
          power = 0.9006524
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>Reassuringly we find that the power in both examples is around 90%, which is what we would have expected, since earlier calculations in this practical obtained sample sizes based on a fixed power of 90%.</p>
</section>
<section id="exercises-10" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="exercises-10"><span class="header-section-number">13.5</span> Exercises</h2>
<p>Now use R to obtain the following sample size calculations.<br>
</p>
<ol type="1">
<li>Complete the table below showing the minimum number of cases required in a case-control study, with an equal number of cases and controls, for different values of minimum OR required to detect and different levels of exposure among the controls. Two of the combinations have been completed for you.<br>
</li>
</ol>
<!-- -->
<ol type="i">
<li>What happens as the OR moves further away from 1?</li>
<li>How does level of exposure among controls affect the required sample size?</li>
</ol>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Exposure level among control</th>
<th style="text-align: left;">5%</th>
<th style="text-align: left;">10</th>
<th style="text-align: left;">40%</th>
<th style="text-align: left;">80%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">OR=0.5</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">OR=1.5</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">OR=2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">177</td>
<td style="text-align: left;">348</td>
</tr>
<tr class="even">
<td style="text-align: left;">OR=3</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<ol start="2" type="1">
<li>Researchers wish to conduct a randomised controlled trial of a drug thought to prevent disease A. They propose a 2 armed trial comparing prevalence of disease A among those receiving the drug with prevalence of disease A amongst those receiving the placebo. Currently in the adult population, disease A has a prevalence of 40%. Complete the table below showing the minimum number of subjects required in the treatment group, assuming equal numbers of subjects in the treatment &amp; no treatment groups, for different values of the expected prevalence in the treatment group, and different values of power.<br>
Two of the combinations have been completed for you.<br>
</li>
</ol>
<!-- -->
<ol type="i">
<li>How does increasing the power affect the sample size?</li>
</ol>
<p>Prevalence among treatment group = 40%, significance level = 5%</p>
<table class="caption-top table">
<colgroup>
<col style="width: 70%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Prevalence of disease expected in treatment group</th>
<th style="text-align: left;">10%</th>
<th style="text-align: left;">20%</th>
<th style="text-align: left;">30%</th>
<th style="text-align: left;">35%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Power = 80%</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Power = 90%</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">109</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">1969</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Power = 95%</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<ol start="3" type="1">
<li>Researchers wished to investigate the results of a blood test following treatment with a new drug. They expected a mean of 6.1 units (SD 2.3 units) in the control group, with a standard deviation of 2.3 units. Calculate the sample size required for each group to detect different values of a clinically important difference in blood test result at different levels of significance, with power set at 90%. Two of the combinations have been completed for you.<br>
</li>
</ol>
<!-- -->
<ol type="i">
<li>How does the change in significance level affect required sample size?<br>
</li>
<li>How does an increase in standard deviation affect the required sample size?<br>
Standard deviation = 2.3; power of study = 90% Clinically important difference in blood test result 0.5 1 1.5 2 Significance=5%<br>
Significance=1% 160 42</li>
</ol>
<table class="caption-top table">
<colgroup>
<col style="width: 72%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Clinically important difference in blood test result</th>
<th style="text-align: left;">0.5</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">1.5</th>
<th style="text-align: left;">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Significance=5%</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Significance=1%</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">160</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">42</td>
</tr>
</tbody>
</table>
<p>Using R, determine the power to detect a difference of at least 0.05 between 2 proportions, in a sample size of 600 individuals per group.</p>
</section>
</section>
<section id="practical-wb02-solutions" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> Practical WB02 Solutions</h1>
<p><strong>Load packages required for this session.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Import the babies data.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>babies <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"babies.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol type="1">
<li>Examine the data and determine the data type for each variable (eg. binary, nominal, ordered, quantitative discrete or continuous).</li>
</ol>
<p>Initially we can try looking at the class of all the variables</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">|&gt;</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       id  matage     hyp gestwks     sex bweight
1 integer integer integer numeric integer integer</code></pre>
</div>
</div>
<p>Unfortunately, these are all numeric so this doesn’t tell us much. Instead we can have a look at the data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(babies, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   id matage hyp gestwks sex bweight
1   1     33   2   37.74   1    2410
2   2     34   2   39.15   1    2977
3   3     34   2   35.72   1    2100
4   4     30   2   39.29   2    3270
5   5     35   2   38.38   1    2620
6   6     37   2   37.86   2    3260
7   7     31   2   40.06   2    3750
8   8     31   1   34.81   1    1450
9   9     33   1   38.81   2    3200
10 10     33   2   40.35   1    3675</code></pre>
</div>
</div>
<p>This shows us the first ten rows of the data. We can see that matage, gestwks and bweight seem to be numeric, while sex and hyp are binary.</p>
<ol start="2" type="1">
<li>Produce frequency tables for sex and hypertension and use these to answer the following questions:</li>
</ol>
<!-- -->
<ol type="i">
<li>How many male infants were there?</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(babies<span class="sc">$</span>sex, <span class="at">useNA =</span> <span class="st">"ifany"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2 
315 326 </code></pre>
</div>
</div>
<p>We know from appendix 1 that a value of 1 represents male sex, so there are 315 male infants ii) How many mothers were hypertensive during pregnancy?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(babies<span class="sc">$</span>hyp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2 
 89 552 </code></pre>
</div>
</div>
<pre><code>In appendix 1, a value of 1 means hypertension, so there were 89 hypertensive mothers</code></pre>
<ol start="3" type="1">
<li>Now produce two-way table for hypertension and sex.</li>
</ol>
<!-- -->
<ol type="i">
<li>How many male infants were born to hypertensive mothers?</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(babies<span class="sc">$</span>hyp, babies<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
      1   2
  1  37  52
  2 278 274</code></pre>
</div>
</div>
<p>There were 37 male infants born to hypertensive mothers 4. Produce a table to answer the following question. i) What percentage of male infants were born to hypertensive mothers?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>  babies<span class="sc">$</span>sex,</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>  babies<span class="sc">$</span>hyp,</span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">prop.r =</span> <span class="cn">TRUE</span>, </span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prop.c =</span> <span class="cn">FALSE</span>, </span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prop.t =</span> <span class="cn">FALSE</span>,</span>
<span id="cb295-7"><a href="#cb295-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prop.chisq =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|           N / Row Total |
|-------------------------|

 
Total Observations in Table:  641 

 
             | babies$hyp 
  babies$sex |         1 |         2 | Row Total | 
-------------|-----------|-----------|-----------|
           1 |        37 |       278 |       315 | 
             |     0.117 |     0.883 |     0.491 | 
-------------|-----------|-----------|-----------|
           2 |        52 |       274 |       326 | 
             |     0.160 |     0.840 |     0.509 | 
-------------|-----------|-----------|-----------|
Column Total |        89 |       552 |       641 | 
-------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p>11.7% of male infants were born to hypertensive mothers</p>
<ol start="5" type="1">
<li>Obtain the mean, median and standard deviation for the three variables birthweight, maternal age and gestational age.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">|&gt;</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bweight, matage, gestwks) <span class="sc">|&gt;</span></span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(</span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mean =</span> <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">med  =</span> <span class="sc">~</span> <span class="fu">median</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sd   =</span> <span class="sc">~</span> <span class="fu">sd</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb297-8"><a href="#cb297-8" aria-hidden="true" tabindex="-1"></a>                   )))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  bweight_mean bweight_med bweight_sd matage_mean matage_med matage_sd
1     3129.137        3200   652.7827    33.97192         34   3.87046
  gestwks_mean gestwks_med gestwks_sd
1     38.68725       39.15   2.329931</code></pre>
</div>
</div>
<ol start="6" type="1">
<li>Produce a histogram for birthweight, maternal age and gestational age.</li>
</ol>
<!-- -->
<ol type="i">
<li>What can you conclude about the distribution of A. birthweight?</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(babies<span class="sc">$</span>bweight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-180-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Birthweight seems fairly normally distributed, perhaps with a longer lower tail B. maternal age?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(babies<span class="sc">$</span>matage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-181-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<pre><code>Maternal age also seems fairly normally distributed
C. gestational age?</code></pre>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">hist</span>(babies<span class="sc">$</span>gestwks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-182-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<pre><code>This is a skewed distribution</code></pre>
<ol start="2" type="i">
<li>Do you think mean or median is the more appropriate measure of location for these three variables? Birthweight and maternal age would use the mean, and gestational age the median</li>
</ol>
<!-- -->
<ol start="7" type="1">
<li>Produce a scatterplot of the relationship between birthweight and weeks of gestation.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(babies<span class="sc">$</span>gestwks, babies<span class="sc">$</span>bweight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-183-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="practical-wb05-solutions" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> Practical WB05 solutions</h1>
<p><strong>Load packages required for this session.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol type="1">
<li>Import the Whitehall data set, whall10.csv, and familiarise yourself with the data. A brief description is in the Appendix. How many records are held in the data set? Are there any missing values for the variables id, sbp and chol?</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>whitehall <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"whall10.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(whitehall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1677</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>whitehall <span class="sc">|&gt;</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, sbp, chol) <span class="sc">|&gt;</span></span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(<span class="at">missing =</span> <span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  id_missing sbp_missing chol_missing
1          0           0            0</code></pre>
</div>
</div>
<p><em>There are 1677 records in the dataset and no missing values of id, sbp or chol</em></p>
<ol start="2" type="1">
<li>Compute the sample mean systolic blood pressure and its 95% confidence interval. Look at the distribution of systolic blood pressure to assess whether or not you think it is appropriate to use the mean in this case.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(whitehall<span class="sc">$</span>sbp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 135.8223</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(whitehall<span class="sc">$</span>sbp)<span class="sc">$</span>conf.int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 134.8158 136.8288
attr(,"conf.level")
[1] 0.95</code></pre>
</div>
</div>
<p><em>The sample mean systolic blood pressure is 135.82mmHg, with corresponding 95% confidence interval 134.82mmHg to 136.83mmHg</em></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>sbp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-189-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>Looks reasonably symmetrical, so use of the mean is appropriate in this case.</em></p>
<ol start="3" type="1">
<li>Do the same for cholesterol level.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(whitehall<span class="sc">$</span>chol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 196.5391</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(whitehall<span class="sc">$</span>chol)<span class="sc">$</span>conf.int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 194.3302 198.7479
attr(,"conf.level")
[1] 0.95</code></pre>
</div>
</div>
<p><em>The sample mean cholesterol level is 196.54mg/dl, with corresponding 95% confidence interval 194.33mg/dl to 198.75mg/dl</em></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>chol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-191-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>Again, looks reasonably symmetrical, so appropriate to use the mean.</em></p>
<ol start="4" type="1">
<li>Test whether the population systolic blood pressure (that is the systolic blood pressure of all civil servants in the UK) is equal to 135mmHg or different from 135mmHg. What is the P-value? How would you report the result?</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(whitehall<span class="sc">$</span>sbp, <span class="at">mu =</span> <span class="dv">135</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  whitehall$sbp
t = 1.6024, df = 1676, p-value = 0.1093
alternative hypothesis: true mean is not equal to 135
95 percent confidence interval:
 134.8158 136.8288
sample estimates:
mean of x 
 135.8223 </code></pre>
</div>
</div>
<p><strong>Reporting and Interpretation</strong></p>
<p><em>There is little evidence against the null hypothesis that mean systolic blood pressure in this population is equal to 135mmHg (p=0.1093). A sample mean of this size, or larger, is likely to occur by chance, in a population with mean 135mmHg.</em></p>
<ol start="5" type="1">
<li>Test whether the population cholesterol level is equal to 190mg/dl or different from 190mg/dl. What is the P-value? How would you report the result?</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(whitehall<span class="sc">$</span>chol, <span class="at">mu=</span><span class="dv">190</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  whitehall$chol
t = 5.8065, df = 1676, p-value = 7.615e-09
alternative hypothesis: true mean is not equal to 190
95 percent confidence interval:
 194.3302 198.7479
sample estimates:
mean of x 
 196.5391 </code></pre>
</div>
</div>
<p><strong>Reporting and interpretation</strong></p>
<p><em>There is very strong evidence against the null hypothesis that the mean cholesterol level in the population is equal to 190mg/dl (p&lt;0.0001). A mean this different from 190mg/dl is very unlikely to have occurred by chance alone.</em></p>
</section>
<section id="practical-wb06-solutions" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> Practical WB06 solutions</h1>
<p><strong>Load packages required for this session.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol type="1">
<li>The dataset called Diabk.csv holds the data on 15 diabetic patients who were involved in an educational programme to improve their diet (see Appendix). Their average daily calories intake was measured one week before and one week after the intervention. The two measurements are called kcal1 and kcal2. Import and examine the data.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>diabk <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"diabk.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diabk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       id           kcal1          kcal2     
 Min.   : 1.0   Min.   :1233   Min.   :1323  
 1st Qu.: 4.5   1st Qu.:1722   1st Qu.:1636  
 Median : 8.0   Median :1910   Median :1775  
 Mean   : 8.0   Mean   :1862   Mean   :1783  
 3rd Qu.:11.5   3rd Qu.:2108   3rd Qu.:1895  
 Max.   :15.0   Max.   :2159   Max.   :2391  </code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Compute the sample mean difference in calorie intake before and after the intervention, examine its distribution and then calculate its 95% confidence interval. Test whether the mean difference is equal to 0 kcal/day. Interpret your results and comment on any relationship between the P-value and the confidence interval.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>diabk <span class="ot">&lt;-</span> diabk<span class="sc">|&gt;</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dif =</span> kcal2 <span class="sc">-</span> kcal1)</span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(diabk<span class="sc">$</span>dif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-197-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>The histogram shows that the distribution is skewed</em></p>
<p><em>Let’s proceed, but keep in mind that the assumption of a symmetrical distribution is not really satisfied. We will use these data again in WB16.</em></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(diabk<span class="sc">$</span>dif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  diabk$dif
t = -1.4684, df = 14, p-value = 0.1641
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 -193.90042   36.30042
sample estimates:
mean of x 
    -78.8 </code></pre>
</div>
</div>
<p><em>The sample mean difference is 78.8 kcal/day, that is the average daily calorie intake is 78.8 kcal/day lower following the intervention. The associated 95% confidence interval is -36.30 kcal/day to 193.90 kcal/day. That is we are 95% certain that, in the population, the average change in daily intake is between 36 kcal/day higher than before intervention and 193.90 kcal/day lower than before intervention. A t-test suggests little/no evidence against the null hypothesis of no difference in intake following intervention (p=0.1641). The p-value is greater than 0.05 and so is supported by the 95% confidence interval which includes 0, the value under the null hypothesis.</em></p>
<p><em>Alternatively, the paired t-test can be conducted using the following command:</em></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(diabk<span class="sc">$</span>kcal1, diabk<span class="sc">$</span>kcal2, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Paired t-test

data:  diabk$kcal1 and diabk$kcal2
t = 1.4684, df = 14, p-value = 0.1641
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 -36.30042 193.90042
sample estimates:
mean difference 
           78.8 </code></pre>
</div>
</div>
<p><em>Note that paired test results are the same as those from the one-sample result carried out on the difference variable. (Results are only comparable in the case of paired data. We would be unable to calculate a “difference” variable in the case of unpaired data)</em></p>
<ol start="3" type="1">
<li>Import into R the babies data. Compute separately the sample mean birthweight of babies born to mothers who suffered, or did not suffer, from hypertension during pregnancy. Obtain a 95% confidence interval for the mean difference in birthweight between the 2 groups and test whether the mean difference is equal to 0 grams. Report your results.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a>babies <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"babies.csv"</span>)</span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">|&gt;</span></span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hyp) <span class="sc">|&gt;</span></span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(bweight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
    hyp  mean
  &lt;int&gt; &lt;dbl&gt;
1     1 2742.
2     2 3192.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(babies<span class="sc">$</span>bweight <span class="sc">~</span> babies<span class="sc">$</span>hyp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  babies$bweight by babies$hyp
t = -4.9991, df = 104.07, p-value = 2.341e-06
alternative hypothesis: true difference in means between group 1 and group 2 is not equal to 0
95 percent confidence interval:
 -627.6273 -271.1197
sample estimates:
mean in group 1 mean in group 2 
       2742.157        3191.531 </code></pre>
</div>
</div>
<p><span style="color:firebrick">Here the two variables in the t.test() call are separated by “~” in order to group the bweight by the hypertension status.</span></p>
<p><em>Mean birthweights of babies born to hypertensive and non-hypertensive mothers were 2742.2g and 3191.5g respectively. In this sample babies born to hypertensive mothers weighed on average 449.4g less than babies born to non-hypertensive mothers. We are 95% certain that, in the population represented by these mothers the mean difference in birthweight between babies born to non-hypertensive mothers and babies born to hypertensive mothers is between 627.63 and 271.12g.</em></p>
<p><em>A t-test show strong evidence against the null hypothesis of no difference in birthweight between the 2 groups, with P&lt;0.0001</em></p>
</section>
<section id="practical-wb10-solutions" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> Practical WB10 solutions</h1>
<p><strong>Load packages required for this session.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol type="1">
<li>Create a variable called npa2 which regroups the variable pa1, number of sexual partners in the past year to a binary variable where 1=none or 1; 2 = 2 or more. Check that the new variable has the correct codes using table().</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>mwanza <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"mwanza.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mwanza<span class="sc">$</span>pa1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3   4   9 
 74 598  63  26   2 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>mwanza <span class="ot">&lt;-</span> mwanza <span class="sc">|&gt;</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">npa2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>      pa1 <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a>      pa1 <span class="sc">%in%</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a>      pa1 <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb342-8"><a href="#cb342-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mwanza<span class="sc">$</span>npa2, mwanza<span class="sc">$</span>pa1, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      
         1   2   3   4   9 &lt;NA&gt;
  0     74 598   0   0   0    0
  1      0   0  63  26   0    0
  &lt;NA&gt;   0   0   0   0   2    0</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Obtain a 2x2 table of case by npa2. How does the proportion of cases exposed to 2 or more partners in the past year compare to the proportion of controls exposed to two or more partners in the past year?</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mwanza<span class="sc">$</span>npa2, mwanza<span class="sc">$</span>case)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
      0   1
  0 517 155
  1  56  33</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb347"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(mwanza<span class="sc">$</span>npa2, mwanza<span class="sc">$</span>case),<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
             0          1
  0 0.90226876 0.82446809
  1 0.09773124 0.17553191</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb349"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(mwanza<span class="sc">$</span>npa2, mwanza<span class="sc">$</span>case, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  mwanza$npa2 and mwanza$case
X-squared = 8.2967, df = 1, p-value = 0.003972</code></pre>
</div>
</div>
<p>The percentage of cases with 2 or more partners is twice that for controls (17.55% compared to 9.77%). P=0.004 means that we have strong evidence against the null hypothesis of no association between HIV infection and number of sexual partners in the last year, in this population of women.</p>
<ol start="3" type="1">
<li>Obtain an odds ratio estimate for the association between case and npa2. In R we need to load the DescTools package</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OddsRatio</span>(<span class="fu">table</span>(mwanza<span class="sc">$</span>case, mwanza<span class="sc">$</span>npa2), </span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf.level =</span> <span class="fl">0.95</span></span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a>          )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>odds ratio     lwr.ci     upr.ci 
  1.965553   1.233315   3.132531 </code></pre>
</div>
</div>
<p>The Odds Ratio when the exposure of interest is 2 or more sexual partners is 1.97 (95% CI 1.23 to 3.14), suggesting that HIV infection is more likely among those with 2 or more sexual partners than those with 1 or no sexual partners.</p>
<ol start="4" type="1">
<li>Examine whether the effect of 2 or more sexual partners in the past year is confounded by level of education. Generate a variable ed2 where 0 = none/adult only 1 = 1+years. Do you think the stratified odds ratios for each level of education or the adjusted Mantel-Haenszel odds ratio should be presented?</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a>mwanza <span class="ot">&lt;-</span> mwanza <span class="sc">|&gt;</span></span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ed2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a>      ed <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a>      ed <span class="sc">%in%</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb353-6"><a href="#cb353-6" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb353-7"><a href="#cb353-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mwanza<span class="sc">$</span>ed, mwanza<span class="sc">$</span>ed2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
      0   1
  1 312   0
  2   0  75
  3   0 365
  4   0  11</code></pre>
</div>
</div>
<p>Ed2 is coded correctly</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mantelhaen.test</span>(mwanza<span class="sc">$</span>case, mwanza<span class="sc">$</span>npa2, mwanza<span class="sc">$</span>ed2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Mantel-Haenszel chi-squared test with continuity correction

data:  mwanza$case and mwanza$npa2 and mwanza$ed2
Mantel-Haenszel X-squared = 5.8258, df = 1, p-value = 0.01579
alternative hypothesis: true common odds ratio is not equal to 1
95 percent confidence interval:
 1.159982 3.033112
sample estimates:
common odds ratio 
         1.875728 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OddsRatio</span>(<span class="fu">table</span>(mwanza<span class="sc">$</span>case[mwanza<span class="sc">$</span>ed2 <span class="sc">==</span> <span class="dv">0</span>], </span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>                mwanza<span class="sc">$</span>npa2[mwanza<span class="sc">$</span>ed2 <span class="sc">==</span> <span class="dv">0</span>]), </span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>odds ratio     lwr.ci     upr.ci 
0.38625205 0.08864065 1.68309510 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OddsRatio</span>(<span class="fu">table</span>(mwanza<span class="sc">$</span>case[mwanza<span class="sc">$</span>ed2 <span class="sc">==</span> <span class="dv">1</span>], </span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a>                mwanza<span class="sc">$</span>npa2[mwanza<span class="sc">$</span>ed2 <span class="sc">==</span> <span class="dv">1</span>]), </span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>odds ratio     lwr.ci     upr.ci 
  2.688580   1.553003   4.654507 </code></pre>
</div>
</div>
<p>The effect of exposure to 2 or more partners upon HIV infection is greater among women with education compared to women with no education: In women with no education, for exposure to 2 or more partners, OR=0.39. In women with education, for exposure to 2 or more partners, OR = 2.69. The results in each stratum are very different and so the ORS should be presented separately</p>
</section>
<section id="practical-wb11-solutions" class="level1" data-number="18">
<h1 data-number="18"><span class="header-section-number">18</span> Practical WB11 solutions</h1>
<p><strong>Load packages required for this session.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol type="1">
<li>Obtain a matched 2x2 table for birthweight group (variable bwtgp: takes value 1 if birth weight 3kg or more, and value 2 if birthweight &lt; 3kg) and diarrhoea mortaility.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a>diabraz <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"diabraz.csv"</span>)</span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a>pairdata <span class="ot">&lt;-</span> diabraz <span class="sc">|&gt;</span></span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case, bwtgp, pair) <span class="sc">|&gt;</span></span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">value =</span> bwtgp, <span class="at">key =</span> case) <span class="sc">|&gt;</span></span>
<span id="cb363-6"><a href="#cb363-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">bwtgp1 =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>, <span class="at">bwtgp2 =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>)</span>
<span id="cb363-7"><a href="#cb363-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-8"><a href="#cb363-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pairdata<span class="sc">$</span>bwtgp1, pairdata<span class="sc">$</span>bwtgp2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
     1  2
  1 31 25
  2 18 12</code></pre>
</div>
</div>
<p>Alternatively, the table can be obtained with CrossTable()</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(pairdata<span class="sc">$</span>bwtgp1, pairdata<span class="sc">$</span>bwtgp2, </span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.c =</span> <span class="cn">FALSE</span>,      </span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.chisq =</span> <span class="cn">FALSE</span>,  </span>
<span id="cb365-4"><a href="#cb365-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.r =</span> <span class="cn">FALSE</span>,      </span>
<span id="cb365-5"><a href="#cb365-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.t =</span> <span class="cn">FALSE</span>)      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|-------------------------|

 
Total Observations in Table:  86 

 
                | pairdata$bwtgp2 
pairdata$bwtgp1 |         1 |         2 | Row Total | 
----------------|-----------|-----------|-----------|
              1 |        31 |        25 |        56 | 
----------------|-----------|-----------|-----------|
              2 |        18 |        12 |        30 | 
----------------|-----------|-----------|-----------|
   Column Total |        49 |        37 |        86 | 
----------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p><em>18 pairs where the case is &gt;=3kg and the control &lt; 3kg</em></p>
<p><em>25 pairs where the control is &gt;=3kg and the case is &lt; 3kg</em></p>
<ol start="2" type="1">
<li>Calculate the matched odds ratio for bwtgp.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span> <span class="sc">/</span> <span class="dv">18</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.388889</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Use the mantelhaen.test() command to obtain an odds ratio (and 95% confidence interval) for bwtgp.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mantelhaen.test</span>(diabraz<span class="sc">$</span>bwtgp, diabraz<span class="sc">$</span>case, diabraz<span class="sc">$</span>pair, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Mantel-Haenszel chi-squared test without continuity correction

data:  diabraz$bwtgp and diabraz$case and diabraz$pair
Mantel-Haenszel X-squared = 1.1395, df = 1, p-value = 0.2858
alternative hypothesis: true common odds ratio is not equal to 1
95 percent confidence interval:
 0.7577807 2.5456075
sample estimates:
common odds ratio 
         1.388889 </code></pre>
</div>
</div>
<p><em>The OR takes a value of 1.39 (95% CI 0.76, 2.55) which suggests that low birthweight leads to an increased risk of diarrhoea mortality - but p = 0.29, so there is no evidence against the null hypothesis, ie no evidence of an association between birthweight and diarrhoea mortality in the population from which this sample was selected. In addition note that 1.0 the value of OR under the null hypothesis, is included in the 95% confidence interval.</em></p>
<ol start="4" type="1">
<li>Obtain a matched 2x2 table for water supply (variable wat2: takes value 1 if water available in house or on plot, and value 2 if no private water supply) and diarrhoea mortaility.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a>pairdata <span class="ot">&lt;-</span> diabraz <span class="sc">|&gt;</span></span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case, wat2, pair) <span class="sc">|&gt;</span></span>
<span id="cb371-3"><a href="#cb371-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">value =</span> wat2, <span class="at">key =</span> case) <span class="sc">|&gt;</span></span>
<span id="cb371-4"><a href="#cb371-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">wat1 =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>, <span class="at">wat2 =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>)</span>
<span id="cb371-5"><a href="#cb371-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-6"><a href="#cb371-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pairdata<span class="sc">$</span>wat1, pairdata<span class="sc">$</span>wat2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
     1  2
  1 56 11
  2  2 17</code></pre>
</div>
</div>
<p>Or using CrossTable()</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb373"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(pairdata<span class="sc">$</span>wat1, pairdata<span class="sc">$</span>wat2, </span>
<span id="cb373-2"><a href="#cb373-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.c =</span> <span class="cn">FALSE</span>,      </span>
<span id="cb373-3"><a href="#cb373-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.chisq =</span> <span class="cn">FALSE</span>,  </span>
<span id="cb373-4"><a href="#cb373-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.r =</span> <span class="cn">FALSE</span>,      </span>
<span id="cb373-5"><a href="#cb373-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prop.t =</span> <span class="cn">FALSE</span>)     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|-------------------------|

 
Total Observations in Table:  86 

 
              | pairdata$wat2 
pairdata$wat1 |         1 |         2 | Row Total | 
--------------|-----------|-----------|-----------|
            1 |        56 |        11 |        67 | 
--------------|-----------|-----------|-----------|
            2 |         2 |        17 |        19 | 
--------------|-----------|-----------|-----------|
 Column Total |        58 |        28 |        86 | 
--------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p><em>Two pairs where the case has access to water and the control does not</em></p>
<p><em>11 pairs where the control has access to water and the case does not</em></p>
<ol start="5" type="1">
<li>Calculate the matched odds ratio for wat2 without using mantelhane.test().</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span> <span class="sc">/</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.5</code></pre>
</div>
</div>
<ol start="6" type="1">
<li>Perform an unmatched analyses for the variable wat2. Compare this to the matched results.</li>
</ol>
<section id="matched-analysis" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="matched-analysis"><span class="header-section-number">18.1</span> Matched analysis</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mantelhaen.test</span>(diabraz<span class="sc">$</span>wat2, diabraz<span class="sc">$</span>case, diabraz<span class="sc">$</span>pair, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Mantel-Haenszel chi-squared test without continuity correction

data:  diabraz$wat2 and diabraz$case and diabraz$pair
Mantel-Haenszel X-squared = 6.2308, df = 1, p-value = 0.01255
alternative hypothesis: true common odds ratio is not equal to 1
95 percent confidence interval:
  1.219099 24.813414
sample estimates:
common odds ratio 
              5.5 </code></pre>
</div>
</div>
<p><em>The odds ratio of 5.5 suggests that there is a strong association between water supply and diarrhoea mortality, this is supported by the associated p-value of 0.013, providing evidence against the null hypothesis of no association. Note also that the value under the null hypothesis of OR=1 is excluded from the 95% confidence interval.</em></p>
<p><em>This is the odds ratio of being a case associated with no private water supply.</em></p>
</section>
<section id="unmatched-analysis" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="unmatched-analysis"><span class="header-section-number">18.2</span> Unmatched analysis</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OddsRatio</span>(<span class="fu">table</span>(diabraz<span class="sc">$</span>wat2, diabraz<span class="sc">$</span>case), </span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf.level =</span> <span class="fl">0.95</span></span>
<span id="cb379-3"><a href="#cb379-3" aria-hidden="true" tabindex="-1"></a>          )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>odds ratio     lwr.ci     upr.ci 
 1.7023593  0.8620992  3.3615938 </code></pre>
</div>
</div>
<p><em>Ignoring the matching, the effect of access to water on the risk of diarrhoea mortality is greatly underestimated, with an OR of only 1.70</em></p>
</section>
</section>
<section id="practical-wb12-solutions" class="level1" data-number="19">
<h1 data-number="19"><span class="header-section-number">19</span> Practical WB12 solutions</h1>
<p><strong>Load packages required for this session.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb381-2"><a href="#cb381-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb381-3"><a href="#cb381-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb381-4"><a href="#cb381-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol type="1">
<li>Summarize and produce a graph for the distribution of the variable maternal age (matage)</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb382"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a>babies<span class="ot">&lt;-</span><span class="fu">import</span>(<span class="st">"babies.csv"</span>) </span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a>babies<span class="sc">|&gt;</span></span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(matage), </span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">median</span>(matage), </span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">min =</span> <span class="fu">min</span>(matage),</span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">max =</span> <span class="fu">max</span>(matage))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      mean median min max
1 33.97192     34  23  43</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(babies<span class="sc">$</span>matage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-226-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>mean (33.97 years) and median (34 years) approximately equal – Normal Distribution</em></p>
<ol start="2" type="1">
<li>Display the relationship between birthweight (bweight) and maternal age (matage) in a scatterplot.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb385"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(babies<span class="sc">$</span>matage, babies<span class="sc">$</span>bweight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-227-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>The scatterplot of birthweight against maternal age suggests there is no association (linear or otherwise) between the 2 variables.</em></p>
<ol start="3" type="1">
<li>What is the correlation coefficient for the association between bweight and maternal age?</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(babies[, <span class="fu">c</span>(<span class="st">"bweight"</span>, <span class="st">"matage"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           bweight     matage
bweight 1.00000000 0.03371573
matage  0.03371573 1.00000000</code></pre>
</div>
</div>
<p><em>The correlation coefficient r=0.0337 suggests there is virtually no linear association between birthweight and maternal age. (Although note that we should also look at a scatter plot to look for non-linear associations. In this case there does not appear to be any).</em></p>
<ol start="4" type="1">
<li>Regress birthweight on maternal age. What is the regression equation? What is the value of the regression coefficient and how is it interpreted? Is the slope of the regression line significantly different from zero?</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(bweight<span class="sc">~</span>matage, <span class="at">data =</span> babies)</span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bweight ~ matage, data = babies)

Residuals:
     Min       1Q   Median       3Q      Max 
-2487.92  -283.61    67.76   413.64  1509.33 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 2935.959    227.995  12.877   &lt;2e-16 ***
matage         5.686      6.668   0.853    0.394    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 652.9 on 639 degrees of freedom
Multiple R-squared:  0.001137,  Adjusted R-squared:  -0.0004264 
F-statistic: 0.7272 on 1 and 639 DF,  p-value: 0.3941</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  2.5 %     97.5 %
(Intercept) 2488.249353 3383.66837
matage        -7.407819   18.78065</code></pre>
</div>
</div>
<p><em>The regression equation is as follows:</em></p>
<p><span class="math display">\[
birthweight=2935+5.69 \times \text{maternal age in years}
\]</span></p>
<p><em>The value of the regression coefficient is 5.69. It means that for an increase of a year in maternal age, birthweight increases on average by 5.69 grams. The 95% confidence interval for the regression coefficient is -7.41 to 18.78, thus we are 95% certain the population value lies within these limits. Note that the value of 0 is included within these limits. A test of significance tests the null hypothesis that the regression coefficient is equal to zero - the resulting t-statistic has a value of 0.85 with corresponding P value of 0.394. We conclude there is no evidence against the null hypothesis.</em></p>
<ol start="5" type="1">
<li>Display the regression line on a scatterplot.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb392"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(babies<span class="sc">$</span>matage, </span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a>     babies<span class="sc">$</span>bweight, </span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Maternal age (years)"</span>, </span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Birthweight"</span></span>
<span id="cb392-5"><a href="#cb392-5" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb392-6"><a href="#cb392-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-7"><a href="#cb392-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-230-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="6" type="1">
<li>State, with reasons, whether or not you think a linear regression analysis of birthweight on maternal age was an appropriate method of analysis in this case.</li>
</ol>
<p>Strictly speaking, a linear regression analysis is not an appropriate method of investigation on these data, as there appears to be no linear association between maternal age and birthweight (See SC15 P6 of CAL material for list of assumptions for linear regression). If you continue on to EPM202, you will learn ways to test for non-linear associations, e.g.&nbsp;quadratic terms and turning quantitative measures into categorical measures.”</p>
</section>
<section id="practical-wb15-solutions" class="level1" data-number="20">
<h1 data-number="20"><span class="header-section-number">20</span> Practical WB15 solutions</h1>
<p><strong>Load packages required for this session.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb393"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol type="1">
<li>Import the whall10.csv and calculate the median systolic blood pressure in the Whitehall sample. Test whether the median is equal to 120mmHg.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="ot">&lt;-</span><span class="fu">import</span>(<span class="st">"whall10.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb395"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(whitehall<span class="sc">$</span>sbp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 133</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb397"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(whitehall<span class="sc">$</span>sbp, <span class="at">mu =</span> <span class="dv">120</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank test with continuity correction

data:  whitehall$sbp
V = 1162721, p-value &lt; 2.2e-16
alternative hypothesis: true location is not equal to 120</code></pre>
</div>
</div>
<p><em>As p is very small, we have evidence to reject the null hypothesis that the population median is 120mmHg. Note the calculations involve very large numbers when the sample size is this large</em></p>
<p>2.Compare the cholesterol levels of High and Low grade civil servants using a parametric and then a non-parametric method.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb399"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">|&gt;</span></span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(grade)<span class="sc">|&gt;</span></span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(chol), <span class="at">median=</span><span class="fu">median</span>(chol))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  grade  mean median
  &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
1     1  197.    192
2     2  195.    193</code></pre>
</div>
</div>
<p><strong>Parametric</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb401"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(whitehall<span class="sc">$</span>chol<span class="sc">~</span>whitehall<span class="sc">$</span>grade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  whitehall$chol by whitehall$grade
t = 0.89, df = 867.28, p-value = 0.3737
alternative hypothesis: true difference in means between group 1 and group 2 is not equal to 0
95 percent confidence interval:
 -2.703512  7.189638
sample estimates:
mean in group 1 mean in group 2 
       197.1851        194.9420 </code></pre>
</div>
</div>
<p><strong>Non-parametric</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb403"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(whitehall<span class="sc">$</span>chol <span class="sc">~</span> whitehall<span class="sc">$</span>grade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  whitehall$chol by whitehall$grade
W = 297668, p-value = 0.2994
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p><em>The results from parametric and non-parametric tests are in agreement: p&gt; 0.20. We accept the null hypothesis that the men in the 2 employment grades have similar cholesterol distributions.</em></p>
<ol start="3" type="1">
<li>Import the skinfold data, skinf.csv. Use a non-parametric method to test whether there is a difference between the two skinfold measurements.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb405"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a>skinf<span class="ot">&lt;-</span><span class="fu">import</span>(<span class="st">"skinf.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb406"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(skinf<span class="sc">$</span>skin1, skinf<span class="sc">$</span>skin2, <span class="at">paired=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank exact test

data:  skinf$skin1 and skinf$skin2
V = 110, p-value = 0.002625
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p><em>p &lt; 0.01 so we conclude there is strong evidence against the null hypothesis that the difference between skin measurements has a median equal to zero.</em></p>
<ol start="4" type="1">
<li>Import the babies data. Plot gestwks against matage and then calculate the Spearman’s correlation coefficient.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb408"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a>babies<span class="ot">&lt;-</span><span class="fu">import</span>(<span class="st">"babies.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb409"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(babies<span class="sc">$</span>matage, babies<span class="sc">$</span>gestwks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EPM102_R_workbook_files/figure-html/unnamed-chunk-241-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb410"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(babies<span class="sc">$</span>matage, babies<span class="sc">$</span>gestwks, <span class="at">method=</span><span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.02143943</code></pre>
</div>
</div>
<p><em>There does not appear to be an association between gestational age and maternal age.</em></p>
</section>
<section id="practical-wb16-solutions" class="level1" data-number="21">
<h1 data-number="21"><span class="header-section-number">21</span> Practical WB16 solutions</h1>
<ol type="1">
<li>Complete the table below showing the minimum number of cases required in a case-control study, with an equal number of cases and controls, for different values of minimum OR required to detect and different levels of exposure among the controls. Two of the combinations have been completed for you.</li>
</ol>
<!-- -->
<ol type="i">
<li>What happens as the OR moves further away from 1? The calculated minimum sample size decreases, with increasing distance from 1 i.e.&nbsp;the more extreme the difference in expected level of exposure between cases and controls, the smaller the sample size required to detect this.</li>
<li>How does level of exposure among controls affect the required sample size? Relatively low or high levels of exposure require larger sample sizes than intermediate levels of exposure (generally between 30% and 70%). Power of study = 90%, significance level = 5%</li>
</ol>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Exposure level among controls</th>
<th style="text-align: left;">5%</th>
<th style="text-align: left;">10%</th>
<th style="text-align: left;">40%</th>
<th style="text-align: left;">80%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">OR=0.5</td>
<td style="text-align: left;">1287</td>
<td style="text-align: left;">659</td>
<td style="text-align: left;">203</td>
<td style="text-align: left;">230</td>
</tr>
<tr class="even">
<td style="text-align: left;">OR=1.5</td>
<td style="text-align: left;">2261</td>
<td style="text-align: left;">1219</td>
<td style="text-align: left;">519</td>
<td style="text-align: left;">913</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OR=2</td>
<td style="text-align: left;">690</td>
<td style="text-align: left;">378</td>
<td style="text-align: left;">177</td>
<td style="text-align: left;">348</td>
</tr>
<tr class="even">
<td style="text-align: left;">OR=3</td>
<td style="text-align: left;">236</td>
<td style="text-align: left;">133</td>
<td style="text-align: left;">72</td>
<td style="text-align: left;">164</td>
</tr>
</tbody>
</table>
<p>Example R output, where OR = 0.5 and level of exposure among controls = 5%, using the function `or2prop() from practical 17.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb412"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.05</span>, <span class="at">p2=</span><span class="fu">or2prop</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>), <span class="at">power=</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample comparison of proportions power calculation 

              n = 1286.74
             p1 = 0.05
             p2 = 0.02564103
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Researchers wish to conduct a randomised controlled trial of a drug thought to prevent disease A. They propose a 2 armed trial comparing prevalence of disease A among those receiving the drug with prevalence of disease A amongst those receiving the placebo. Currently in the adult population, disease A has a prevalence of 40%. Complete the table below showing the minimum number of subjects required in the treatment group, assuming equal numbers of subjects in the treatment &amp; no treatment groups, for different values of the expected prevalence in the treatment group, and different values of power. Two of the combinations have been completed for you.</li>
</ol>
<!-- -->
<ol type="i">
<li>How does increasing the power affect the sample size? With increasing power, the required sample size also increases. Recall that power is the probability of getting a statistically significant result if an effect truly exists - so increasing this probability results in an increased sample size to reflect this. Prevalence among treatment group = 40%, significance level = 5%</li>
</ol>
<table class="caption-top table">
<colgroup>
<col style="width: 70%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Prevalence of disease expected in treatment group</th>
<th style="text-align: left;">10%</th>
<th style="text-align: left;">20%</th>
<th style="text-align: left;">30%</th>
<th style="text-align: left;">35%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Power=80%</td>
<td style="text-align: left;">32</td>
<td style="text-align: left;">82</td>
<td style="text-align: left;">356</td>
<td style="text-align: left;">1471</td>
</tr>
<tr class="even">
<td style="text-align: left;">Power=90%</td>
<td style="text-align: left;">42</td>
<td style="text-align: left;">109</td>
<td style="text-align: left;">477</td>
<td style="text-align: left;">1969</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Power=95%</td>
<td style="text-align: left;">52</td>
<td style="text-align: left;">134</td>
<td style="text-align: left;">589</td>
<td style="text-align: left;">2434</td>
</tr>
</tbody>
</table>
<p>Example R output, where prevalence of disease expected in treatment group = 10% and power = 80%</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb414"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.4</span>, <span class="at">p2=</span><span class="fl">0.1</span>, <span class="at">power=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample comparison of proportions power calculation 

              n = 31.49838
             p1 = 0.4
             p2 = 0.1
      sig.level = 0.05
          power = 0.8
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Researchers wished to investigate the results of a blood test following treatment with a new drug. They expected a mean of 6.1 units (SD 2.3 units) in the control group, with a standard deviation of 2.3 units. Calculate the sample size required for each group to detect different values of a clinically important difference in blood test result at different levels of significance, with power set at 90%. Two of the combinations have been completed for you.</li>
</ol>
<!-- -->
<ol type="i">
<li>How does the change in significance level affect required sample size? The significance level is the probability of incorrectly concluding a significant result, where in reality there is no important effect. Decreasing the significance level means that we are more certain that a significant result reflects a true effect - and results in an increase in sample size.</li>
<li>How does an increase in standard deviation affect the required sample size? With increased variability around the measure of interest the required sample size is increased, and correspondingly decreased with less variability (smaller SD). Standard deviation = 2.3; power of study = 90%</li>
</ol>
<table class="caption-top table">
<colgroup>
<col style="width: 72%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Clinically important difference in blood test result</th>
<th style="text-align: left;">0.5</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">1.5</th>
<th style="text-align: left;">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Significance=5%</td>
<td style="text-align: left;">446</td>
<td style="text-align: left;">113</td>
<td style="text-align: left;">51</td>
<td style="text-align: left;">29</td>
</tr>
<tr class="even">
<td style="text-align: left;">Significance=1%</td>
<td style="text-align: left;">632</td>
<td style="text-align: left;">160</td>
<td style="text-align: left;">72</td>
<td style="text-align: left;">42</td>
</tr>
</tbody>
</table>
<p>Example R output, where the clinically important difference is 0.5 and power = 90%</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb416"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.t.test</span>(<span class="at">delta=</span><span class="fl">0.5</span>, <span class="at">sd=</span><span class="fl">2.3</span>, <span class="at">power=</span><span class="fl">0.9</span>, <span class="at">type=</span><span class="st">"two.sample"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 445.6367
          delta = 0.5
             sd = 2.3
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Using R, determine the power to detect a difference of at least 0.05 between 2 proportions, in a sample size of 600 individuals per group.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb418"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.1</span>, <span class="at">p2=</span><span class="fl">0.15</span>, <span class="at">n=</span><span class="dv">600</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample comparison of proportions power calculation 

              n = 600
             p1 = 0.1
             p2 = 0.15
      sig.level = 0.05
          power = 0.7455465
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
</section>
<section id="appendix-1-list-of-datasets" class="level1" data-number="22">
<h1 data-number="22"><span class="header-section-number">22</span> Appendix 1: List of datasets</h1>
<section id="babies.csv" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="babies.csv"><span class="header-section-number">22.1</span> babies.csv</h2>
<p><strong>Babies study</strong></p>
<p>The data in Babies refer to the records of 641 singleton births.</p>
<p>The main scientific question considered was the effect of hypertension in the mother on birthweight of the baby. Other details that may affect birthweight were also recorded as shown below.</p>
<ul>
<li><strong>id</strong> identity number of mother and baby</li>
<li><strong>matage</strong> maternal age in years</li>
<li><strong>hyp</strong> hypertension 1=yes, 2=no</li>
<li><strong>gestwks</strong> gestational age in weeks</li>
<li><strong>sex</strong> sex of baby 1=male, 2=female</li>
<li><strong>bweight</strong> birth weight in grams</li>
</ul>
</section>
<section id="bus.csv" class="level2" data-number="22.2">
<h2 data-number="22.2" class="anchored" data-anchor-id="bus.csv"><span class="header-section-number">22.2</span> bus.csv</h2>
<p><strong>Bus drivers’ data</strong></p>
<p>This dataset holds data on the average daily energy intake of bus drivers and office workers. The variables are:</p>
<ul>
<li><strong>job</strong> job identifier (1=bus driver; 2=office worker)</li>
<li><strong>energy</strong> average daily energy consumption</li>
</ul>
</section>
<section id="chol1.csv" class="level2" data-number="22.3">
<h2 data-number="22.3" class="anchored" data-anchor-id="chol1.csv"><span class="header-section-number">22.3</span> chol1.csv</h2>
<p><strong>Cholesterol data</strong></p>
<p>This dataset holds data on the cholesterol level of 34 middle age men. The variables are:</p>
<ul>
<li><strong>id</strong> subject identifier</li>
<li><strong>chol</strong> cholesterol level (mg/dl)</li>
</ul>
</section>
<section id="diabk.csv" class="level2" data-number="22.4">
<h2 data-number="22.4" class="anchored" data-anchor-id="diabk.csv"><span class="header-section-number">22.4</span> diabk.csv</h2>
<p><strong>Diabetics’ data</strong></p>
<p>This dataset holds data on 15 diabetics who were involved in an educational programme to improve their diet. Their average daily calories intake was measured one week before and one week after the intervention.</p>
<p>The variables are:</p>
<ul>
<li><strong>id</strong> subject identifier</li>
<li><strong>kcal1</strong> average daily calories intake one week before</li>
<li><strong>kcal2</strong> average daily calories intake one week after</li>
</ul>
</section>
<section id="diabraz.csv" class="level2" data-number="22.5">
<h2 data-number="22.5" class="anchored" data-anchor-id="diabraz.csv"><span class="header-section-number">22.5</span> diabraz.csv</h2>
<p>Case control study of risk factors for infant deaths from diarrhoea</p>
<p>An attempt was made to ascertain all infant deaths from diarrhoea occurring over a one year period in two cities in southern Brazil, by means of weekly visits to all hospitals, coroners’ services and death registries in the cities.</p>
<p>Whenever the underlying cause of death was considered to be diarrhoea, a physician visited the parents or guardians to collect further information about the terminal illness, and data on possible risk factors. The same data were collected for control infants. Controls were the nearest neighbour aged less than 1 year. The procedure was designed to provide a control group with a similar age and socioeconomic distribution to that of the cases.</p>
<p>Cases and controls with important perinatal risk factors were excluded from the study as follows: birthweight&lt;1500g; twins; major malformation or cerebral palsy; initial hospital stay&gt;15 days. Also excluded were cases and controls under 7 days, as there were very few diarrhoea deaths in this age group.</p>
<p>Care was taken to collect a history of the feeding mode both at the time of death and prior to the onset of illness, to allow for the possibility that the illness may have resulted in a change in feeding practice. For the controls, feeding information was collected for the same dates as their matched cases.</p>
<ul>
<li><strong>set</strong> Number of matched set (1-170)</li>
<li><strong>case</strong> 1=case, 0=control</li>
<li><strong>age</strong> age in months</li>
<li><strong>agegp</strong> age group (months):1=0-1,2=2-3,3=4-5,4=6-8,5=9-11</li>
<li><strong>agegp2</strong> 1=0-2,2=3-5,3=6-11</li>
<li><strong>agegp3</strong> 1=0-1,2=2-11</li>
<li><strong>sex</strong> 1=male,2=female</li>
<li><strong>bint</strong> birth interval (months):1=first born, 2=&lt;23 mths, 3=24-35 mths,4=36+ mths</li>
<li><strong>bwt</strong> birth weight (kg): 1=&lt;2.50,2=2.50-2.99,3=3.00-3.49,4=3.50+</li>
<li><strong>bwtgp</strong> 1=3.00+,2=&lt;3.00</li>
<li><strong>meduc</strong> mother’s education (years):1=none,2=1-3,3=4-5,4=6+</li>
<li><strong>social</strong> social class:1=underproletariat,2=proletariat,3=bourgeoisie</li>
<li><strong>water</strong> piped water supply:1=in house,2=in plot,3=none</li>
<li><strong>wat2</strong> 1=in house/plot,2=none</li>
<li><strong>income</strong> per capita monthly income (% of national minimum wage): 1=0-19,2=20-39,3=40-99,4=100+</li>
<li><strong>house</strong> type of house:1=regular building,2=shack</li>
<li><strong>fridge</strong> availability of refrigerator:1=yes,2=no</li>
<li><strong>milkfin</strong> type of milk drunk at time of death:1=breast only; 2=breast+formula;3=breast+cows;4=breast+formula+cows;5=formula only</li>
<li><strong>milk</strong> type of milk drunk at onset of illness:1=breast only; 2=breast+formula;3=breast+cows;4=formula only; 5=cows only</li>
<li><strong>milkgp</strong> 1=breast only;2=breast+other;3=other only</li>
<li><strong>bf</strong> 1=breastfed;2=not breastfed</li>
<li><strong>supp</strong> non-milk food supplements:1=yes;2=no</li>
<li><strong>feedmode</strong> feeding mode:1=excl BF;2=BF+othermilk;3=othermilk only; 4=BF+suppl;5=BF+other+suppl;6=other+suppl</li>
<li><strong>pair</strong> number of matched pair (1-86) DIABRAZ only</li>
</ul>
</section>
<section id="mwanza.csv" class="level2" data-number="22.6">
<h2 data-number="22.6" class="anchored" data-anchor-id="mwanza.csv"><span class="header-section-number">22.6</span> mwanza.csv</h2>
<p>Case control study of risk factors for HIV in women, Mwanza, Tanzania.</p>
<p>As part of a prospective study of the impact of STD control on the incidence of HIV infection in Mwanza, Tanzania, a baseline survey of HIV prevalence was carried out in 12 communities. All seropositive women (15 years and above) were revisited and, where possible) interviewed about potential risk factors for HIV infection using a standard questionnaire. In addition to interviewing HIV +ve women, a random sample of HIV -ve women were selected from the population lists prepared during the baseline survey and these women were also revisited and, where possible, interviewed. No matching of controls with cases was performed.</p>
<ul>
<li><strong>idno</strong> identity number</li>
<li><strong>comp</strong> community 1-12</li>
<li><strong>case</strong> 1=case; 0=control</li>
<li><strong>age1</strong> age group: 1=15-19 2=20-24 3=25-29 4=30-34 5=35-44 6=45-54</li>
<li><strong>ed</strong> education: 1=none/adult only 2=1-3 years 3=4-6 years 4=7+ years</li>
<li><strong>eth</strong> ethnic group: 1=Sukuma 2=Mkara 3=other 9=missing</li>
<li><strong>rel</strong> religion: 1=Moslem 2=Catholic 3=Protestant 4=other 9=missing</li>
<li><strong>msta</strong> marital status: 1=currently married 2=divorced/widowed 3=never married 9=missing</li>
<li><strong>bld</strong> blood transfusion in last 5 years: 1=no 2=yes 9=missing</li>
<li><strong>inj</strong> injections in past 1 year: 1=none 2=1 3=2-4 4=5-9 5=10+ 9=missing</li>
<li><strong>skin</strong> skin incisions or tattoos: 1=no 2=yes 9=missing</li>
<li><strong>fsex</strong> age at first sex: 1=&lt;15 2=15-19 3=20+ 4=never 9=missing</li>
<li><strong>npa</strong> number of sexual partners ever: 1=0-1 2=2-4 3=5-9 4=10-19 9=missing</li>
<li><strong>pa1</strong> sex partners in last year: 1=none 2=1 3=2 4=3-4 5=5+ 9=missing</li>
<li><strong>usedc</strong> ever used a condom: 1=no 2=yes 9=missing</li>
<li><strong>ud</strong> genital ulcer or discharge in past year: 1=no 2=yes 9=missing</li>
<li><strong>ark</strong> perceived risk of HIV/AIDS: 1=none/slight 2=quite likely 3=very likely/already infected 4=don’t know</li>
<li><strong>srk</strong> perceived risk of STDs: 1=none/slight 2=quite likely 3=very likely/already infected 4=don’t know</li>
</ul>
</section>
<section id="rmr.data" class="level2" data-number="22.7">
<h2 data-number="22.7" class="anchored" data-anchor-id="rmr.data"><span class="header-section-number">22.7</span> rmr.data</h2>
<p>Resting metabolic rate data</p>
<p>This dataset holds data on weight and resting metabolic rate for 44 women aged 35 - 45 years. The variables are:</p>
<ul>
<li><strong>rmr</strong> resting metabolic rate, kilocalories per day</li>
<li><strong>weight</strong> weight of study subject, in kilograms</li>
</ul>
</section>
<section id="skinf.csv" class="level2" data-number="22.8">
<h2 data-number="22.8" class="anchored" data-anchor-id="skinf.csv"><span class="header-section-number">22.8</span> skinf.csv</h2>
<p><strong>Skinfold data</strong></p>
<p>This dataset holds data on 15 subjects for whom skinfold measurements were taken in two occasions, during the harvest and the planting season. The variables are:</p>
<ul>
<li><strong>id</strong> subject identifier</li>
<li><strong>skin1</strong> first skinfold measurement</li>
<li><strong>skin2</strong> second skinfold measurement</li>
</ul>
</section>
<section id="whall10.csv" class="level2" data-number="22.9">
<h2 data-number="22.9" class="anchored" data-anchor-id="whall10.csv"><span class="header-section-number">22.9</span> whall10.csv</h2>
<p>Cohort study of risk factors for mortality in an occupational cohort.</p>
<p>Data on risk factors for coronary heart disease (CHD) were collected between 1967-69 for a total of 19,183 male civil servants from various departments around Whitehall (London). The data were collected by self-administered questionnaire and a screening examination. Survey participants were identified and flagged at the National Health Service Central Registry and a coded copy of the death certificate provided for each subsequent death. The data in whall10.csv refers to a 10% sample of the complete records in the full study. Below the names of the variables and their coding is listed.</p>
<ul>
<li><strong>id</strong> identity number</li>
<li><strong>all</strong> death indicator: 1=death from any cause; 0 otherwise</li>
<li><strong>chd</strong> CHD death indicator: 1=death from chd; 0 otherwise</li>
<li><strong>sbp</strong> systolic bp at entry (mmHg)</li>
<li><strong>chol</strong> cholesterol at entry (mg/dl)</li>
<li><strong>grade4</strong> grade of work. 4 levels: 1=admin; 2=professional/executive; 3=clerical; 4=other</li>
<li><strong>smok</strong> smoking. 5 levels: 1=never; 2=ex; 3=1-14 cigs/day; 4=15-24; 5=25+</li>
<li><strong>datein</strong> date of entry</li>
<li><strong>dateout</strong> date of exit</li>
<li><strong>dob</strong> date of birth</li>
<li><strong>agein</strong> age at entry in years</li>
<li><strong>y</strong> observation time in years</li>
<li>**grade* grade of work. 2 levels: 1=admin&amp;professional/executive; 2=clerical&amp;other</li>
<li><strong>cholgrp</strong> cholesterol at entry. 4 levels: 1=&lt;150; 2=150-199; 3=200-249; 4=&gt;249</li>
<li><strong>sbpgrp</strong> systolic bp at entry. 4 levels: 1=&lt;120; 2=120-139; 3=140-159; 4=&gt;159</li>
<li><strong>ageout</strong> age at exit in years</li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="EPM102_R_workbook_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>